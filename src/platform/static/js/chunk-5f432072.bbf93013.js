(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-5f432072","chunk-7e0cf5a0","chunk-23da84a2","chunk-47517e53","chunk-2d0c7eb1","chunk-2d0c936a","chunk-2d0b6125"],{"1c30":function(e,t,r){"use strict";r.r(t),r("8e6e"),r("ac6a"),r("456d"),r("6762"),r("2fdb");var a=r("ade3"),o=(r("20d6"),r("2f62"));function i(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,a)}return r}var n={data:function(){return{storey:["au_ods","au_std","au_dwd","au_dwm","au_dws","au_app"],databaseList:[{label:"前置库",options:[]},{label:"",options:[]}],title:"新增派生指标",permission:[],process:[{id:"baseDimension",title:"维度基本信息",success:!0},{id:"primaryKeyDimension",title:"维度主要配置",success:!0},{id:"setEnumerationInformation",title:"枚举配置",success:!0},{id:"defineHierarchy",title:"定义层级",success:!0}]}},computed:{hasNext:function(){var e=this;return this.permission.findIndex((function(t){return t===e.stepActiveId}))+1<this.permission.length},hasPre:function(){var e=this;return this.permission.findIndex((function(t){return t===e.stepActiveId}))>0}},methods:function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?i(Object(r),!0).forEach((function(t){Object(a.a)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):i(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}({},Object(o.b)("fusionTask",["GET_DATA_BASE_LIST","GET_STEP_HEADERR"])),created:function(){var e=this;"1"==this.$route.query.type&&(this.permission=["baseDimension","primaryKeyDimension"],this.title="普通维度"),"2"==this.$route.query.type&&(this.permission=["baseDimension","setEnumerationInformation"],this.title="枚举维度"),"3"==this.$route.query.type&&(this.permission=["baseDimension","primaryKeyDimension","defineHierarchy"],this.title="层级维度"),this.process=this.process.filter((function(t){return e.permission.includes(t.id)}))}};t.default=n},4096:function(e,t,r){"use strict";r("5ad6")},4257:function(e,t,r){(e.exports=r("2350")(!1)).push([e.i,"[data-v-c25919a0] .CodeMirror{color:#000;direction:ltr;line-height:22px;border:1px solid #e7e7e7}.CodeMirror-hints[data-v-c25919a0]{z-index:9999!important}[data-v-c25919a0] .CodeMirror pre.CodeMirror-placeholder{color:#929292;font-size:15px}",""])},"4f17":function(e,t,r){"use strict";r("ffc2")},5352:function(e,t,r){"use strict";r.r(t),r("8e6e"),r("ac6a"),r("456d");var a=r("ade3"),o=(r("c5f6"),r("2f62"));function i(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,a)}return r}function n(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?i(Object(r),!0).forEach((function(t){Object(a.a)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):i(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var s={props:{dataSourceList:{type:Array,default:function(){return[]}},queryData:{type:Object,default:function(){}}},watch:{queryData:function(){this.$route.query.id&&(this.ruleForm={srcDbType:1,type:Number(this.$route.query.type),domainId:this.queryData.domainId,dimName:this.queryData.tabName,dimNameCn:this.queryData.dimNameCn,dimDesc:this.queryData.dimDesc},this.GET_DOMAIN_DB_SOURCE_LIST({domainId:this.queryData.domainId}))}},data:function(){return{ruleForm:{srcDbType:1,type:Number(this.$route.query.type),domainId:"",dimName:"",dimNameCn:"",dimDesc:""},rules:{domainId:[{required:!0,message:"请选择数据域",trigger:"change"}],srcDbType:[{required:!0,message:"请选择维度数据更新策略",trigger:"change"}],dimName:[{required:!0,validator:this.checkDimName,trigger:"change"}],dimNameCn:[{required:!0,message:"请输入维度名称",trigger:"blur"}]}}},computed:n({},Object(o.d)("develop",["domainDBSourceListChange"])),methods:n(n({},Object(o.b)("develop",["GET_DOMAIN_DB_SOURCE_LIST"])),{},{changeDomain:function(e){this.$store.commit("develop/DOMAIN_CHANGE",!this.domainDBSourceListChange),this.GET_DOMAIN_DB_SOURCE_LIST({domainId:e})},checkDimName:function(e,t,r){return t?/^[a-zA-Z].*$/.test(t)?void r():r(new Error("必须以英文开头")):r(new Error("维度英文名不可为空"))},submitForm:function(){var e=this;return new Promise((function(t,r){e.$refs.ruleForm1.validate((function(a){a?t(e.ruleForm):r("submit")}))}))},resetForm:function(){this.$refs.ruleForm1.resetFields()}})},l=r("2877"),c=Object(l.a)(s,(function(){var e=this,t=e._self._c;return t("div",[t("el-form",{ref:"ruleForm1",staticClass:"demo-ruleForm",attrs:{model:e.ruleForm,rules:e.rules,"label-width":"140px",disabled:"view"===e.$route.query.filter}},[t("el-form-item",{attrs:{label:"数据域",prop:"domainId"}},[t("el-select",{attrs:{placeholder:"请选择",disabled:"edit"===e.$route.query.filter},on:{change:e.changeDomain},model:{value:e.ruleForm.domainId,callback:function(t){e.$set(e.ruleForm,"domainId",t)},expression:"ruleForm.domainId"}},e._l(e.dataSourceList,(function(e,r){return t("el-option",{key:r,attrs:{label:e.domainNameCn,value:e.id}})})),1)],1),1==e.$route.query.type?t("el-form-item",{attrs:{label:"维度数据更新策略",prop:"srcDbType"}},[t("el-radio-group",{attrs:{disabled:"edit"===e.$route.query.filter},model:{value:e.ruleForm.srcDbType,callback:function(t){e.$set(e.ruleForm,"srcDbType",t)},expression:"ruleForm.srcDbType"}},[t("el-radio",{attrs:{label:1}},[e._v("手动更新")]),t("el-radio",{attrs:{label:2}},[e._v("实时更新")])],1)],1):e._e(),t("el-form-item",{attrs:{label:"维度名称",prop:"dimNameCn",placeholder:"请输入"}},[t("el-input",{attrs:{disabled:"edit"===e.$route.query.filter},model:{value:e.ruleForm.dimNameCn,callback:function(t){e.$set(e.ruleForm,"dimNameCn",t)},expression:"ruleForm.dimNameCn"}})],1),t("el-form-item",{attrs:{label:"维度英文名",prop:"dimName",placeholder:"请输入"}},[t("el-input",{attrs:{disabled:"edit"===e.$route.query.filter},model:{value:e.ruleForm.dimName,callback:function(t){e.$set(e.ruleForm,"dimName",t)},expression:"ruleForm.dimName"}})],1),t("el-form-item",{attrs:{label:"维度描述",placeholder:"请输入"}},[t("el-input",{attrs:{type:"textarea"},model:{value:e.ruleForm.dimDesc,callback:function(t){e.$set(e.ruleForm,"dimDesc",t)},expression:"ruleForm.dimDesc"}})],1)],1)],1)}),[],!1,null,"0569a169",null);t.default=c.exports},"57d6":function(e,t,r){"use strict";r.r(t);var a={props:{queryData:{type:Object,default:function(){}}},created:function(){this.$route.query.id&&(this.ruleForm={slot1:this.queryData.slot1,slot2:this.queryData.slot2,slot3:this.queryData.slot3})},data:function(){return{ruleForm:{slot1:"",slot2:"",slot3:""},rules:{slot1:[{required:!0,message:"请选择",trigger:"change"}],slot2:[{required:!0,message:"请选择",trigger:"change"}],slot3:[{required:!0,message:"请输入",trigger:"blur"}]}}},methods:{submitForm:function(){var e=this;return new Promise((function(t,r){e.$refs.ruleForm4.validate((function(e){if(!e)return r("submit"),!1;t("submit")}))}))},resetForm:function(){this.$refs.ruleForm4.resetFields()}}},o=r("2877"),i=Object(o.a)(a,(function(){var e=this,t=e._self._c;return t("div",[t("el-form",{ref:"ruleForm4",staticClass:"demo-ruleForm",attrs:{model:e.ruleForm,rules:e.rules,"label-width":"140px",disabled:"view"===e.$route.query.filter}},[t("el-form-item",{attrs:{label:"父层字段",prop:"slot1"}},[t("el-select",{attrs:{placeholder:"请选择"},model:{value:e.ruleForm.slot1,callback:function(t){e.$set(e.ruleForm,"slot1",t)},expression:"ruleForm.slot1"}},[t("el-option",{attrs:{label:"test1",value:"test1"}}),t("el-option",{attrs:{label:"test2",value:"test2"}})],1)],1),t("el-form-item",{attrs:{label:"名称字段",prop:"slot2"}},[t("el-select",{attrs:{placeholder:"请选择"},model:{value:e.ruleForm.slot2,callback:function(t){e.$set(e.ruleForm,"slot2",t)},expression:"ruleForm.slot2"}},[t("el-option",{attrs:{label:"test1",value:"test1"}}),t("el-option",{attrs:{label:"test2",value:"test2"}})],1)],1),t("el-form-item",{attrs:{label:"层级跟节点定义",prop:"slot3",placeholder:"请输入"}},[t("el-input",{attrs:{type:"textarea"},model:{value:e.ruleForm.slot3,callback:function(t){e.$set(e.ruleForm,"slot3",t)},expression:"ruleForm.slot3"}})],1)],1)],1)}),[],!1,null,"1b794a1a",null);t.default=i.exports},"5ad6":function(e,t,r){var a=r("4257");a.__esModule&&(a=a.default),"string"==typeof a&&(a=[[e.i,a,""]]),a.locals&&(e.exports=a.locals),(0,r("499e").default)("2865ddec",a,!0,{sourceMap:!1,shadowMode:!1})},6604:function(e,t,r){var a=r("a2e2");a.__esModule&&(a=a.default),"string"==typeof a&&(a=[[e.i,a,""]]),a.locals&&(e.exports=a.locals),(0,r("499e").default)("8455e0dc",a,!0,{sourceMap:!1,shadowMode:!1})},"7d32":function(e,t,r){(e.exports=r("2350")(!1)).push([e.i,".custom-steps[data-v-19aaeff5]{height:80px;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center}.custom-steps[data-v-19aaeff5],.custom-steps>div[data-v-19aaeff5]{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-ms-flex-wrap:nowrap;flex-wrap:nowrap}.custom-steps>div[data-v-19aaeff5]{-webkit-box-pack:start;-ms-flex-pack:start;justify-content:flex-start}.custom-steps .active .content .num[data-v-19aaeff5]{background:#409eff;color:#fff}.custom-steps .active .content .title[data-v-19aaeff5]{color:#409eff;width:100px;text-align:center}.custom-steps .active .content .num[data-v-19aaeff5]{width:35px;height:35px;line-height:35px;text-align:center;border-radius:35px}.custom-steps .content[data-v-19aaeff5]{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-ms-flex-wrap:nowrap;flex-wrap:nowrap;width:150px;font-size:15px;cursor:pointer}.custom-steps .content .num[data-v-19aaeff5]{width:30px;height:30px;line-height:30px;text-align:center;border-radius:30px;background:#b3b3b3;color:#fff;-webkit-transition:all .2s ease-in;transition:all .2s ease-in}.custom-steps .content .title[data-v-19aaeff5]{padding-top:5px;color:#b3b3b3}.custom-steps .line[data-v-19aaeff5]{height:23px;border-top:2px solid #c5c5c5;width:100px}[data-v-19aaeff5] .el-steps{width:140px}.overflow-one-lines[data-v-19aaeff5]{display:-webkit-box;-webkit-box-orient:vertical;-webkit-line-clamp:1;overflow:hidden;text-overflow:ellipsis}[data-v-19aaeff5] .el-table__body-wrapper,[data-v-19aaeff5] .el-table__header-wrapper{border-left:1px solid #eee;border-right:1px solid #eee}[data-v-19aaeff5] .el-table__header-wrapper{border-top:1px solid #eee}[data-v-19aaeff5] .el-badge__content.is-fixed,[data-v-19aaeff5] .el-badge__content.is-fixed.is-dot{right:-14px!important;top:2px!important}[data-v-19aaeff5] .el-badge__content.is-fixed{-webkit-transition:all 0s!important;transition:all 0s!important}",""])},"7d8c":function(e,t,r){"use strict";r.r(t),r("8e6e"),r("ac6a"),r("456d"),r("c5f6"),r("20d6");var a=r("ade3"),o=r("2f62"),i=r("1c30"),n=r("5352"),s=r("e159"),l=r("9011"),c=r("57d6");function u(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,a)}return r}function d(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?u(Object(r),!0).forEach((function(t){Object(a.a)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):u(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var m={mixins:[i.default],data:function(){return{stepActiveId:"baseDimension",filter:"edit"==this.$route.query.filter,isView:"view"==this.$route.query.filter,dataSourceList:[],queryData:{}}},computed:{},components:{baseDimension:n.default,primaryKeyDimension:s.default,setEnumerationInformation:l.default,defineHierarchy:c.default},created:function(){var e=this;this.GET_DATA_SOURCE_LIST().then((function(t){e.dataSourceList=t})),this.$route.query.id&&this.QUERY_DAPDIMDEF_DETAIL({id:this.$route.query.id,type:this.$route.query.type}).then((function(t){e.queryData=t}))},methods:d(d({},Object(o.b)("develop",["INSERT_DAPDIMDEF","UPDATE_DAPDIMDEF","GET_DATA_SOURCE_LIST","QUERY_DAPDIMDEF_DETAIL"])),{},{clone:function(e){return JSON.parse(JSON.stringify(e))},cancel:function(){this.$router.push("/dapDimDef/dapDimDefList")},next:function(){var e=this;this.$refs[this.stepActiveId].submitForm().then((function(){var t=e.permission.findIndex((function(t){return t===e.stepActiveId}));e.stepActiveId=e.permission[t+1]}))},save:function(){this.$refs[this.stepActiveId].submitForm().then((function(){})).catch((function(e){}))},pre:function(){var e=this,t=this.permission.findIndex((function(t){return t===e.stepActiveId}));this.stepActiveId=this.permission[t-1]},backTo:function(e){this.stepActiveId=e.id},submit:function(){var e=this,t=this;1==this.$route.query.type&&this.$refs.baseDimension.submitForm().then((function(r){e.$refs.primaryKeyDimension.submitForm().then((function(a){var o=Object.assign(r,a);if(e.$route.query.id){var i={id:Number(e.$route.query.id),type:1,dimDesc:o.dimDesc,srcTabId:o.srcTableId,srcColName:o.srcColName,pkColName:o.pkColName,pkColNameCn:o.pkColNameCn,pkColExp:o.pkColExp};e.UPDATE_DAPDIMDEF(i).then((function(r){0==r.code&&e.$AudaqueToast.tip({template:"修改成功",methods:{okEvent:function(){t.$router.go(-1)}}})}))}else e.INSERT_DAPDIMDEF(o).then((function(r){0==r.code&&e.$AudaqueToast.tip({template:"添加成功",methods:{okEvent:function(){t.$router.go(-1)}}})}))})).catch((function(){e.stepActiveId="primaryKeyDimension"}))})).catch((function(){e.stepActiveId="baseDimension"})),2==this.$route.query.type&&this.$refs.baseDimension.submitForm().then((function(r){e.$refs.setEnumerationInformation.submitForm().then((function(a){if(e.$route.query.id){var o={id:e.$route.query.id,type:2,dimDesc:r.dimDesc,dapEnumList:a.dapEnumList};e.UPDATE_DAPDIMDEF(o).then((function(r){0==r.code&&e.$AudaqueToast.tip({template:"修改成功",methods:{okEvent:function(){t.$router.go(-1)}}})}))}else{var i={type:2,domainId:r.domainId,dimName:r.dimName,dimNameCn:r.dimNameCn,dimDesc:r.dimDesc,dapEnumList:a.dapEnumList};e.INSERT_DAPDIMDEF(i).then((function(r){0==r.code&&e.$AudaqueToast.tip({template:"添加成功",methods:{okEvent:function(){t.$router.go(-1)}}})}))}})).catch((function(){e.stepActiveId="setEnumerationInformation"}))})).catch((function(){e.stepActiveId="baseDimension"}))}})},p=(r("4f17"),r("2877")),f=Object(p.a)(m,(function(){var e=this,t=e._self._c;return e._self._setupProxy,t("audaque-detail-form-page",{directives:[{name:"loading",rawName:"v-loading",value:e.$store.state.fusionTask.isLoading,expression:"$store.state.fusionTask.isLoading"}],attrs:{title:e.title,"element-loading-text":"加载中","element-loading-spinner":"el-icon-loading","element-loading-background":"rgba(255, 255, 255, 0.95)"}},[e.process.length>0?t("div",{staticClass:"custom-steps"},e._l(e.process,(function(r,a){return t("div",{key:a,class:[r.success?"success":"",""!==r.id&&r.id==e.stepActiveId?"active":""]},[t("div",{staticClass:"content",on:{click:function(t){return e.backTo(r)}}},[t("div",{staticClass:"num"},[e._v(e._s(a+1))]),t("div",{staticClass:"title overflow-one-lines",attrs:{title:r.title}},[e._v(e._s(r.title))])]),a<e.process.length-1?t("div",{staticClass:"line"}):e._e()])})),0):e._e(),t("baseDimension",{directives:[{name:"show",rawName:"v-show",value:"baseDimension"===e.stepActiveId,expression:"stepActiveId === 'baseDimension'"}],ref:"baseDimension",attrs:{dataSourceList:e.dataSourceList,queryData:e.queryData}}),t("primaryKeyDimension",{directives:[{name:"show",rawName:"v-show",value:"primaryKeyDimension"===e.stepActiveId,expression:"stepActiveId === 'primaryKeyDimension'"}],ref:"primaryKeyDimension",attrs:{queryData:e.queryData,stepActiveId:e.stepActiveId}}),t("setEnumerationInformation",{directives:[{name:"show",rawName:"v-show",value:"setEnumerationInformation"===e.stepActiveId,expression:"stepActiveId === 'setEnumerationInformation'"}],ref:"setEnumerationInformation",attrs:{queryData:e.queryData}}),t("defineHierarchy",{directives:[{name:"show",rawName:"v-show",value:"defineHierarchy"===e.stepActiveId,expression:"stepActiveId === 'defineHierarchy'"}],ref:"defineHierarchy",attrs:{queryData:e.queryData}}),t("template",{slot:"bottom"},[t("div",{staticClass:"footer"},[e.isView?e._e():[t("el-button",{staticStyle:{"margin-top":"12px"},attrs:{type:"primary"},on:{click:e.cancel}},[e._v("取消")]),e.hasPre?[t("el-button",{staticStyle:{"margin-top":"12px"},attrs:{type:"primary"},on:{click:e.pre}},[e._v("上一步")])]:e._e(),e.hasNext?[t("el-button",{key:1,staticStyle:{"margin-top":"12px"},attrs:{type:"primary"},on:{click:e.next}},[e._v("下一步")])]:e._e(),e.hasNext?e._e():[t("el-button",{key:2,staticStyle:{"margin-top":"12px"},attrs:{type:"primary"},on:{click:e.submit}},[e._v("提交")])]]],2)])],2)}),[],!1,null,"19aaeff5",null);t.default=f.exports},"88ab":function(e,t,r){"use strict";r("6604")},9011:function(e,t,r){"use strict";r.r(t),r("28a5"),r("ac6a"),r("8615");var a={props:{queryData:{type:Object,default:function(){}}},watch:{queryData:function(){if(this.$route.query.id){this.ruleForm.tableData=this.queryData.dapEnumList.map((function(e){return{code:e.enumKey,value:e.enumVal}}));var e=this.ruleForm.tableData.map((function(e){return Object.values(e)}));this.ruleForm.slot1=e.join("\n")}}},data:function(){return{ruleForm:{slot1:"",tableData:[]},rules:{tableData:[{validator:this.checkTableData,trigger:"change"}]}}},methods:{checkTableData:function(e,t,r){if(0===this.ruleForm.tableData.length)return r(new Error("请生成右侧键值对"));r()},initTableData:function(){var e=this,t=this.ruleForm.slot1.split("\n");this.ruleForm.tableData=[],t.forEach((function(t){t.split(",")[0]&&t.split(",")[1]&&e.ruleForm.tableData.push({code:t.split(",")[0],value:t.split(",")[1]})}))},submitForm:function(){var e=this;return new Promise((function(t,r){e.$refs.ruleForm3.validate((function(a){if(!a)return r("submit"),!1;var o={dapEnumList:e.ruleForm.tableData.map((function(e){return{enumKey:e.code,enumVal:e.value}}))};t(o)}))}))},resetForm:function(){this.$refs.ruleForm3.resetFields()}}},o=(r("88ab"),r("2877")),i=Object(o.a)(a,(function(){var e=this,t=e._self._c;return t("div",[t("el-form",{ref:"ruleForm3",staticClass:"demo-ruleForm",attrs:{model:e.ruleForm,rules:e.rules,"label-width":"114px",disabled:"view"===e.$route.query.filter}},[t("el-form-item",{attrs:{label:"设置枚举信息",prop:"tableData"}},[t("el-row",{attrs:{gutter:24}},[t("el-col",{attrs:{span:8}},[t("el-input",{attrs:{type:"textarea",placeholder:"配置规则：每行一条规则；key和value以','为分隔，参考示例(M,男)"},model:{value:e.ruleForm.slot1,callback:function(t){e.$set(e.ruleForm,"slot1",t)},expression:"ruleForm.slot1"}})],1),t("el-col",{attrs:{span:3}},[t("div",{staticClass:"init_table"},[t("i",{staticClass:"el-icon-d-arrow-right",on:{click:e.initTableData}})])]),t("el-col",{attrs:{span:8}},[t("el-table",{staticStyle:{width:"100%"},attrs:{data:e.ruleForm.tableData}},[t("el-table-column",{attrs:{prop:"code",label:"code（键）","show-overflow-tooltip":""}}),t("el-table-column",{attrs:{prop:"value",label:"value（值）","show-overflow-tooltip":""}})],1)],1)],1)],1)],1)],1)}),[],!1,null,"1c7b0848",null);t.default=i.exports},a2e2:function(e,t,r){(e.exports=r("2350")(!1)).push([e.i,".init_table[data-v-1c7b0848]{text-align:center;padding-top:30px}.init_table i[data-v-1c7b0848]{font-size:22px;color:#00aad3;cursor:pointer}",""])},af8d:function(e,t,r){"use strict";r.r(t),r("b866"),r("a7be"),r("f6b6"),r("d7d5");var a=r("db05"),o=r.n(a),i=r("56b3");r("8c33"),r("31c5"),r("ffda"),r("9b74"),r("991c");var n={data:function(){return{editor:null}},props:{value:{type:String,default:""},sqlStyle:{type:String,default:"default"},readOnly:{type:[Boolean,String]},placeholder:{type:String,default:""}},watch:{newVal:function(e,t){this.editor&&this.$emit("changeTextarea",this.editor.getValue())}},computed:{newVal:function(){if(this.editor)return this.editor.getValue()},isView:function(){return"view"===this.$route.query.filter}},mounted:function(){this.initCodeMirror()},methods:{formaterSql:function(){this.editor.setValue(o.a.format(this.editor.getValue()))},initCodeMirror:function(){var e=this,t=this;this.editor=i.fromTextArea(this.$refs.mycode,{value:this.value,mode:"text/x-mariadb",indentWithTabs:!0,smartIndent:!0,lineNumbers:!0,matchBrackets:!0,cursorHeight:1,lineWrapping:!0,readOnly:this.isView,theme:"idea",autofocus:!0,extraKeys:{Ctrl:"autocomplete"},hintOptions:{completeSingle:!1},gutters:["myGutter","CodeMirror-linenumbers"],gutterWidth:40}),this.editor.on("inputRead",(function(){e.editor.showHint()})),this.editor.setOption("extraKeys",{"Ctrl-D":function(e){t.formaterSql()}})},setVal:function(){this.editor&&(""===this.value?this.editor.setValue(""):this.editor.setValue(this.value))}}},s=(r("4096"),r("2877")),l=Object(s.a)(n,(function(){var e=this,t=e._self._c;return t("div",{staticStyle:{border:"1px solid #409eff"}},[t("textarea",{directives:[{name:"model",rawName:"v-model",value:e.value,expression:"value"}],ref:"mycode",staticClass:"codesql",attrs:{placeholder:e.placeholder},domProps:{value:e.value},on:{input:function(t){t.target.composing||(e.value=t.target.value)}}})])}),[],!1,null,"c25919a0",null);t.default=l.exports},b866:function(e,t,r){var a=r("d131");a.__esModule&&(a=a.default),"string"==typeof a&&(a=[[e.i,a,""]]),a.locals&&(e.exports=a.locals),(0,r("499e").default)("3875f97e",a,!0,{sourceMap:!1,shadowMode:!1})},d131:function(e,t,r){(e.exports=r("2350")(!1)).push([e.i,".cm-s-idea span.cm-meta{color:olive}.cm-s-idea span.cm-number{color:#00f}.cm-s-idea span.cm-keyword{line-height:1em;font-weight:700;color:navy}.cm-s-idea span.cm-atom{font-weight:700;color:navy}.cm-s-idea span.cm-def,.cm-s-idea span.cm-operator,.cm-s-idea span.cm-property,.cm-s-idea span.cm-type,.cm-s-idea span.cm-variable,.cm-s-idea span.cm-variable-2,.cm-s-idea span.cm-variable-3{color:#000}.cm-s-idea span.cm-comment{color:grey}.cm-s-idea span.cm-string,.cm-s-idea span.cm-string-2{color:green}.cm-s-idea span.cm-qualifier{color:#555}.cm-s-idea span.cm-error{color:red}.cm-s-idea span.cm-attribute{color:#00f}.cm-s-idea span.cm-tag{color:navy}.cm-s-idea span.cm-link{color:#00f}.cm-s-idea .CodeMirror-activeline-background{background:#fffae3}.cm-s-idea span.cm-builtin{color:#30a}.cm-s-idea span.cm-bracket{color:#cc7}.cm-s-idea{font-family:Consolas,Menlo,Monaco,Lucida Console,Liberation Mono,DejaVu Sans Mono,Bitstream Vera Sans Mono,Courier New,monospace,serif}.cm-s-idea .CodeMirror-matchingbracket{outline:1px solid grey;color:#000!important}.CodeMirror-hints.idea{font-family:Menlo,Monaco,Consolas,Courier New,monospace;color:#616569;background-color:#ebf3fd!important}.CodeMirror-hints.idea .CodeMirror-hint-active{background-color:#a2b8c9!important;color:#5c6065!important}",""])},d7d5:function(e,t,r){!function(e){function t(e){e.state.placeholder&&(e.state.placeholder.parentNode.removeChild(e.state.placeholder),e.state.placeholder=null)}function r(e){t(e);var r=e.state.placeholder=document.createElement("pre");r.style.cssText="height: 0; overflow: visible",r.style.direction=e.getOption("direction"),r.className="CodeMirror-placeholder CodeMirror-line-like";var a=e.getOption("placeholder");"string"==typeof a&&(a=document.createTextNode(a)),r.appendChild(a),e.display.lineSpace.insertBefore(r,e.display.lineSpace.firstChild)}function a(e){i(e)&&r(e)}function o(e){var a=e.getWrapperElement(),o=i(e);a.className=a.className.replace(" CodeMirror-empty","")+(o?" CodeMirror-empty":""),o?r(e):t(e)}function i(e){return 1===e.lineCount()&&""===e.getLine(0)}e.defineOption("placeholder","",(function(i,n,s){var l=s&&s!=e.Init;if(n&&!l)i.on("blur",a),i.on("change",o),i.on("swapDoc",o),e.on(i.getInputField(),"compositionupdate",i.state.placeholderCompose=function(){!function(e){setTimeout((function(){var a=!1;if(1==e.lineCount()){var o=e.getInputField();a="TEXTAREA"==o.nodeName?!e.getLine(0).length:!/[^\u200b]/.test(o.querySelector(".CodeMirror-line").textContent)}a?r(e):t(e)}),20)}(i)}),o(i);else if(!n&&l){i.off("blur",a),i.off("change",o),i.off("swapDoc",o),e.off(i.getInputField(),"compositionupdate",i.state.placeholderCompose),t(i);var c=i.getWrapperElement();c.className=c.className.replace(" CodeMirror-empty","")}n&&!i.hasFocus()&&a(i)}))}(r("56b3"))},e159:function(e,t,r){"use strict";r.r(t),r("7f7f"),r("8e6e"),r("ac6a"),r("456d"),r("7514");var a=r("ade3"),o=r("2f62"),i=r("af8d"),n=r("db05"),s=r.n(n);function l(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,a)}return r}function c(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?l(Object(r),!0).forEach((function(t){Object(a.a)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):l(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var u={computed:c({},Object(o.d)("develop",["domainDBSourceList","columnList","tableList","domainDBSourceListChange"])),props:{queryData:{type:Object,default:function(){}},stepActiveId:{type:String,default:""}},components:{SqlEditor:i.default},watch:{queryData:function(){this.$route.query.id&&(this.ruleForm={connId:this.queryData.connId,srcTableId:this.queryData.srcTabId,srcColName:this.queryData.srcColName,pkColNameCn:this.queryData.colDesc,pkColName:this.queryData.colName,srcId:"",pkColExp:decodeURI(this.queryData.colExpress)},this.GET_TABLE_LIST({connId:this.queryData.connId}),this.GET_COLUMN_LIST({connId:this.queryData.connId,tableName:this.queryData.srcTabName}))},domainDBSourceListChange:function(){this.ruleForm.connId="",this.ruleForm.srcTableId="",this.ruleForm.srcColName=""}},data:function(){return{placeholder:"请输入主键计算逻辑，比如FSELSE_.DIM.customer.borndate > 1995，输入ctrl + d可格式化",ruleForm:{connId:"",srcTableId:"",srcTableName:"",srcColName:"",pkColNameCn:"",pkColName:"",pkColExp:"",srcId:""},rules:{connId:[{required:!0,message:"请选择数据源",trigger:"change"}],srcTableId:[{required:!0,message:"请选择来源主表",trigger:"change"}],srcColName:[{required:!0,message:"请选择主键来源字段",trigger:"change"}],pkColNameCn:[{required:!0,message:"请输入主键名称",trigger:"blur"}],pkColName:[{required:!0,validator:this.checkDimName,trigger:"change"}],pkColExp:[{required:!0,message:"请输入主键计算逻辑",trigger:"blur"}]}}},methods:c(c({},Object(o.b)("develop",["GET_COLUMN_LIST","GET_TABLE_LIST"])),{},{changeColumn:function(e){this.ruleForm.srcColName="";var t=this.tableList.find((function(t){return t.id===e})).tableName;this.ruleForm.srcTableName=t,this.GET_COLUMN_LIST({connId:this.ruleForm.connId,tableName:t})},checkDimName:function(e,t,r){return t?/^[a-zA-Z].*$/.test(t)?void r():r(new Error("必须以英文开头")):r(new Error("主键英文不可为空"))},changeColName:function(){this.initExp()},initExp:function(){var e=this;if(""===this.ruleForm.pkColExp&&this.ruleForm.srcTableId&&this.ruleForm.srcColName){var t=this.tableList.find((function(t){return t.id===e.ruleForm.srcTableId})).tableName;this.$refs.sqleditor.editor.setValue("select ".concat(this.ruleForm.srcColName," from ").concat(t))}},changeTextarea:function(e){this.$set(this.ruleForm,"pkColExp",e)},changeTable:function(e){this.ruleForm.srcTableId="",this.ruleForm.srcColName="",this.GET_TABLE_LIST({connId:e})},generateSql:function(){},formaterSql:function(){var e=this.$refs.sqleditor;e.editor.setValue(s.a.format(e.editor.getValue()))},submitForm:function(){var e=this;return new Promise((function(t,r){e.$refs.ruleForm2.validate((function(a){if(!a)return r("submit"),!1;e.ruleForm.srcId=e.domainDBSourceList.find((function(t){return t.connId===e.ruleForm.connId})).srcId;var o=Object.assign(e.ruleForm);o.pkColExp=encodeURI(o.pkColExp),t(o)}))}))},resetForm:function(){this.$refs.ruleForm2.resetFields()}})},d=r("2877"),m=Object(d.a)(u,(function(){var e=this,t=e._self._c;return t("div",[t("el-form",{ref:"ruleForm2",staticClass:"demo-ruleForm",attrs:{model:e.ruleForm,rules:e.rules,"label-width":"140px",disabled:"view"===e.$route.query.filter}},[t("el-form-item",{attrs:{label:"数据源",prop:"connId"}},[t("el-select",{attrs:{placeholder:"请选择",disabled:"edit"===e.$route.query.filter},on:{change:e.changeTable},model:{value:e.ruleForm.connId,callback:function(t){e.$set(e.ruleForm,"connId",t)},expression:"ruleForm.connId"}},e._l(e.domainDBSourceList,(function(e,r){return t("el-option",{key:r,attrs:{label:e.name,value:e.connId}})})),1)],1),t("el-form-item",{attrs:{label:"来源主表",prop:"srcTableId"}},[t("el-select",{attrs:{placeholder:"请选择",disabled:"edit"===e.$route.query.filter},on:{change:e.changeColumn},model:{value:e.ruleForm.srcTableId,callback:function(t){e.$set(e.ruleForm,"srcTableId",t)},expression:"ruleForm.srcTableId"}},e._l(e.tableList,(function(e,r){return t("el-option",{key:r,attrs:{label:e.tableName,value:e.id}})})),1)],1),t("el-form-item",{attrs:{label:"主键来源字段",prop:"srcColName"}},[t("el-select",{attrs:{placeholder:"请选择"},on:{change:e.changeColName},model:{value:e.ruleForm.srcColName,callback:function(t){e.$set(e.ruleForm,"srcColName",t)},expression:"ruleForm.srcColName"}},e._l(e.columnList,(function(e,r){return t("el-option",{key:r,attrs:{label:e.colName,value:e.colName}})})),1)],1),t("el-form-item",{attrs:{label:"主键名称",prop:"pkColNameCn",placeholder:"请输入"}},[t("el-input",{model:{value:e.ruleForm.pkColNameCn,callback:function(t){e.$set(e.ruleForm,"pkColNameCn",t)},expression:"ruleForm.pkColNameCn"}})],1),t("el-form-item",{attrs:{label:"主键英文",prop:"pkColName",placeholder:"请输入"}},[t("el-input",{model:{value:e.ruleForm.pkColName,callback:function(t){e.$set(e.ruleForm,"pkColName",t)},expression:"ruleForm.pkColName"}})],1),t("el-form-item",{attrs:{label:"主键计算逻辑",prop:"pkColExp",placeholder:"请输入"}},["primaryKeyDimension"===e.stepActiveId?t("div",[t("SqlEditor",{ref:"sqleditor",attrs:{value:e.ruleForm.pkColExp,placeholder:e.placeholder},on:{changeTextarea:function(t){return e.changeTextarea(t)}}})],1):e._e()])],1)],1)}),[],!1,null,"1f5ba705",null);t.default=m.exports},ffc2:function(e,t,r){var a=r("7d32");a.__esModule&&(a=a.default),"string"==typeof a&&(a=[[e.i,a,""]]),a.locals&&(e.exports=a.locals),(0,r("499e").default)("7cc36ac6",a,!0,{sourceMap:!1,shadowMode:!1})}}]);