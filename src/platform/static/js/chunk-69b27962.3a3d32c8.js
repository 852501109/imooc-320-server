(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-69b27962","chunk-6368203c","chunk-6d5fa95e","chunk-743b519a"],{"0898":function(e,t,a){(e.exports=a("2350")(!1)).push([e.i,"[data-v-2df97061] .el-table td,[data-v-2df97061] .el-table th,[data-v-2df97061] .el-table th.el-table__cell>.cell{text-align:center!important}[data-v-2df97061] .el-form{width:90%;margin:0 auto}.tips[data-v-2df97061]{padding-top:5px;display:inline-block;color:#e6a23c}.checkboxrow[data-v-2df97061]{width:80%;margin:0 0 10px 0}.rule-type[data-v-2df97061]{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-ms-flex-wrap:wrap;flex-wrap:wrap}.rule-type span[data-v-2df97061]{display:inline-block}.operate[data-v-2df97061]{cursor:pointer;color:#53a7f8;font-size:12px}.require[data-v-2df97061]{color:#f56c6c;font-size:16px;margin:0 3px}.flex[data-v-2df97061]{height:100%;display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-ms-flex-wrap:nowrap;flex-wrap:nowrap}.flex[data-v-2df97061] .el-form-item{margin-bottom:0!important}.center[data-v-2df97061] .el-form-item__content{margin-left:0!important;display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-ms-flex-align:center;align-items:center}",""])},1794:function(e,t,a){"use strict";a.r(t),a("96cf");var r,n=a("1da1"),o={props:{show:{type:Boolean,default:!1}},data:function(){return{datas:[],tableData:[{slot1:"test1",slot2:"SQL规则",slot3:"{0} in ('男', '女')",slot4:"性别检测"}],multipleSelection:[],defaultProps:{label:"name",children:"children"},treeExpandData:[],searchText:""}},components:{},computed:{},mounted:function(){},methods:{onSearch:function(){},onSubmit:function(){this.$emit("submit",this.multipleSelection)},handleClose:function(){this.$emit("close")},handleSelectionChange:function(e){this.multipleSelection=e},handleNodeClick:(r=Object(n.a)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)}))),function(){return r.apply(this,arguments)})}},i=(a("fa01"),a("2877")),l=Object(i.a)(o,(function(){var e=this,t=e._self._c;return t("el-dialog",{attrs:{title:"治理稽核规则配置",visible:e.show,width:"80%","before-close":e.handleClose,"append-to-body":""},on:{"update:visible":function(t){e.show=t}}},[t("audaque-resize-split-page",[t("template",{slot:"leftPane"},[t("el-tree",{staticClass:"tree-dashed",attrs:{data:e.datas,props:e.defaultProps,"default-expanded-keys":e.treeExpandData,"node-key":"id"},on:{"node-click":e.handleNodeClick}})],1),t("template",{slot:"rightPane"},[t("div",{staticClass:"row",staticStyle:{"margin-bottom":"10px"}},[t("div",{staticStyle:{width:"50%"}},[t("el-input",{attrs:{placeholder:"通过表名，表中文名模糊查询"},model:{value:e.searchText,callback:function(t){e.searchText=t},expression:"searchText"}})],1),t("div",[t("el-button",{attrs:{type:"primary"},on:{click:e.onSearch}},[e._v("筛选")])],1)]),t("el-table",{ref:"multipleTable",staticStyle:{width:"100%"},attrs:{data:e.tableData,"tooltip-effect":"dark"},on:{"selection-change":e.handleSelectionChange}},[t("el-table-column",{attrs:{type:"selection",label:"序号"}}),t("el-table-column",{attrs:{prop:"slot1",label:"规则名称"}}),t("el-table-column",{attrs:{prop:"slot2",label:"规则类型"}}),t("el-table-column",{attrs:{prop:"slot3",label:"规则表达式"}}),t("el-table-column",{attrs:{prop:"slot4",label:"规则表达式"}})],1),t("div",{staticClass:"row",staticStyle:{"margin-top":"10px"}},[t("div",[t("el-button",{on:{click:e.handleClose}},[e._v("取消")])],1),t("div",[t("el-button",{attrs:{type:"primary"},on:{click:e.onSubmit}},[e._v("确认")])],1)])],1)],2)],1)}),[],!1,null,"549c569a",null);t.default=l.exports},"1a2e":function(e,t,a){(e.exports=a("2350")(!1)).push([e.i,".row[data-v-549c569a]{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:end;-ms-flex-pack:end;justify-content:flex-end;-webkit-box-align:start;-ms-flex-align:start;align-items:flex-start;-ms-flex-wrap:nowrap;flex-wrap:nowrap}.row>div[data-v-549c569a]:first-child{margin-right:10px}",""])},2662:function(e,t,a){(e.exports=a("2350")(!1)).push([e.i,"[data-v-1f45bdba] .CodeMirror{color:#000;direction:ltr;height:500px!important;line-height:22px;border:1px solid #e7e7e7}.CodeMirror-hints[data-v-1f45bdba]{z-index:9999!important}",""])},"2f037":function(e,t,a){var r=a("5504");r.__esModule&&(r=r.default),"string"==typeof r&&(r=[[e.i,r,""]]),r.locals&&(e.exports=r.locals),(0,a("499e").default)("230b1365",r,!0,{sourceMap:!1,shadowMode:!1})},"33fb":function(e,t,a){"use strict";a.r(t),a("7514"),a("7f7f"),a("8e6e"),a("456d"),a("ac6a"),a("6762"),a("2fdb");var r=a("ade3"),n=a("2f62");function o(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function i(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?o(Object(a),!0).forEach((function(t){Object(r.a)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):o(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var l={name:"RuleList",data:function(){return{selectedData:[],ruleNameDim:"",endList:[],isSelect:!1,ruleTypeOptionsGroup:[{name:"规则类型",children:[]}],defaultProps:{children:"children",label:"name"},isSearch:!1,getHeight:!1,total:1,param:{includeRole:!0,page:1,rows:10,id:"",ruleName:"",ruleType:"1",ruleCategory:"",expression:"",ruleDesc:"",dataState:"",createUser:"",createRange:"",updateUser:"",updateRange:""},search_dataRange:""}},props:["chooseRules","selectedValue"],computed:i({},Object(n.d)("generateRule",["generateRuleList","ruleTypeOptions","ruleCategoryOptions"])),methods:i(i({},Object(n.b)("generateRule",["GENERATERULELIST","DELETEGENERATERULE","GETRULETYPEOPTIONS_LIST","GETRULECATEGORYLIST"])),{},{updateSameList:function(){var e=this;this.generateRuleList.rows.filter((function(t){return e.endList.map((function(e){return e.id})).includes(t.id)})).forEach((function(t){e.$refs.multipleTable.toggleRowSelection(t)}))},initData:function(){var e=this,t=JSON.parse(JSON.stringify(this.param));t.createRange&&t.createRange[0]&&(t.createStartTime=t.createRange[0]),t.createRange&&t.createRange[1]&&(t.createEndTime=t.createRange[1]),delete t.createRange,t.updateRange&&t.updateRange[0]&&(t.updateStartTime=t.updateRange[0]),t.updateRange&&t.updateRange[1]&&(t.updateEndTime=t.updateRange[1]),delete t.updateRange,this.isSelect=!0,this.GENERATERULELIST(t).then((function(){e.updateSameList(),e.isSelect=!1}))},handleNodeClick:function(e){this.param.ruleType=e.code,this.QUERYLIST_PARAMS(0)},handleSizeChange:function(e){this.param.page=1,this.param.rows=e,this.initData()},handleCurrentChange:function(e){this.param.page=e,this.initData()},QUERYLIST_PARAMS:function(e){var t=this;this.param.page=1,e>0&&this.publics.resetFun(this.param,(function(){t.param.rows=10,t.search_dataRange=null})),this.initData()},delRow:function(e){var t=this;this.$AudaqueToast.warn({template:"确认删除？",methods:{okEvent:function(){t.$store.commit("SHOW_LOADING",!0),t.DELETEGENERATERULE({id:e}).then((function(e){0==e.code&&t.$AudaqueToast.tip({template:"删除成功",methods:{okEvent:function(){t.initData()}}})}))}}})},goEdit:function(e){this.$router.push("/generateRule/generateRuleEdit?optType=edit&id=".concat(e,"&ruleType=").concat(this.param.ruleType))},rowChange:function(e){this.$refs.multipleTable.toggleRowSelection(e)},handleSelectionChange:function(e){var t=this;if(!this.isSelect){var a=this.generateRuleList.rows.filter((function(e){return t.endList.map((function(e){return e.id})).includes(e.id)})).filter((function(t){return!e.map((function(e){return e.id})).includes(t.id)}));this.endList=this.endList.filter((function(e){return!a.map((function(e){return e.id})).includes(e.id)})),e.forEach((function(e){t.endList.map((function(e){return e.id})).includes(e.id)||t.endList.push(e)}))}},subButton:function(){var e=this;this.endList=this.endList.map((function(t){return{id:t.id,ruleName:t.ruleName,ruleType:t.ruleType,ruleTypeName:e.ruleTypeOptionsGroup[0].children.find((function(e){return e.code==t.ruleType})).name}})),this.chooseRules(this.endList)},dimSearch:function(){var e=this,t=JSON.parse(JSON.stringify(this.param));t.ruleName=this.ruleNameDim,delete t.createRange,delete t.updateRange,this.isSelect=!0,this.GENERATERULELIST(t).then((function(){e.updateSameList(),e.isSelect=!1}))}}),created:function(){var e=this;this.GETRULETYPEOPTIONS_LIST().then((function(t){e.ruleTypeOptionsGroup[0].children=t})),this.GETRULECATEGORYLIST(),this.initData(),this.endList=this.selectedValue||[]}},s=(a("65b30"),a("2877")),c=Object(s.a)(l,(function(){var e=this,t=e._self._c;return t("audaque-resize-split-page",[t("template",{slot:"title"},[t("audaque-table-title",{attrs:{title:""}},[t("el-input",{attrs:{placeholder:"通过规则名模糊查询",clearable:""},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.dimSearch.apply(null,arguments)}},model:{value:e.ruleNameDim,callback:function(t){e.ruleNameDim=t},expression:"ruleNameDim"}}),t("el-button",{attrs:{type:"primary"},on:{click:e.dimSearch}},[e._v("筛选")])],1)],1),t("template",{slot:"leftPane"},[e.ruleTypeOptionsGroup[0].children.length>0?t("el-tree",{attrs:{data:e.ruleTypeOptionsGroup,"current-node-key":e.param.ruleType,"node-key":"code","default-expand-all":!0,props:e.defaultProps},on:{"node-click":e.handleNodeClick}}):e._e()],1),t("template",{slot:"rightPane"},[t("el-table",{ref:"multipleTable",staticClass:"el-table-common__list",attrs:{"tooltip-effect":"light","highlight-current-row":"",stripe:"",data:e.generateRuleList.rows,selection:e.selectedData,border:""},on:{"row-click":e.rowChange,"selection-change":e.handleSelectionChange}},[t("el-table-column",{attrs:{type:"selection",width:"55"}}),t("el-table-column",{attrs:{"show-overflow-tooltip":"",type:"index",label:"序号",index:function(t){return e.$utils._indexMethod(t,e.param.page,e.param.rows)},align:"center",width:"80"}}),t("el-table-column",{attrs:{"show-overflow-tooltip":"",align:"center",prop:"ruleName",label:"规则名称"}}),t("el-table-column",{attrs:{"show-overflow-tooltip":"",align:"center",prop:"ruleType",label:"规则类型"},scopedSlots:e._u([{key:"default",fn:function(t){return e.ruleTypeOptionsGroup[0].children.length>0?[e._v("\n                    "+e._s(e.ruleTypeOptionsGroup[0].children.find((function(e){return e.code==t.row.ruleType})).name)+"\n                ")]:void 0}}],null,!0)}),t("el-table-column",{attrs:{"show-overflow-tooltip":"",align:"center",prop:"expression",label:"规则表达式"}}),t("el-table-column",{attrs:{"show-overflow-tooltip":"",align:"center",prop:"ruleDesc",label:"规则描述"}}),t("template",{slot:"empty"},[t("audaque-table-empty",{attrs:{tableFetchStatus:e.$store.state.tableFetchStatus,"is-new":!1},on:{fetch:function(t){return e.LOGLIST(e.param)}}})],1)],2),t("adq-pagination",{attrs:{"current-page":e.param.page,total:e.generateRuleList.total,"page-size":e.param.rows},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}}),t("div",{staticStyle:{display:"flex","justify-content":"flex-end","margin-top":"20px"}},[t("el-button",{attrs:{type:"primary"},on:{click:e.subButton}},[e._v("确认")])],1)],1)],2)}),[],!1,null,"bec53432",null);t.default=c.exports},3588:function(e,t,a){var r=a("1a2e");r.__esModule&&(r=r.default),"string"==typeof r&&(r=[[e.i,r,""]]),r.locals&&(e.exports=r.locals),(0,a("499e").default)("167dcafc",r,!0,{sourceMap:!1,shadowMode:!1})},5504:function(e,t,a){(e.exports=a("2350")(!1)).push([e.i,".search-date[data-v-bec53432]{width:100%!important}",""])},"65b30":function(e,t,a){"use strict";a("2f037")},"77d62":function(e,t,a){var r=a("0898");r.__esModule&&(r=r.default),"string"==typeof r&&(r=[[e.i,r,""]]),r.locals&&(e.exports=r.locals),(0,a("499e").default)("3830b238",r,!0,{sourceMap:!1,shadowMode:!1})},b04a:function(e,t,a){"use strict";a("e68a")},b866:function(e,t,a){var r=a("d131");r.__esModule&&(r=r.default),"string"==typeof r&&(r=[[e.i,r,""]]),r.locals&&(e.exports=r.locals),(0,a("499e").default)("3875f97e",r,!0,{sourceMap:!1,shadowMode:!1})},c0c9:function(e,t,a){"use strict";a.r(t),a("8e6e"),a("456d"),a("5df3"),a("4f7f"),a("8615"),a("ac6a"),a("7514");var r=a("ade3"),n=a("e762"),o=a("2f62"),i=a("1794"),l=a("33fb"),s=a("db05"),c=a.n(s),u=a("f029");function d(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function p(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?d(Object(a),!0).forEach((function(t){Object(r.a)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):d(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var f={props:["selectParam"],watch:{selectParam:{handler:function(e){if(this.autoMapValue="",e.alreadySelectTargetTable.length>0){this.sourceTableName=e.sourceRows[0].alreadySelectSourceTable[0].tableName,this.targetTableName=e.alreadySelectTargetTable[0].tableName;var t=e.sourceRows[0].alreadySelectSourceTable[0].id,a=e.alreadySelectTargetTable[0].id;this.sourceTableId=t,this.targetTableId=a,this.getCloumnList(t,a)}},deep:!0},basicInfoForm:{handler:function(e){var t=this;if(e.sqlMain){var a=this.activeName;this.activeName="",this.$nextTick((function(){t.activeName=a}))}},deep:!0}},data:function(){return{selectedValue:[],stepId:"",currentIndex:"",currentTargetColumnId:"",selectedRuleData:[],showRuleDialog:!1,sourceTableName:"",targetTableName:"",sourceTableId:"",targetTableId:"",columnMap:{},showGovernanceAuditRules:!1,currentType:{type:"",index:""},currentGAId:"",activeName:"first",sqlValue:"",autoMapValue:!1,initReportValue:!1,param:{tableInfo:[],whereCondition:"",tableData:[],asyncConfig:1,growField:""},targetColumnOptions:[],rules:{sourceDatabase:[{required:!0,message:"请选择",trigger:"change"}]},tableHead:[],alreadySelectTargetTable:[],dialogVisible:!0,basicInfoForm:{sqlMain:""}}},components:{governanceAuditRules:i.default,ruleList:l.default,SqlEditor:u.default},computed:p({comSourceIsDisabled:function(){return function(e){return 1!==e.value&&""!==this.selectParam.targetDatabase&&e.value>this.param.targetDatabase}},targetColumnIsAdditionColumn:function(){return function(e){var t=this.targetColumnOptions.find((function(t){return t.id===e.targetValue}));if(t)return null!==t.additionColumn&&1===t.additionColumn}},comTargetIsDisabled:function(){return function(e){var t=this.selectParam.sourceRows.filter((function(e){return""!==e.sourceDatabase}));if(0===t.length)return!1;var a=t.reduce((function(e,t){return e.value>t.sourceDatabase?e:t})),r=this.selectParam.sourceRows.find((function(e){return""!==e.sourceDatabase}));return!!(1!==e.value&&r&&e.value<=a.sourceDatabase)}}},Object(o.d)("generateRule",["generateRuleList","ruleTypeOptions","ruleCategoryOptions"])),mounted:function(){},methods:p(p(p({},Object(o.b)("generateRule",["GENERATERULELIST","DELETEGENERATERULE","GETRULETYPEOPTIONS_LIST","GETRULECATEGORYLIST"])),Object(o.b)(["_AJAX"])),{},{selectGATable:function(e){this.currentGAId=e,this.showGovernanceAuditRules=!0},handleClick:function(){},createTbleAuto:function(){var e=this;this.$nextTick((function(){if(e.selectParam.autoCreate&&!e.selectParam.sourceRows.find((function(e){return 0===e.alreadySelectSourceTableValue.length}))&&0!==e.selectParam.alreadySelectTargetTable.length){e.param.tableData=[],e.tableHead=[],e.selectParam.sourceRows.forEach((function(t){var a=t.alreadySelectSourceTableValue[0],r=t.alreadySelectSourceTable.find((function(e){return e.id===a})).slot1;e.tableHead.push(r)})),e.selectParam.alreadySelectTargetTableValue.forEach((function(t){var a=e.selectParam.alreadySelectTargetTable.find((function(e){return e.id===t})).slot1;e.tableHead.push(a)}));var t={};e.tableHead.forEach((function(e){t[e]=1,t.options=[{value:1,label:"字段1"},{value:2,label:"字段2"}],t.selectValue="",t.id=1,t.ruletypes=[]})),e.param.tableData.push(t),e.$refs.tableData&&e.$refs.tableData.doLayout()}}))},initGA:function(e){var t=this;this.param.tableData.find((function(e){return e.id===t.currentGAId})).ruletypes=e.map((function(e){return e.slot1})),this.showGovernanceAuditRules=!1},delGA:function(e){this.param.tableData.find((function(t){return t.id===e})).ruletypes=[]},handleStep:function(e){var t=this;this.stepId=e,this._AJAX({url:"stepOds.echo",method:"GET",data:{stepId:e}}).then((function(e){var a=e.echoVo,r=e.tableIdColumnMap;t.targetColumnOptions=Object.values(r)[1],t.param.asyncConfig=a.syncType,t.param.growField=a.increaseField,t.param.initReportValue=1===a.generateQualityReport;var n=a.stepDetailList[0];t.sourceTableId=n.sourceTableId,t.targetTableId=n.targetTableId,t.sourceTableName=n.sourceTableName,t.targetTableName=n.targetTableName,t.basicInfoForm.sqlMain=n.sqlContent,t.param.whereCondition=n.whereCondition;var o=n.rowList;t.param.tableInfo=o.map((function(e){return{sourceColumnId:e.sourceColumnId,sourceColumnName:e.sourceColumnName,targetValue:e.targetColumnId,ruleIds:e.ruleIds,selectedRuleData:e.ruleData}})),t.$refs.tableData.doLayout()}))},next:function(e){var t=this;return new Promise((function(a,r){t.stepId=e;var o=t.param.tableInfo.filter((function(e){return e.targetValue})).map((function(e){return{ruleIds:e.ruleIds,sourceColumnId:e.sourceColumnId,targetColumnId:e.targetValue,sourceColumnName:e.sourceColumnName,targetColumnName:t.targetColumnOptions.find((function(t){return t.id===e.targetValue})).columnName}})),i={levelCode:"au_ods",syncType:t.param.asyncConfig,increaseField:t.param.growField?t.param.growField:"",generateQualityReport:t.initReportValue?1:0},l={sourceTableId:t.sourceTableId,targetTableId:t.targetTableId,sqlContent:Object(n.b)(t.basicInfoForm.sqlMain),whereCondition:t.param.whereCondition?Object(n.b)(t.param.whereCondition):""},s={taskId:t.$route.query.taskId,stepId:e,taskRuleRelList:o,taskStepDto:i,taskStepDetailDto:l};t.verifyParam(s)&&t.$refs.stepAggregationLayerForm.validate((function(e){e&&(t.$store.commit("fusionTask/changeLoading",!0),t._AJAX({url:"stepOds.next",method:"POST",data:s}).then((function(e){a(e)})).catch((function(e){r(e)})))}))}))},submit:function(e){var t=this;return new Promise((function(a,r){t.stepId=e;var n=t.generateParam();t.verifyParam(n)&&t.$refs.stepAggregationLayerForm.validate((function(e){e&&(t.$store.commit("fusionTask/changeLoading",!0),t._AJAX({url:"stepOds.complete",method:"POST",data:n}).then((function(e){a(e),setTimeout((function(){t.$store.commit("fusionTask/changeLoading",!1)}))})).catch((function(e){t.$store.commit("fusionTask/changeLoading",!1),r(e)})))}))}))},getCloumnList:function(e,t){var a=this;this._AJAX({url:"stepOds.getOriginOrTargetColumn",method:"GET",data:{sourceTableId:e,targetTableId:t}}).then((function(r){a.param.tableInfo=r[e].map((function(e){return{sourceColumnId:e.id,sourceColumnName:e.columnName,targetValue:"",ruleIds:""}})),a.$refs.tableData.doLayout(),a.targetColumnOptions=r[t],a.columnMap=r}))},matchColumnDim:function(e,t){return e.replaceAll("_","").replaceAll("-","").toLowerCase()===t.replaceAll("_","").replaceAll("-","").toLowerCase()},Automaticmapping:function(e){var t=this;e?this.param.tableInfo.forEach((function(e){var a=t.targetColumnOptions.find((function(a){return t.matchColumnDim(e.sourceColumnName,a.columnName)}));e.targetValue=a?a.id:""})):this.param.tableInfo.forEach((function(e){e.targetValue=""}))},chooseRules:function(e){var t=this;this.showRuleDialog=!1;var a=[];e.forEach((function(e){var t=a.find((function(t){return t.ruleTypeName===e.ruleTypeName}));if(t)t.ruleNameList.push({ruleName:e.ruleName});else{var r={ruleTypeName:e.ruleTypeName,ruleNameList:[{ruleName:e.ruleName}]};a.push(r)}})),this.selectedRuleData=a,this.param.tableInfo[this.currentIndex].selectedRuleData=a;var r,n=[];e.map((function(e){n.push(e.id)})),r=n.join(",");var o=this.param.tableInfo.find((function(e){return e.targetValue===t.currentTargetColumnId}));o&&(o.ruleIds=r,o.selectObj=e)},addRule:function(e,t){this.currentTargetColumnId=e.targetValue,this.currentIndex=t,this.showRuleDialog=!0},modifyRule:function(e,t){this.currentTargetColumnId=e.targetValue,this.currentIndex=t,this.selectedValue=e.selectObj,this.showRuleDialog=!0},deleteRule:function(e,t){this.param.tableInfo[t].selectedRuleData="",this.param.tableInfo[t].ruleIds=""},generateParam:function(){var e=this,t=this.param.tableInfo.filter((function(e){return e.targetValue})).map((function(t){return{ruleIds:t.ruleIds,sourceColumnId:t.sourceColumnId,targetColumnId:t.targetValue,sourceColumnName:t.sourceColumnName,targetColumnName:e.targetColumnOptions.find((function(e){return e.id===t.targetValue})).columnName}})),a={levelCode:"au_ods",syncType:this.param.asyncConfig,increaseField:this.param.growField,generateQualityReport:this.initReportValue?1:0},r={sourceTableId:this.sourceTableId,targetTableId:this.targetTableId,sqlContent:"",whereCondition:this.param.whereCondition?Object(n.b)(this.param.whereCondition):""};return{taskId:this.$route.query.taskId,stepId:this.stepId,taskRuleRelList:t,taskStepDto:a,taskStepDetailDto:r}},isHasDuplicateProperty:function(e,t){for(var a=new Set,r=0;r<e.length;r++){var n=e[r][t];if(a.has(n))return!0;a.add(n)}return!1},verifyParam:function(e){var t=e;return t.taskRuleRelList&&t.taskRuleRelList.some((function(e){return""!==e.sourceColumnId&&""!==e.targetColumnId}))?!this.isHasDuplicateProperty(t.taskRuleRelList,"targetColumnId")||(this.$message.error("目标表的字段不可重复，请重新选择!"),!1):(this.$message.error("目标表的字段最少填一个，不可全部为空!"),!1)},changeTextarea:function(e){this.$set(this.basicInfoForm,"sqlMain",e)},formaterSql:function(e){var t=this.$refs.sqleditor;t.editor.setValue(c.a.format(t.editor.getValue()))},generateSql:function(){var e=this,t=this.generateParam();this.$refs.stepAggregationLayerForm.validate((function(a){a&&e._AJAX({url:"stepOds.generateSql",method:"POST",data:t}).then((function(t){e.$set(e.basicInfoForm,"sqlMain",t[0].sql),e.$refs.sqleditor.setVal()})).catch((function(e){}))}))}})},m=(a("e67c"),a("2877")),h=Object(m.a)(f,(function(){var e=this,t=e._self._c;return t("div",[t("el-form",{ref:"stepAggregationLayerForm",staticClass:"form-item",attrs:{model:e.param,"label-width":"120px",rules:e.rules,"label-position":"left",disabled:"view"===e.$route.query.filter}},[t("div",[t("el-tabs",{attrs:{type:"card"},on:{"tab-click":e.handleClick},model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},[t("el-tab-pane",{attrs:{label:"字段映射",name:"first"}},[t("div",[t("div",{staticClass:"checkboxrow"},[t("el-button",{attrs:{size:"mini",plain:"",type:"primary"},on:{click:function(t){return e.Automaticmapping(!0)}}},[e._v("字段自动映射")])],1),t("el-table",{ref:"tableData",staticStyle:{width:"100%",margin:"0 auto"},attrs:{data:e.param.tableInfo,border:""}},[t("el-table-column",{attrs:{prop:"sourceColumnName",label:e.sourceTableName,align:"center"}}),t("el-table-column",{attrs:{label:e.targetTableName,prop:"targetValue"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("div",{staticClass:"flex"},[t("el-form-item",{staticClass:"center",attrs:{rules:{required:!0,message:"请选择",trigger:"change"}}},[t("el-select",{attrs:{clearable:"",placeholder:"请选择"},model:{value:a.row.targetValue,callback:function(t){e.$set(a.row,"targetValue",t)},expression:"scope.row.targetValue"}},e._l(e.targetColumnOptions,(function(e){return t("el-option",{key:e.id,attrs:{label:e.columnName,value:e.id}})})),1)],1)],1)]}}])})],1),t("br"),t("el-form-item",{attrs:{label:"同步配置",rules:{required:!0,message:"输入",trigger:"blur"},"class-name":"tablerow"}},[t("el-radio",{attrs:{label:1},model:{value:e.param.asyncConfig,callback:function(t){e.$set(e.param,"asyncConfig",t)},expression:"param.asyncConfig"}},[e._v("全量")]),t("el-radio",{attrs:{label:2},model:{value:e.param.asyncConfig,callback:function(t){e.$set(e.param,"asyncConfig",t)},expression:"param.asyncConfig"}},[e._v("增量")])],1),2===e.param.asyncConfig?t("el-form-item",{attrs:{label:"增量字段",prop:"growField",rules:{required:!0,message:"请输入",trigger:"change"}}},[t("el-select",{attrs:{placeholder:"请选择",clearable:""},model:{value:e.param.growField,callback:function(t){e.$set(e.param,"growField",t)},expression:"param.growField"}},e._l(e.param.tableInfo,(function(e){return t("el-option",{key:e.sourceColumnName,attrs:{label:e.sourceColumnName,value:e.sourceColumnName}})})),1)],1):e._e(),t("el-form-item",{attrs:{prop:"whereCondition"},scopedSlots:e._u([{key:"label",fn:function(){return[t("span",[e._v("where条件")]),t("el-tooltip",{staticClass:"item",staticStyle:{"padding-left":"10px"},attrs:{effect:"dark",placement:"right"}},[t("div",{attrs:{slot:"content"},slot:"content"},[e._v("\n                                        注：增量时可以设置，where条件不需填写where关键字\n                                    ")]),t("i",{staticClass:"content-view iconfont iconbangzhu operate"})])]},proxy:!0}])},[t("el-input",{attrs:{type:"textarea",rows:5,placeholder:"请输入内容"},model:{value:e.param.whereCondition,callback:function(t){e.$set(e.param,"whereCondition",t)},expression:"param.whereCondition"}})],1)],1)])],1)],1)]),t("governanceAuditRules",{attrs:{show:e.showGovernanceAuditRules},on:{submit:e.initGA,close:function(t){e.showGovernanceAuditRules=!1}}}),e.showRuleDialog?t("el-dialog",{attrs:{title:"治理稽核规则配置",visible:e.showRuleDialog},on:{close:function(t){e.showRuleDialog=!1}}},[t("ruleList",{staticStyle:{height:"70vh"},attrs:{chooseRules:e.chooseRules,selectedValue:e.selectedValue}})],1):e._e()],1)}),[],!1,null,"2df97061",null);t.default=h.exports},d131:function(e,t,a){(e.exports=a("2350")(!1)).push([e.i,".cm-s-idea span.cm-meta{color:olive}.cm-s-idea span.cm-number{color:#00f}.cm-s-idea span.cm-keyword{line-height:1em;font-weight:700;color:navy}.cm-s-idea span.cm-atom{font-weight:700;color:navy}.cm-s-idea span.cm-def,.cm-s-idea span.cm-operator,.cm-s-idea span.cm-property,.cm-s-idea span.cm-type,.cm-s-idea span.cm-variable,.cm-s-idea span.cm-variable-2,.cm-s-idea span.cm-variable-3{color:#000}.cm-s-idea span.cm-comment{color:grey}.cm-s-idea span.cm-string,.cm-s-idea span.cm-string-2{color:green}.cm-s-idea span.cm-qualifier{color:#555}.cm-s-idea span.cm-error{color:red}.cm-s-idea span.cm-attribute{color:#00f}.cm-s-idea span.cm-tag{color:navy}.cm-s-idea span.cm-link{color:#00f}.cm-s-idea .CodeMirror-activeline-background{background:#fffae3}.cm-s-idea span.cm-builtin{color:#30a}.cm-s-idea span.cm-bracket{color:#cc7}.cm-s-idea{font-family:Consolas,Menlo,Monaco,Lucida Console,Liberation Mono,DejaVu Sans Mono,Bitstream Vera Sans Mono,Courier New,monospace,serif}.cm-s-idea .CodeMirror-matchingbracket{outline:1px solid grey;color:#000!important}.CodeMirror-hints.idea{font-family:Menlo,Monaco,Consolas,Courier New,monospace;color:#616569;background-color:#ebf3fd!important}.CodeMirror-hints.idea .CodeMirror-hint-active{background-color:#a2b8c9!important;color:#5c6065!important}",""])},e67c:function(e,t,a){"use strict";a("77d62")},e68a:function(e,t,a){var r=a("2662");r.__esModule&&(r=r.default),"string"==typeof r&&(r=[[e.i,r,""]]),r.locals&&(e.exports=r.locals),(0,a("499e").default)("f422793a",r,!0,{sourceMap:!1,shadowMode:!1})},e762:function(e,t,a){"use strict";a.d(t,"b",(function(){return w})),a.d(t,"a",(function(){return E}));const r="function"==typeof Buffer,n="function"==typeof TextDecoder?new TextDecoder:void 0,o="function"==typeof TextEncoder?new TextEncoder:void 0,i=Array.prototype.slice.call("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="),l=(e=>{let t={};return e.forEach((e,a)=>t[e]=a),t})(i),s=/^(?:[A-Za-z\d+\/]{4})*?(?:[A-Za-z\d+\/]{2}(?:==)?|[A-Za-z\d+\/]{3}=?)?$/,c=String.fromCharCode.bind(String),u="function"==typeof Uint8Array.from?Uint8Array.from.bind(Uint8Array):e=>new Uint8Array(Array.prototype.slice.call(e,0)),d=e=>e.replace(/=/g,"").replace(/[+\/]/g,e=>"+"==e?"-":"_"),p=e=>e.replace(/[^A-Za-z0-9\+\/]/g,""),f=e=>{let t,a,r,n,o="";const l=e.length%3;for(let s=0;s<e.length;){if((a=e.charCodeAt(s++))>255||(r=e.charCodeAt(s++))>255||(n=e.charCodeAt(s++))>255)throw new TypeError("invalid character found");t=a<<16|r<<8|n,o+=i[t>>18&63]+i[t>>12&63]+i[t>>6&63]+i[63&t]}return l?o.slice(0,l-3)+"===".substring(l):o},m="function"==typeof btoa?e=>btoa(e):r?e=>Buffer.from(e,"binary").toString("base64"):f,h=r?e=>Buffer.from(e).toString("base64"):e=>{let t=[];for(let a=0,r=e.length;a<r;a+=4096)t.push(c.apply(null,e.subarray(a,a+4096)));return m(t.join(""))},b=e=>{if(e.length<2)return(t=e.charCodeAt(0))<128?e:t<2048?c(192|t>>>6)+c(128|63&t):c(224|t>>>12&15)+c(128|t>>>6&63)+c(128|63&t);var t=65536+1024*(e.charCodeAt(0)-55296)+(e.charCodeAt(1)-56320);return c(240|t>>>18&7)+c(128|t>>>12&63)+c(128|t>>>6&63)+c(128|63&t)},g=/[\uD800-\uDBFF][\uDC00-\uDFFFF]|[^\x00-\x7F]/g,y=e=>e.replace(g,b),v=r?e=>Buffer.from(e,"utf8").toString("base64"):o?e=>h(o.encode(e)):e=>m(y(e)),w=(e,t=!1)=>t?d(v(e)):v(e),T=/[\xC0-\xDF][\x80-\xBF]|[\xE0-\xEF][\x80-\xBF]{2}|[\xF0-\xF7][\x80-\xBF]{3}/g,C=e=>{switch(e.length){case 4:var t=((7&e.charCodeAt(0))<<18|(63&e.charCodeAt(1))<<12|(63&e.charCodeAt(2))<<6|63&e.charCodeAt(3))-65536;return c(55296+(t>>>10))+c(56320+(1023&t));case 3:return c((15&e.charCodeAt(0))<<12|(63&e.charCodeAt(1))<<6|63&e.charCodeAt(2));default:return c((31&e.charCodeAt(0))<<6|63&e.charCodeAt(1))}},x=e=>e.replace(T,C),R=e=>{if(e=e.replace(/\s+/g,""),!s.test(e))throw new TypeError("malformed base64.");e+="==".slice(2-(3&e.length));let t,a,r,n="";for(let o=0;o<e.length;)t=l[e.charAt(o++)]<<18|l[e.charAt(o++)]<<12|(a=l[e.charAt(o++)])<<6|(r=l[e.charAt(o++)]),n+=64===a?c(t>>16&255):64===r?c(t>>16&255,t>>8&255):c(t>>16&255,t>>8&255,255&t);return n},S="function"==typeof atob?e=>atob(p(e)):r?e=>Buffer.from(e,"base64").toString("binary"):R,k=r?e=>u(Buffer.from(e,"base64")):e=>u(S(e).split("").map(e=>e.charCodeAt(0))),I=r?e=>Buffer.from(e,"base64").toString("utf8"):n?e=>n.decode(k(e)):e=>x(S(e)),O=e=>p(e.replace(/[-_]/g,e=>"-"==e?"+":"/")),E=e=>I(O(e))},f029:function(e,t,a){"use strict";a.r(t),a("b866"),a("a7be"),a("f6b6");var r=a("56b3");a("8c33"),a("31c5"),a("ffda"),a("9b74"),a("991c");var n={data:function(){return{editor:null}},props:{value:{type:String,default:""},sqlStyle:{type:String,default:"default"},readOnly:{type:[Boolean,String]}},watch:{newVal:function(e,t){this.editor&&this.$emit("changeTextarea",this.editor.getValue())}},computed:{newVal:function(){if(this.editor)return this.editor.getValue()},isView:function(){return"view"===this.$route.query.filter}},mounted:function(){this.initCodeMirror()},methods:{initCodeMirror:function(){var e=this;this.editor=r.fromTextArea(this.$refs.mycode,{value:this.value,mode:"text/x-mariadb",indentWithTabs:!0,smartIndent:!0,lineNumbers:!0,matchBrackets:!0,cursorHeight:1,lineWrapping:!0,readOnly:this.isView,theme:"idea",autofocus:!0,extraKeys:{Ctrl:"autocomplete"},hintOptions:{completeSingle:!1},gutters:["myGutter","CodeMirror-linenumbers"],gutterWidth:40}),this.editor.on("inputRead",(function(){e.editor.showHint()}))},setVal:function(){this.editor&&(""===this.value?this.editor.setValue(""):this.editor.setValue(this.value))}}},o=(a("b04a"),a("2877")),i=Object(o.a)(n,(function(){var e=this,t=e._self._c;return t("div",[t("textarea",{directives:[{name:"model",rawName:"v-model",value:e.value,expression:"value"}],ref:"mycode",staticClass:"codesql",domProps:{value:e.value},on:{input:function(t){t.target.composing||(e.value=t.target.value)}}})])}),[],!1,null,"1f45bdba",null);t.default=i.exports},fa01:function(e,t,a){"use strict";a("3588")}}]);