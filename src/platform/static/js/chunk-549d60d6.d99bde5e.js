(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-549d60d6","chunk-cf01f506"],{"18d6":function(e,t,r){"use strict";r.r(t),r("8e6e"),r("456d"),r("ac6a"),r("c5f6"),r("28a5"),r("7f7f");var s=r("ade3"),o=r("2f62");function l(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,s)}return r}function a(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?l(Object(r),!0).forEach((function(t){Object(s.a)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):l(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var n={name:"procesNodeConfig",components:{adqTree:r("aad9").default},props:{procDefId:null,optType:{type:String,default:""}},computed:a({},Object(o.d)(["_userList"])),data:function(){return{preview:"",ruleForm:{type:[],userIds:[],roleIds:[],departmentIds:[],days:0,isWeekdays:1,approveMethod:!1,countersignType:0},rules:{code:[{required:!0,message:"类型编号不能为空",trigger:"blur"}],countersign:[{required:!1,validator:this.validatorNum,trigger:"change"}],pushUrl:[{required:!0,trigger:"blur",validator:this.validatorUrl}]},isView:!1,stepsList:[],stepsActive:0,stepsData:{},userList:[],userTotal:0,tagList:[],deptList:[],clickActiveData:null,defaultCheckedKeys:[],loading:!1,params:{page:1,rows:200,name:null},isCheckCountersign:!1}},created:function(){this.procDefId&&(this.loadData(),this.loadStepData()),"view"===this.optType&&(this.isView=!0)},methods:a(a({},Object(o.b)(["_AJAX"])),{},{loadData:function(){var e=this;this._AJAX({url:"webkit.tagList",method:"GET",data:{}}).then((function(t){0==t.code&&(e.tagList=t.result)}))},loadStepData:function(){var e=this;this._AJAX({url:"activiti.process.node",method:"POST",data:{procDefId:this.procDefId}}).then((function(t){0==t.code&&(e.stepsList=t.result,0===e.stepsActive&&(e.ruleForm.nodeName=t.result[0].name,e.ruleForm.nodeType="开始节点",e.$emit("get-opt-type","view")))}))},validatorNum:function(e,t,r){t>100||t<0?r(new Error("请输入一百以内的正整数")):r()},validatorUrl:function(e,t,r){t?/(http|https):\/\/[\w\-_]+(\.[\w\-_]+)+([\w\-.,@?^=%&:/~+#]*[\w\-@?^=%&/~+#])?/.test(t)?r():r(new Error("不是合法的链接")):r(new Error("链接不能为空"))},countersignChange:function(e){this.ruleForm.approveMethod=!!e},checkCountersign:function(e){e&&0!==e.length?this.isCheckCountersign=!0:(this.ruleForm.countersign=null,this.isCheckCountersign=!1)},clcikStep:function(e,t){t!==this.stepsActive&&(this.isCheckCountersign=!1,this.getStepData(e,t))},getStepData:function(e,t){var r=this;if(this.stepsData=e,this.stepsActive=t,this.ruleForm.nodeName=e.name,this.ruleForm.nodeType=0===e.nodeType?"开始节点":1===e.nodeType?"任务节点":"结束节点",this.$set(this.ruleForm,"type",[]),this.$set(this.ruleForm,"approveType",-1),this.$set(this.ruleForm,"userIds",[]),this.$set(this.ruleForm,"roleIds",[]),this.$set(this.ruleForm,"departmentIds",[]),this.$set(this.ruleForm,"approveMethod",!1),this.$set(this.ruleForm,"pushUrl",null),this.defaultCheckedKeys=[],this.$refs.tree&&this.$refs.tree.$refs.adqTree.setCheckedKeys([]),1==e.nodeType){if("add"===this.optType?this.$emit("get-opt-type","add"):this.$emit("get-opt-type","view"),this.clickActiveData=e,e.pushUrl&&(this.ruleForm.approveType=-2),this.ruleForm.days=e.days,null!=e.isWeekdays&&null!=e.isWeekdays?this.ruleForm.isWeekdays=e.isWeekdays:this.ruleForm.isWeekdays=1,this.$set(this.ruleForm,"remind",e.remind),this.$set(this.ruleForm,"countersign",e.countersign),this.$set(this.ruleForm,"countersignType",e.countersignType||0),this.$set(this.ruleForm,"pushUrl",e.pushUrl||null),e.countersign&&(this.ruleForm.approveMethod=!0,this.isCheckCountersign=!0),e.userIds&&e.userIds.length>0){this.ruleForm.type.push(0),this.ruleForm.userIds=e.userIds.split(",").map(Number);var s=this._userList&&this._userList.map((function(e){return e.id}));this.ruleForm.userIds&&this.ruleForm.userIds.forEach((function(e,t){-1==s.indexOf(Number(e))&&r.ruleForm.userIds.splice(t,1)}))}e.roleIds&&e.roleIds.length>0&&(this.ruleForm.type.push(1),this.ruleForm.roleIds=e.roleIds.split(",").map(Number)),e.departmentIds&&e.departmentIds.length>0&&(this.ruleForm.type.push(2),this.defaultCheckedKeys=e.departmentIds.split(",").map(Number)),e.depChoose&&e.depChoose&&this.ruleForm.type.push(3),e.bizMatch&&this.ruleForm.type.push(4),e.sourceChoose&&e.sourceChoose&&this.ruleForm.type.push(5),e.sourceDepChoose&&e.sourceDepChoose&&this.ruleForm.type.push(6)}else this.$emit("get-opt-type","view")},checkChange:function(e){0===e.length?(this.$set(this.ruleForm,"userIds",[]),this.$set(this.ruleForm,"roleIds",[]),this.$refs.tree&&this.$refs.tree.$refs.adqTree.setCheckedKeys([])):(-1===e.indexOf(0)&&this.$set(this.ruleForm,"userIds",[]),-1===e.indexOf(1)&&this.$set(this.ruleForm,"roleIds",[]),-1===e.indexOf(2)&&this.$refs.tree&&this.$refs.tree.$refs.adqTree.setCheckedKeys([]))},submitForm:function(){var e=this;this.$refs.formRef.validate((function(t){-1===e.ruleForm.approveType&&(e.ruleForm.pushUrl=null);var r=e,s=Object.assign({},e.ruleForm),o=null;return e.$refs.tree&&(o=e.$refs.tree.$refs.adqTree.getCheckedKeys()),s.approveMethod&&!s.countersign?r.$AudaqueToast.error({template:"请输入会签通过率",methods:{okEvent:function(){}}}):!!t&&void e._AJAX({url:"activiti.process.node.edit",method:"POST",data:{bizMatch:-1!=s.type.indexOf(4),depChoose:-1!=s.type.indexOf(3),sourceChoose:-1!=s.type.indexOf(5),sourceDepChoose:-1!=s.type.indexOf(6),nodeId:e.clickActiveData.nodeId,userIds:s.userIds.length>0?s.userIds.join(","):"",roleIds:s.roleIds.length>0?s.roleIds.join(","):"",departmentIds:s.dep=o?o.join(","):"",procDefId:e.procDefId,days:s.days,isWeekdays:s.isWeekdays,remind:s.remind,countersign:s.countersign,countersignType:s.countersignType,pushUrl:s.pushUrl}}).then((function(e){0==e.code&&r.$AudaqueToast.tip({template:"配置成功",methods:{okEvent:function(){r.loadStepData()}}})}))}))}})},i=(r("c63b"),r("2877")),c=Object(i.a)(n,(function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"process-config-edit"},["view"!==e.optType?r("div",{staticStyle:{color:"#67c23a","margin-bottom":"15px","text-align":"center"}},[e._v("\n        请确定已经提交了当前步骤的数据\n    ")]):e._e(),r("el-steps",{staticClass:"my-steps",attrs:{active:e.stepsActive,"finish-status":"success"}},e._l(e.stepsList,(function(t,s){return r("el-step",{key:s,attrs:{title:t.name},nativeOn:{click:function(r){return e.clcikStep(t,s+1)}}})})),1),r("el-form",{ref:"formRef",attrs:{model:e.ruleForm,rules:e.rules,"label-width":"90px",disabled:e.isView}},[r("el-row",{attrs:{gutter:20}},[r("el-col",{attrs:{span:12}},[r("el-form-item",{attrs:{label:"节点名称"}},[r("el-input",{attrs:{disabled:""},model:{value:e.ruleForm.nodeName,callback:function(t){e.$set(e.ruleForm,"nodeName",t)},expression:"ruleForm.nodeName"}})],1)],1),r("el-col",{attrs:{span:12}},[r("el-form-item",{attrs:{label:"业务类型"}},[r("el-input",{attrs:{disabled:""},model:{value:e.ruleForm.nodeType,callback:function(t){e.$set(e.ruleForm,"nodeType",t)},expression:"ruleForm.nodeType"}})],1)],1),1===e.stepsData.nodeType?r("el-col",{attrs:{span:24}},[r("el-form-item",{attrs:{label:"审批类型",prop:"approveType"}},[r("el-radio-group",{model:{value:e.ruleForm.approveType,callback:function(t){e.$set(e.ruleForm,"approveType",t)},expression:"ruleForm.approveType"}},[r("el-radio",{attrs:{label:-1}},[e._v("内部审批")]),r("el-radio",{attrs:{label:-2}},[e._v("外部审批")])],1)],1)],1):e._e(),-1===e.ruleForm.approveType?[1===e.stepsData.nodeType?r("el-col",{attrs:{span:24}},[r("el-form-item",{attrs:{label:"环节处理人",prop:"type"}},[r("el-checkbox-group",{on:{change:e.checkChange},model:{value:e.ruleForm.type,callback:function(t){e.$set(e.ruleForm,"type",t)},expression:"ruleForm.type"}},[r("el-checkbox",{attrs:{label:0}},[e._v("指定用户")]),r("el-checkbox",{attrs:{label:1}},[e._v("指定职位标签")]),r("el-checkbox",{attrs:{label:2}},[e._v("指定部门")]),r("el-checkbox",{attrs:{label:3}},[e._v("发起人部门负责人")]),r("el-checkbox",{attrs:{label:4}},[e._v("根据业务自动匹配人员")]),r("el-checkbox",{attrs:{label:5}},[e._v("资源所在部门负责人")]),r("el-checkbox",{attrs:{label:6}},[e._v("资源所在部门")])],1)],1)],1):e._e(),-1!=e.ruleForm.type.indexOf(0)?r("el-col",{attrs:{span:24}},[r("el-form-item",{attrs:{label:"用户",prop:"userIds"}},[r("adq-user-list-component",{attrs:{multiple:!0},model:{value:e.ruleForm.userIds,callback:function(t){e.$set(e.ruleForm,"userIds",t)},expression:"ruleForm.userIds"}})],1)],1):e._e(),-1!=e.ruleForm.type.indexOf(1)?r("el-col",{attrs:{span:24}},[r("el-form-item",{attrs:{label:"职位标签",prop:"roleIds"}},[r("el-select",{attrs:{placeholder:"请选择",multiple:"",filterable:""},model:{value:e.ruleForm.roleIds,callback:function(t){e.$set(e.ruleForm,"roleIds",t)},expression:"ruleForm.roleIds"}},e._l(e.tagList,(function(e){return r("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})})),1)],1)],1):e._e(),-1!=e.ruleForm.type.indexOf(2)?r("el-col",{attrs:{span:24}},[r("el-form-item",{attrs:{label:"部门",prop:"departmentIds"}},[r("adq-tree",{ref:"tree",attrs:{defaultCheckedKeys:e.defaultCheckedKeys,"check-strictly":!0}})],1)],1):e._e(),1===e.stepsData.nodeType?r("el-col",{attrs:{span:12}},[r("el-form-item",{staticClass:"node-the-term",attrs:{label:"节点期限",prop:"days"}},[r("el-input",{staticClass:"input-with-select",attrs:{placeholder:"请输正整数",maxlength:"3",oninput:"value=value.replace(/[^\\d]+/g,'')"},on:{change:function(t){e.ruleForm.remind=null}},model:{value:e.ruleForm.days,callback:function(t){e.$set(e.ruleForm,"days",e._n(t))},expression:"ruleForm.days"}},[r("template",{slot:"append"},[r("el-select",{attrs:{slot:"prepend",placeholder:"请选择"},slot:"prepend",model:{value:e.ruleForm.isWeekdays,callback:function(t){e.$set(e.ruleForm,"isWeekdays",t)},expression:"ruleForm.isWeekdays"}},[r("el-option",{attrs:{label:"个工作日",value:1}}),r("el-option",{attrs:{label:"个自然日",value:0}})],1)],1)],2)],1)],1):e._e(),1===e.stepsData.nodeType?r("el-col",{attrs:{span:12}},[r("el-form-item",{attrs:{label:"催办提醒",prop:"remind"}},[r("el-select",{attrs:{placeholder:"请选择"},model:{value:e.ruleForm.remind,callback:function(t){e.$set(e.ruleForm,"remind",t)},expression:"ruleForm.remind"}},[r("el-option",{attrs:{label:"12小时前",value:12}}),e.ruleForm.days>=1?r("el-option",{attrs:{label:"1天前",value:24}}):e._e(),e.ruleForm.days>=2?r("el-option",{attrs:{label:"2天前",value:48}}):e._e(),e.ruleForm.days>=3?r("el-option",{attrs:{label:"3天前",value:72}}):e._e()],1)],1)],1):e._e(),1===e.stepsData.nodeType?r("el-col",{staticClass:"approve-method-item",attrs:{span:12}},[r("el-form-item",{attrs:{label:"审批方式",prop:"countersign"}},[r("el-checkbox",{on:{change:e.checkCountersign},model:{value:e.ruleForm.approveMethod,callback:function(t){e.$set(e.ruleForm,"approveMethod",t)},expression:"ruleForm.approveMethod"}},[e._v("会签")]),e.isCheckCountersign?r("el-input",{staticClass:"percentage",attrs:{placeholder:"请输入正整数",maxlength:"3",oninput:"value=value.replace(/[^\\d]+/g,'')"},on:{change:e.countersignChange},model:{value:e.ruleForm.countersign,callback:function(t){e.$set(e.ruleForm,"countersign",e._n(t))},expression:"ruleForm.countersign"}},[r("template",{slot:"append"},[e._v("%")])],2):e._e()],1)],1):e._e(),1===e.stepsData.nodeType&&e.isCheckCountersign?r("el-col",{attrs:{span:12}},[r("el-form-item",{attrs:{label:"否决走向",prop:"countersignType"}},[r("el-radio",{attrs:{label:0},model:{value:e.ruleForm.countersignType,callback:function(t){e.$set(e.ruleForm,"countersignType",t)},expression:"ruleForm.countersignType"}},[e._v("进入下一节点")]),r("el-radio",{attrs:{label:1},model:{value:e.ruleForm.countersignType,callback:function(t){e.$set(e.ruleForm,"countersignType",t)},expression:"ruleForm.countersignType"}},[e._v("流程结束")])],1)],1):e._e()]:e._e()],2),1===e.stepsData.nodeType&&-2===e.ruleForm.approveType?[r("el-col",{attrs:{span:24}},[r("el-form-item",{attrs:{label:"审批链接",prop:"pushUrl"}},[r("el-input",{model:{value:e.ruleForm.pushUrl,callback:function(t){e.$set(e.ruleForm,"pushUrl",t)},expression:"ruleForm.pushUrl"}})],1)],1)]:e._e()],2)],1)}),[],!1,null,"7b5f620b",null);t.default=c.exports},"1e0e":function(e,t,r){var s=r("35c5");s.__esModule&&(s=s.default),"string"==typeof s&&(s=[[e.i,s,""]]),s.locals&&(e.exports=s.locals),(0,r("499e").default)("42a83a56",s,!0,{sourceMap:!1,shadowMode:!1})},"35c5":function(e,t,r){(e.exports=r("2350")(!1)).push([e.i,".adq-tree[data-v-68f82a22]{border:1px solid #dcdfe6;width:100%;z-index:99999;max-height:300px;overflow:auto}.adq-tree .filter-tree-input .query-btn[data-v-68f82a22]{background:#409eff;color:#fff}.adq-tree .adq-tree-item[data-v-68f82a22]{height:260px}.adq-tree .adq-tree-item[data-v-68f82a22] .el-loading-spinner i{font-size:30px}",""])},"87ab":function(e,t,r){var s=r("b328");s.__esModule&&(s=s.default),"string"==typeof s&&(s=[[e.i,s,""]]),s.locals&&(e.exports=s.locals),(0,r("499e").default)("141c20c0",s,!0,{sourceMap:!1,shadowMode:!1})},"9a7c":function(e,t,r){"use strict";r("1e0e")},aad9:function(e,t,r){"use strict";r.r(t),r("8e6e"),r("456d"),r("7f7f"),r("ac6a");var s=r("ade3"),o=r("2f62");function l(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,s)}return r}function a(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?l(Object(r),!0).forEach((function(t){Object(s.a)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):l(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var n={name:"adqTree",data:function(){return{filterText:"",isAllCheck:null,allIds:[],treeData:[],loading:!1}},watch:{treeData:{handler:function(e){},deep:!0}},props:{defaultCheckedKeys:{type:Array,default:function(){return[]}},defaultExpandedKeys:{type:Array,default:function(){return[]}},checkStrictly:{type:Boolean,default:!1},showCheckbox:{type:Boolean,default:!0},expandOnClickNode:{type:Boolean,default:!0},nodeKey:{type:String,default:"id"},defaultProps:{type:Object,default:function(){return{label:"name",children:"children",isLeaf:"isEnd"}}}},mounted:function(){this.loadInit()},methods:a(a({},Object(o.b)(["_AJAX"])),{},{loadInit:function(){var e=this;this.loading=!0,this._AJAX({url:"org.findRootDept",method:"GET",data:{}}).then((function(t){0===t.code&&e._AJAX({url:"org.findRootDeptTree",method:"GET",data:{deptId:t.result.id}}).then((function(t){e.treeData=[t.result],e.loading=!1,e.defaultExpandedKeys.push(t.result.id),e.allIds=[],e.loadIds([t.result])}))}))},loadIds:function(e){var t=this;e.forEach((function(e){t.allIds.push(e.id),e.children&&e.children.length>0&&t.loadIds(e.children)}))},treeIsAllCheck:function(e){e?this.$refs.adqTree.setCheckedKeys(this.allIds):this.$refs.adqTree.setCheckedKeys([])},clickInquireTreeData:function(){var e=this;this.loading=!0,setTimeout((function(){e.$refs.adqTree.filter(e.filterText),e.$nextTick().then((function(){setTimeout((function(){e.loading=!1}),500)}))}),50)},filterNode:function(e,t,r){return!e||-1!==t.name.indexOf(e)},filterNodeMethod:function(e){var t=this;!function r(s){s.map((function(s){var o=s[t.defaultProps.children];s.visible=t.filterNode(e,s),o&&o.length>0&&r(o)}))}(this.treeData)},handleNodeClick:function(e,t){this.$emit("node-click",e,t)},handleCheckChange:function(e,t){this.$emit("check-change",e,t)},handleRenderContent:function(e,t){var r=t.node,s=t.data,o=(t.store,"iconfont icondrxx95 group");return s.isPosition?o=s.leader?"iconfont iconlingdao leader":"iconfont iconyuangong people":1===r.level&&(o="iconfont icondrxx95 root"),e("span",{class:o,style:""},[" ",s.name])}})},i=(r("9a7c"),r("2877")),c=Object(i.a)(n,(function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"adq-tree"},[r("el-input",{staticClass:"filter-tree-input",attrs:{placeholder:"输入关键字进行过滤",clearable:""},model:{value:e.filterText,callback:function(t){e.filterText=t},expression:"filterText"}},[r("el-button",{staticClass:"query-btn",attrs:{slot:"append",icon:"el-icon-search"},on:{click:e.clickInquireTreeData},slot:"append"},[e._v("搜索")])],1),r("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"adq-tree-item",attrs:{"element-loading-spinner":"el-icon-loading"}},[e.showCheckbox?r("el-radio-group",{staticStyle:{"margin-left":"20px"},on:{change:e.treeIsAllCheck},model:{value:e.isAllCheck,callback:function(t){e.isAllCheck=t},expression:"isAllCheck"}},[r("el-radio-button",{attrs:{label:!0}},[e._v("全选")]),r("el-radio-button",{attrs:{label:!1}},[e._v("全不选")])],1):e._e(),r("el-tree",{ref:"adqTree",staticClass:"tree-dashed",attrs:{props:e.defaultProps,"show-checkbox":e.showCheckbox,"expand-on-click-node":e.expandOnClickNode,"node-key":e.nodeKey,"default-checked-keys":e.defaultCheckedKeys,"default-expanded-keys":e.defaultExpandedKeys,"check-strictly":e.checkStrictly,"render-content":e.handleRenderContent,"filter-node-method":e.filterNode,indent:20,data:e.treeData},on:{"node-click":e.handleNodeClick,"check-change":e.handleCheckChange}})],1)],1)}),[],!1,null,"68f82a22",null);t.default=c.exports},b328:function(e,t,r){(e.exports=r("2350")(!1)).push([e.i,".process-config-edit[data-v-7b5f620b] .my-steps{margin-bottom:20px}.process-config-edit[data-v-7b5f620b] .node-the-term .el-select{display:inline-block;width:120px}.process-config-edit[data-v-7b5f620b] .node-the-term .el-input-group__append{padding:0 10px}.process-config-edit .approve-method-item[data-v-7b5f620b] .el-checkbox-group{width:60px;display:inline-block;margin-right:15px}.process-config-edit .approve-method-item[data-v-7b5f620b] .percentage{margin-left:15px;width:calc(100% - 75px)}",""])},c63b:function(e,t,r){"use strict";r("87ab")}}]);