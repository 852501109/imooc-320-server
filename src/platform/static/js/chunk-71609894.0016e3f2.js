(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-71609894"],{3599:function(e,t,r){var a=r("d30b");a.__esModule&&(a=a.default),"string"==typeof a&&(a=[[e.i,a,""]]),a.locals&&(e.exports=a.locals),(0,r("499e").default)("552e7101",a,!0,{sourceMap:!1,shadowMode:!1})},"4d78":function(e,t,r){"use strict";r("3599")},afaa:function(e,t,r){"use strict";r.r(t),r("8e6e"),r("20d6"),r("6762"),r("7f7f"),r("28a5"),r("456d"),r("ac6a");var a=r("ade3"),i=r("2f62"),s=r("365c");function o(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,a)}return r}function l(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?o(Object(r),!0).forEach((function(t){Object(a.a)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):o(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var n={computed:l({},Object(i.d)(["upload"])),data:function(){return{imgVisible:!1,preview:"",smallIconFile:[],largeIconFile:[],ruleForm:{name:"",appId:"",mainUrl:"",remark:"",smallIcon:"",userGuide:""},rules:{name:[{required:!0,message:"系统名称不能为空",trigger:"blur"}],appId:[{required:!0,message:"接入应用不能为空",trigger:"change"}],mainUrl:[{required:!0,message:"模块URL不能为空",trigger:"blur"}],remark:[{required:!0,message:"系统介绍内容不能为空",trigger:"blur"}],userGuide:[{required:!0,validator:this.validateUserGuide,trigger:"change"}]},fileList:[],manualFileList:[],options:[],percent:null,isView:!1,token:sessionStorage.getItem("token"),defaultProps:{label:"name",disabled:"other"},myResource:[],selectOrg:{orgsid:[]},resourceList:[]}},created:function(){var e=this;this._AJAX({url:"webkit.appList",method:"GET",data:{page:1,rows:1e4}}).then((function(t){if(0==t.code){var r=[];t.rows.forEach((function(e){e.enabled&&r.push(e)})),e.options=r}})),this.$route.query.id&&this.loadData(),this.$route.query.view&&(this.isView=!0)},methods:l(l(l({},Object(i.b)(["LOADIMG","LOADOBJ","_AJAX","MYPLATFORM"])),Object(i.b)("webkit",["MODIFYAPP","ADDAPP","APPDETAIL"])),{},{getResourceList:function(){var e=this,t=!this.$route.query.view;this._AJAX({url:"webkit.displayChildrenResourceList",method:"GET",data:{filter:t}}).then((function(r){if(0==r.code){var a,i=[];a=r.result,Object.keys(a).forEach((function(r){var s=r.split("__")[1];a[r].forEach((function(r){e.treeIsDisabled(r,t,s)})),i.push({name:s,children:a[r],index:"",other:!0})})),e.resourceList=i}}))},treeIsDisabled:function(e,t,r){t||(e.other=!0),e.value="".concat(r,"_").concat(e.name),e.children&&e.children.length>0&&this.treeIsDisabled(e.children,t,r)},loadData:function(){var e=this;this._AJAX({url:"authorManage.find",method:"GET",data:{id:this.$route.query.id}}).then((function(t){if(0==t.code){var r=t.result;if(r.smallIcon&&e.LOADOBJ(r.smallIcon).then((function(t){if(t){var r="svg"===t.extName?"data:image/svg+xml;base64,"+t.contentBase64:"data:image/*;base64,"+t.contentBase64;e.fileList=[{lastModifiedDate:new Date,name:"small",url:r}]}})),r.userGuide){var a=s.default["global.viewName"]+r.userGuide+".go";e._AJAX({url:a,method:"GET",data:{}}).then((function(t){e.manualFileList=[{lastModifiedDate:new Date,name:t.result,key:r.userGuide}]}))}e.ruleForm=r}}))},handleClick:function(e){-1!=e.target.className.indexOf("el-upload__input")&&this.manualFileList.length>0?(document.querySelector(".manual-file .el-upload__input").disabled=!0,this.$AudaqueToast.tip({template:"只能上传一个文件,如需修改请删除后重新上传",methods:{okEvent:function(){}}})):document.querySelector(".manual-file .el-upload__input").disabled=!1},handleBeforeUpload:function(e){var t=["xls","xlsx","doc","docx","word","txt","pdf","ppt","pptx","jpg","png","gif","svg","zip","rar"],r=!0;if(e.name.length>40)return this.$AudaqueToast.error({template:"上传的文件名不能超过40个字符",methods:{okEvent:function(){}}}),!1;var a=e.name.split("."),i=a[a.length-1].toLowerCase();return t.includes(i)||(this.$AudaqueToast.error({template:"上传格式必须是."+t.join("、")+" 格式",methods:{okEvent:function(){}}}),r=!1),r},uploadSuccess:function(e){this.fileList=e.fileList,this.ruleForm.smallIcon=e.res.result},handlePreview:function(e){var t=document.createElement("iframe");t.src=window.urlConfig+"/file/down/"+e.key+".go",this.$refs.downDiv.append(t)},handleProgress:function(e,t,r){this.percent=e.percent},handleRemove:function(e,t){this.manualFileList=t},handleSuccess:function(e,t,r){0===e.code?(this.manualFileList=[t],this.ruleForm.userGuide=e.result):this.$AudaqueToast.error({template:e.msg,methods:{okEvent:function(){}}})},handleError:function(e,t,r){this.$AudaqueToast.error({template:"文件上传失败，请检查文件类型或大小是否合规",methods:{okEvent:function(){}}})},validateUserGuide:function(e,t,r){this.manualFileList&&this.manualFileList.length>0?r():(r(new Error(" ")),this.$AudaqueToast.error({template:"请上传用户手册",methods:{okEvent:function(){}}}))},treeCheckChange:function(e,t,r){var a=this.$refs.tree.getCheckedKeys();a.splice(a.findIndex((function(t){return t===e.value})),1),this.selectOrg.orgsid=a;var i=this.selectOrg.orgsid.indexOf(e.value);i<0&&this.selectOrg.orgsid.length>=1&&t?(this.$message({message:"只能选择一个选项！",type:"error",showClose:!0}),this.$refs.tree.setChecked(e,!1)):0===this.selectOrg.orgsid.length&&t?(this.selectOrg.orgsid=[],this.selectOrg.orgsid.push(e.value)):i>=0&&1===this.selectOrg.orgsid.length&&!t&&(this.selectOrg.orgsid=[])},submitForm:function(){var e=this;this.$refs.ruleForm.validate((function(t){if(!t)return!1;var r=e,a=l({},e.ruleForm);e.$route.query.id?e._AJAX({url:"authorManage.modify",method:"POST",data:a}).then((function(t){e.$AudaqueToast.tip({template:"修改成功",methods:{okEvent:function(){r.$router.go(-1),r.MYPLATFORM({page:1,row:1e3})}}})})):e._AJAX({url:"authorManage.add",method:"POST",data:a}).then((function(t){e.$AudaqueToast.tip({template:"新增成功",methods:{okEvent:function(){r.$router.go(-1),r.MYPLATFORM({page:1,row:1e3})}}})}))}))}})},u=(r("4d78"),r("2877")),d=Object(u.a)(n,(function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("audaque-detail-form-page",{staticClass:"system-config-edit",attrs:{title:e.$route.query.id?e.isView?"查看系统":"编辑系统":"新增系统","opt-type":e.$route.query.optType},on:{"submit-click":e.submitForm}},[r("el-form",{ref:"ruleForm",attrs:{model:e.ruleForm,"status-icon":"",rules:e.rules,"label-width":"120px",disabled:e.isView}},[r("el-form-item",{attrs:{label:"系统名称",prop:"name"}},[r("el-input",{attrs:{maxlength:"24","show-word-limit":""},model:{value:e.ruleForm.name,callback:function(t){e.$set(e.ruleForm,"name",t)},expression:"ruleForm.name"}})],1),r("el-form-item",{attrs:{label:"接入应用",prop:"appId"}},[r("el-select",{attrs:{clearable:"",placeholder:"",filterable:""},model:{value:e.ruleForm.appId,callback:function(t){e.$set(e.ruleForm,"appId",t)},expression:"ruleForm.appId"}},e._l(e.options,(function(e){return r("el-option",{key:e.id,attrs:{label:e.appName,value:e.id}})})),1)],1),r("el-form-item",{attrs:{label:"模块URL",prop:"mainUrl"}},[r("el-input",{attrs:{maxlength:"200","show-word-limit":""},model:{value:e.ruleForm.mainUrl,callback:function(t){e.$set(e.ruleForm,"mainUrl",t)},expression:"ruleForm.mainUrl"}})],1),r("el-form-item",{attrs:{label:"系统介绍内容",prop:"remark"}},[r("el-input",{staticClass:"system-introduction",attrs:{type:"textarea",autosize:"",placeholder:"",maxlength:"200","show-word-limit":""},model:{value:e.ruleForm.remark,callback:function(t){e.$set(e.ruleForm,"remark",t)},expression:"ruleForm.remark"}}),r("div",{staticClass:"clear"})],1),r("el-form-item",{attrs:{label:"系统图标"}},[r("adq-upload-img",{attrs:{disabled:e.isView,action:e.upload,"file-list":e.fileList},on:{uploadSuccess:e.uploadSuccess,closeFileList:function(){e.fileList=[],e.ruleForm.smallIcon=""}}})],1),r("el-form-item",{attrs:{label:"用户资料",prop:"userGuide"}},[r("div",[r("el-upload",{staticClass:"manual-file",attrs:{action:e.upload,"on-progress":e.handleProgress,"on-remove":e.handleRemove,"on-success":e.handleSuccess,"on-error":e.handleError,"on-preview":e.handlePreview,"before-upload":e.handleBeforeUpload,limit:1,headers:e.publics.ajaxHeaders(),"file-list":e.manualFileList},nativeOn:{click:function(t){return e.handleClick.apply(null,arguments)}}},[e.isView?e._e():r("el-button",{attrs:{size:"small",type:"primary"}},[e._v("点击上传")]),r("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"只能上传 xls, xlsx, doc, docx, word, txt, pdf, ppt, pptx, jpg, png, gif, svg, zip, rar 格式的文件",placement:"right"}},[r("span",{staticClass:"el-icon-question prompt"})])],1)],1)])],1),r("div",{staticClass:"clear"}),r("div",{ref:"downDiv",staticStyle:{display:"none"}})],1)}),[],!1,null,"625ac78a",null);t.default=d.exports},d30b:function(e,t,r){(e.exports=r("2350")(!1)).push([e.i,"[data-v-625ac78a] .resource{border:1px solid #e1dfdc}[data-v-625ac78a] .submit-wrap{text-align:center;margin-top:.2rem}[data-v-625ac78a] .el-tree{height:3.5rem;overflow-y:scroll}.system-config-edit[data-v-625ac78a] .system-introduction{min-height:90px!important;height:auto!important}.system-config-edit[data-v-625ac78a] .system-introduction /deep/ .el-textarea__inner{min-height:90px!important}.system-config-edit[data-v-625ac78a] .manual-file{width:100%}.system-config-edit[data-v-625ac78a] .manual-file /deep/ .el-upload-list__item-name{line-height:40px}.system-config-edit[data-v-625ac78a] .manual-file .prompt{width:20px;height:20px;margin-left:20px}",""])}}]);