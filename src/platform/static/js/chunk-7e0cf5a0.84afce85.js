(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-7e0cf5a0","chunk-23da84a2"],{4096:function(e,r,t){"use strict";t("5ad6")},4257:function(e,r,t){(e.exports=t("2350")(!1)).push([e.i,"[data-v-c25919a0] .CodeMirror{color:#000;direction:ltr;line-height:22px;border:1px solid #e7e7e7}.CodeMirror-hints[data-v-c25919a0]{z-index:9999!important}[data-v-c25919a0] .CodeMirror pre.CodeMirror-placeholder{color:#929292;font-size:15px}",""])},"5ad6":function(e,r,t){var o=t("4257");o.__esModule&&(o=o.default),"string"==typeof o&&(o=[[e.i,o,""]]),o.locals&&(e.exports=o.locals),(0,t("499e").default)("2865ddec",o,!0,{sourceMap:!1,shadowMode:!1})},af8d:function(e,r,t){"use strict";t.r(r),t("b866"),t("a7be"),t("f6b6"),t("d7d5");var o=t("db05"),a=t.n(o),n=t("56b3");t("8c33"),t("31c5"),t("ffda"),t("9b74"),t("991c");var i={data:function(){return{editor:null}},props:{value:{type:String,default:""},sqlStyle:{type:String,default:"default"},readOnly:{type:[Boolean,String]},placeholder:{type:String,default:""}},watch:{newVal:function(e,r){this.editor&&this.$emit("changeTextarea",this.editor.getValue())}},computed:{newVal:function(){if(this.editor)return this.editor.getValue()},isView:function(){return"view"===this.$route.query.filter}},mounted:function(){this.initCodeMirror()},methods:{formaterSql:function(){this.editor.setValue(a.a.format(this.editor.getValue()))},initCodeMirror:function(){var e=this,r=this;this.editor=n.fromTextArea(this.$refs.mycode,{value:this.value,mode:"text/x-mariadb",indentWithTabs:!0,smartIndent:!0,lineNumbers:!0,matchBrackets:!0,cursorHeight:1,lineWrapping:!0,readOnly:this.isView,theme:"idea",autofocus:!0,extraKeys:{Ctrl:"autocomplete"},hintOptions:{completeSingle:!1},gutters:["myGutter","CodeMirror-linenumbers"],gutterWidth:40}),this.editor.on("inputRead",(function(){e.editor.showHint()})),this.editor.setOption("extraKeys",{"Ctrl-D":function(e){r.formaterSql()}})},setVal:function(){this.editor&&(""===this.value?this.editor.setValue(""):this.editor.setValue(this.value))}}},l=(t("4096"),t("2877")),c=Object(l.a)(i,(function(){var e=this,r=e._self._c;return r("div",{staticStyle:{border:"1px solid #409eff"}},[r("textarea",{directives:[{name:"model",rawName:"v-model",value:e.value,expression:"value"}],ref:"mycode",staticClass:"codesql",attrs:{placeholder:e.placeholder},domProps:{value:e.value},on:{input:function(r){r.target.composing||(e.value=r.target.value)}}})])}),[],!1,null,"c25919a0",null);r.default=c.exports},b866:function(e,r,t){var o=t("d131");o.__esModule&&(o=o.default),"string"==typeof o&&(o=[[e.i,o,""]]),o.locals&&(e.exports=o.locals),(0,t("499e").default)("3875f97e",o,!0,{sourceMap:!1,shadowMode:!1})},d131:function(e,r,t){(e.exports=t("2350")(!1)).push([e.i,".cm-s-idea span.cm-meta{color:olive}.cm-s-idea span.cm-number{color:#00f}.cm-s-idea span.cm-keyword{line-height:1em;font-weight:700;color:navy}.cm-s-idea span.cm-atom{font-weight:700;color:navy}.cm-s-idea span.cm-def,.cm-s-idea span.cm-operator,.cm-s-idea span.cm-property,.cm-s-idea span.cm-type,.cm-s-idea span.cm-variable,.cm-s-idea span.cm-variable-2,.cm-s-idea span.cm-variable-3{color:#000}.cm-s-idea span.cm-comment{color:grey}.cm-s-idea span.cm-string,.cm-s-idea span.cm-string-2{color:green}.cm-s-idea span.cm-qualifier{color:#555}.cm-s-idea span.cm-error{color:red}.cm-s-idea span.cm-attribute{color:#00f}.cm-s-idea span.cm-tag{color:navy}.cm-s-idea span.cm-link{color:#00f}.cm-s-idea .CodeMirror-activeline-background{background:#fffae3}.cm-s-idea span.cm-builtin{color:#30a}.cm-s-idea span.cm-bracket{color:#cc7}.cm-s-idea{font-family:Consolas,Menlo,Monaco,Lucida Console,Liberation Mono,DejaVu Sans Mono,Bitstream Vera Sans Mono,Courier New,monospace,serif}.cm-s-idea .CodeMirror-matchingbracket{outline:1px solid grey;color:#000!important}.CodeMirror-hints.idea{font-family:Menlo,Monaco,Consolas,Courier New,monospace;color:#616569;background-color:#ebf3fd!important}.CodeMirror-hints.idea .CodeMirror-hint-active{background-color:#a2b8c9!important;color:#5c6065!important}",""])},d7d5:function(e,r,t){!function(e){function r(e){e.state.placeholder&&(e.state.placeholder.parentNode.removeChild(e.state.placeholder),e.state.placeholder=null)}function t(e){r(e);var t=e.state.placeholder=document.createElement("pre");t.style.cssText="height: 0; overflow: visible",t.style.direction=e.getOption("direction"),t.className="CodeMirror-placeholder CodeMirror-line-like";var o=e.getOption("placeholder");"string"==typeof o&&(o=document.createTextNode(o)),t.appendChild(o),e.display.lineSpace.insertBefore(t,e.display.lineSpace.firstChild)}function o(e){n(e)&&t(e)}function a(e){var o=e.getWrapperElement(),a=n(e);o.className=o.className.replace(" CodeMirror-empty","")+(a?" CodeMirror-empty":""),a?t(e):r(e)}function n(e){return 1===e.lineCount()&&""===e.getLine(0)}e.defineOption("placeholder","",(function(n,i,l){var c=l&&l!=e.Init;if(i&&!c)n.on("blur",o),n.on("change",a),n.on("swapDoc",a),e.on(n.getInputField(),"compositionupdate",n.state.placeholderCompose=function(){!function(e){setTimeout((function(){var o=!1;if(1==e.lineCount()){var a=e.getInputField();o="TEXTAREA"==a.nodeName?!e.getLine(0).length:!/[^\u200b]/.test(a.querySelector(".CodeMirror-line").textContent)}o?t(e):r(e)}),20)}(n)}),a(n);else if(!i&&c){n.off("blur",o),n.off("change",a),n.off("swapDoc",a),e.off(n.getInputField(),"compositionupdate",n.state.placeholderCompose),r(n);var s=n.getWrapperElement();s.className=s.className.replace(" CodeMirror-empty","")}i&&!n.hasFocus()&&o(n)}))}(t("56b3"))},e159:function(e,r,t){"use strict";t.r(r),t("7f7f"),t("8e6e"),t("ac6a"),t("456d"),t("7514");var o=t("ade3"),a=t("2f62"),n=t("af8d"),i=t("db05"),l=t.n(i);function c(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,o)}return t}function s(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?c(Object(t),!0).forEach((function(r){Object(o.a)(e,r,t[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):c(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}))}return e}var d={computed:s({},Object(a.d)("develop",["domainDBSourceList","columnList","tableList","domainDBSourceListChange"])),props:{queryData:{type:Object,default:function(){}},stepActiveId:{type:String,default:""}},components:{SqlEditor:n.default},watch:{queryData:function(){this.$route.query.id&&(this.ruleForm={connId:this.queryData.connId,srcTableId:this.queryData.srcTabId,srcColName:this.queryData.srcColName,pkColNameCn:this.queryData.colDesc,pkColName:this.queryData.colName,srcId:"",pkColExp:decodeURI(this.queryData.colExpress)},this.GET_TABLE_LIST({connId:this.queryData.connId}),this.GET_COLUMN_LIST({connId:this.queryData.connId,tableName:this.queryData.srcTabName}))},domainDBSourceListChange:function(){this.ruleForm.connId="",this.ruleForm.srcTableId="",this.ruleForm.srcColName=""}},data:function(){return{placeholder:"请输入主键计算逻辑，比如FSELSE_.DIM.customer.borndate > 1995，输入ctrl + d可格式化",ruleForm:{connId:"",srcTableId:"",srcTableName:"",srcColName:"",pkColNameCn:"",pkColName:"",pkColExp:"",srcId:""},rules:{connId:[{required:!0,message:"请选择数据源",trigger:"change"}],srcTableId:[{required:!0,message:"请选择来源主表",trigger:"change"}],srcColName:[{required:!0,message:"请选择主键来源字段",trigger:"change"}],pkColNameCn:[{required:!0,message:"请输入主键名称",trigger:"blur"}],pkColName:[{required:!0,validator:this.checkDimName,trigger:"change"}],pkColExp:[{required:!0,message:"请输入主键计算逻辑",trigger:"blur"}]}}},methods:s(s({},Object(a.b)("develop",["GET_COLUMN_LIST","GET_TABLE_LIST"])),{},{changeColumn:function(e){this.ruleForm.srcColName="";var r=this.tableList.find((function(r){return r.id===e})).tableName;this.ruleForm.srcTableName=r,this.GET_COLUMN_LIST({connId:this.ruleForm.connId,tableName:r})},checkDimName:function(e,r,t){return r?/^[a-zA-Z].*$/.test(r)?void t():t(new Error("必须以英文开头")):t(new Error("主键英文不可为空"))},changeColName:function(){this.initExp()},initExp:function(){var e=this;if(""===this.ruleForm.pkColExp&&this.ruleForm.srcTableId&&this.ruleForm.srcColName){var r=this.tableList.find((function(r){return r.id===e.ruleForm.srcTableId})).tableName;this.$refs.sqleditor.editor.setValue("select ".concat(this.ruleForm.srcColName," from ").concat(r))}},changeTextarea:function(e){this.$set(this.ruleForm,"pkColExp",e)},changeTable:function(e){this.ruleForm.srcTableId="",this.ruleForm.srcColName="",this.GET_TABLE_LIST({connId:e})},generateSql:function(){},formaterSql:function(){var e=this.$refs.sqleditor;e.editor.setValue(l.a.format(e.editor.getValue()))},submitForm:function(){var e=this;return new Promise((function(r,t){e.$refs.ruleForm2.validate((function(o){if(!o)return t("submit"),!1;e.ruleForm.srcId=e.domainDBSourceList.find((function(r){return r.connId===e.ruleForm.connId})).srcId;var a=Object.assign(e.ruleForm);a.pkColExp=encodeURI(a.pkColExp),r(a)}))}))},resetForm:function(){this.$refs.ruleForm2.resetFields()}})},u=t("2877"),m=Object(u.a)(d,(function(){var e=this,r=e._self._c;return r("div",[r("el-form",{ref:"ruleForm2",staticClass:"demo-ruleForm",attrs:{model:e.ruleForm,rules:e.rules,"label-width":"140px",disabled:"view"===e.$route.query.filter}},[r("el-form-item",{attrs:{label:"数据源",prop:"connId"}},[r("el-select",{attrs:{placeholder:"请选择",disabled:"edit"===e.$route.query.filter},on:{change:e.changeTable},model:{value:e.ruleForm.connId,callback:function(r){e.$set(e.ruleForm,"connId",r)},expression:"ruleForm.connId"}},e._l(e.domainDBSourceList,(function(e,t){return r("el-option",{key:t,attrs:{label:e.name,value:e.connId}})})),1)],1),r("el-form-item",{attrs:{label:"来源主表",prop:"srcTableId"}},[r("el-select",{attrs:{placeholder:"请选择",disabled:"edit"===e.$route.query.filter},on:{change:e.changeColumn},model:{value:e.ruleForm.srcTableId,callback:function(r){e.$set(e.ruleForm,"srcTableId",r)},expression:"ruleForm.srcTableId"}},e._l(e.tableList,(function(e,t){return r("el-option",{key:t,attrs:{label:e.tableName,value:e.id}})})),1)],1),r("el-form-item",{attrs:{label:"主键来源字段",prop:"srcColName"}},[r("el-select",{attrs:{placeholder:"请选择"},on:{change:e.changeColName},model:{value:e.ruleForm.srcColName,callback:function(r){e.$set(e.ruleForm,"srcColName",r)},expression:"ruleForm.srcColName"}},e._l(e.columnList,(function(e,t){return r("el-option",{key:t,attrs:{label:e.colName,value:e.colName}})})),1)],1),r("el-form-item",{attrs:{label:"主键名称",prop:"pkColNameCn",placeholder:"请输入"}},[r("el-input",{model:{value:e.ruleForm.pkColNameCn,callback:function(r){e.$set(e.ruleForm,"pkColNameCn",r)},expression:"ruleForm.pkColNameCn"}})],1),r("el-form-item",{attrs:{label:"主键英文",prop:"pkColName",placeholder:"请输入"}},[r("el-input",{model:{value:e.ruleForm.pkColName,callback:function(r){e.$set(e.ruleForm,"pkColName",r)},expression:"ruleForm.pkColName"}})],1),r("el-form-item",{attrs:{label:"主键计算逻辑",prop:"pkColExp",placeholder:"请输入"}},["primaryKeyDimension"===e.stepActiveId?r("div",[r("SqlEditor",{ref:"sqleditor",attrs:{value:e.ruleForm.pkColExp,placeholder:e.placeholder},on:{changeTextarea:function(r){return e.changeTextarea(r)}}})],1):e._e()])],1)],1)}),[],!1,null,"1f5ba705",null);r.default=m.exports}}]);