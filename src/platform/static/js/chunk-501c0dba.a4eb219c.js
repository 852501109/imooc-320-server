(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-501c0dba","chunk-e0db7fb8","chunk-6d5fa95e","chunk-3fbc9be4","chunk-743b519a","chunk-10c1407e","chunk-148e3626","chunk-2d21ef06"],{"0300":function(e,t,a){"use strict";a.r(t),a("ac4d"),a("8a81"),a("1c4c"),a("6b54"),a("8e6e"),a("456d"),a("7f7f"),a("5df3"),a("4f7f"),a("7514");var r=a("ade3"),n=(a("6762"),a("2fdb"),a("ac6a"),a("8615"),a("1794")),o=a("2f62"),i=a("db05"),l=a.n(i),s=a("e762"),c=a("f029");function u(e,t){var a="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!a){if(Array.isArray(e)||(a=function(e,t){if(e){if("string"==typeof e)return d(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);return"Object"===a&&e.constructor&&(a=e.constructor.name),"Map"===a||"Set"===a?Array.from(e):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?d(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){a&&(e=a);var r=0,n=function(){};return{s:n,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,i=!0,l=!1;return{s:function(){a=a.call(e)},n:function(){var e=a.next();return i=e.done,e},e:function(e){l=!0,o=e},f:function(){try{i||null==a.return||a.return()}finally{if(l)throw o}}}}function d(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function p(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function m(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?p(Object(a),!0).forEach((function(t){Object(r.a)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):p(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var f={props:["selectParam"],watch:{newSelectParam:{handler:function(e){if(!this.$store.state.fusionTask.isLoading){if(e.sourceRows.length<this.originSourceRow.sourceRows.length){var t={sourceRows:e.sourceRows};this.originSourceRow=this.deepClone(t);var a=this.deepClone(e);return this.ids=a.sourceRows.map((function(e){return e.alreadySelectSourceTableValue})),this.form.allFiledMap=Object.values(a.sourceRows.map((function(e){return e.alreadySelectSourceTable}))).flat(),this.form.allFiledMap.forEach((function(e){e.isDot=!1})),void this.getColumn(this.ids,a.alreadySelectTargetTable[0].id)}var r={sourceRows:e.sourceRows};if(this.originSourceRow=this.deepClone(r),!this.isHandleStep&&e.alreadySelectTargetTable.length>0&&e.sourceRows.every((function(e){return e.alreadySelectSourceTable.length>0}))){var n=this.deepClone(e);this.targetName=n.alreadySelectTargetTable[0].tableName,this.ids=n.sourceRows.map((function(e){return e.alreadySelectSourceTableValue}));var o=this.form.allFiledMap.map((function(e){return e.id})),i=Object.values(n.sourceRows.map((function(e){return e.alreadySelectSourceTable}))).flat().filter((function(e){return!o.includes(e.id)}));this.form.allFiledMap=this.form.allFiledMap.concat(i),this.form.allFiledMap.forEach((function(e){e.isDot=!1})),this.getColumn(this.ids,n.alreadySelectTargetTable[0].id)}}},deep:!0}},data:function(){return{selectedColumnNames:[],sourceLength:0,echoSourceIds:[],originSourceRow:{},forceUpdate:!0,ids:[],isHandleStep:!1,stepId:"",form:{allFiledMap:[]},basicInfoForm:{sqlMain:""},sourceName:[],targetName:"",targetColumnOptions:[],showGovernanceAuditRules:!1,currentType:{type:"",index:""},currentGAId:"",activeName:"first0",sqlValue:"",autoMapValue:!1,initReportValue:!1,param:{},rules:{sourceDatabase:[{required:!0,message:"请选择",trigger:"change"}]},tableHead:[],alreadySelectTargetTable:[],insertRequestDTOs:[],echoData:[]}},created:function(){var e={sourceRows:this.selectParam.sourceRows};this.originSourceRow=this.deepClone(e)},components:{governanceAuditRules:n.default,SqlEditor:c.default},computed:{newSelectParam:function(){return m({},this.selectParam)}},methods:m(m({},Object(o.b)(["_AJAX"])),{},{tabWidth:function(e,t){return e!==t-1?{width:"20%"}:{width:"100%"}},handleStep:function(e){var t=this;this.isHandleStep=!0,setTimeout((function(){t.$store.commit("fusionTask/changeLoading",!0)})),this._AJAX({url:"stepDwd.echo",method:"GET",data:{stepId:e}}).then((function(e){t.targetName=t.selectParam.alreadySelectTargetTable[0].tableName,t.ids=t.selectParam.sourceRows.map((function(e){return e.alreadySelectSourceTableValue})).flat(),t.form.allFiledMap=Object.values(t.selectParam.sourceRows.map((function(e){return e.alreadySelectSourceTable}))).flat(),t.form.allFiledMap.forEach((function(e){e.isDot=!1})),t.getColumn(t.ids,t.selectParam.alreadySelectTargetTable[0].id).then((function(){t.forceUpdate=!1,t.form.allFiledMap.forEach((function(a,r){a.hasOwnProperty("param")||(a.param={}),a.sqlMain=e[r].taskStepDetail.sqlContent,a.whereCondition=e[r].taskStepDetail.whereCondition,a.param.tableInfo.forEach((function(t,a){var n=e[r].taskRuleRelVo.targetColumnId[a]||"";t.targetValue=n})),setTimeout((function(){t.forceUpdate=!0}),0),t.selectedColumnNames=e[r].taskRuleRelVo.targetColumnName}))})),t.isHandleStep=!1,setTimeout((function(){t.$store.commit("fusionTask/changeLoading",!1)}))}))},deepClone:function(e){return JSON.parse(JSON.stringify(e))},handleChange:function(e,t){this.$set(this.form.allFiledMap[t],"sqlMain",""),e.isDot=!0,this.$forceUpdate();var a=this.targetColumnOptions.find((function(a){return a.id===e.param.tableInfo[t].targetValue}));a&&this.selectedColumnNames.push(a.columnName)},createSql:function(e,t){var a=this,r=e.param.tableInfo.filter((function(e){return""!=e.targetValue&&null!=e.targetValue})).map((function(e){return e.targetValue}));new Set(r).size!==r.length?this.$message.error("目标表的表字段不允许重复"):e.param.tableInfo.every((function(e){return""===e.targetValue}))?this.$message.error("目标表字段不能为空"):(this.$set(this.form.allFiledMap[t],"sqlMain",""),this._AJAX({url:"stepDwd.createSql",method:"POST",data:{taskRuleRelVo:{taskId:this.$route.query.taskId,sourceColumnId:e.param.tableInfo.map((function(e){return e.id})),targetColumnId:e.param.tableInfo.map((function(e){return e.targetValue})),sourceColumnName:e.param.tableInfo.map((function(e){return e.name})),targetColumnName:this.selectedColumnNames},taskStep:{taskId:this.$route.query.taskId,generateQualityReport:0,generateStdtestReport:0,generateSensitiveReport:0},taskStepDetail:{stepId:this.$route.query.taskId,sourceTableId:e.id,targetTableId:this.selectParam.alreadySelectTargetTable[0].id,sqlContent:e.sqlMain,whereCondition:Object(s.b)(e.whereCondition)}}}).then((function(r){a.$set(a.form.allFiledMap[t],"sqlMain",r.result[0].sql);var n="sqleditor"+t;a.$refs[n][0].setVal(),a.activeName="",setTimeout((function(){a.activeName="second"+t}),100),e.isDot=!1,a.$message.success("生成SQL成功！")})))},changeTextarea:function(e,t,a){this.$set(this.form.allFiledMap[a],"sqlMain",e)},formaterSql:function(e,t){var a=this.$refs["sqleditor"+t][0];a.editor.setValue(l.a.format(a.editor.getValue()))},Automaticmapping:function(e,t,a){var r=this,n=this.form.allFiledMap[a].filedList.filter((function(e){return null!==e.sourceColumnId})).map((function(e){return e.id})),o=this.form.allFiledMap[a].filedList.filter((function(e){return n.includes(e.id)})),i=o.map((function(e){return e.id})),l=o.map((function(e){return e.sourceColumnId})),s=this.form.allFiledMap[a].filedList.filter((function(e){return l.includes(e.id)}));e?t.param.tableInfo.forEach((function(e){if(n.length>0){if(l.includes(e.id))e.targetValue="",r.selectedColumnNames.push("");else{var t=r.targetColumnOptions.find((function(t){return t.columnName===e.name}));e.targetValue=t?t.id:"",r.selectedColumnNames.push(e.name)}i.includes(e.id)&&o.forEach((function(t){e.id==t.id&&s.forEach((function(a){if(a.id==t.sourceColumnId){var n=r.targetColumnOptions.find((function(e){return e.columnName==a.columnName}));e.targetValue=n.id,r.selectedColumnNames.push(n.columnName)}}))}))}else{var a=r.targetColumnOptions.find((function(t){return t.columnName===e.name}));e.targetValue=a?a.id:"",r.selectedColumnNames.push(e.name)}})):t.param.tableInfo.forEach((function(e){e.targetValue="",e.sourceColumnId=""}))},getColumn:function(e,t){var a=this;return new Promise((function(e,r){a._AJAX({url:"stepDwd.getOriginOrTargetColumn",method:"GET",data:{sourceTableIds:a.ids.join(","),targetTableId:t}}).then((function(r){a.form.allFiledMap.forEach((function(e,t){void 0===e.sqlMain&&(e.filedList=Object.values(r[e.id]),e.sqlMain="",a.$set(a.form.allFiledMap[t],"autoMapValue",!1),a.$set(a.form.allFiledMap[t],"whereCondition",""),e.param={tableData:[],growField:"",tableInfo:Object.values(r[e.id]).map((function(e){return{id:e.id,name:e.columnName,targetValue:"",ruleId:"",catCode:""}}))})})),a.targetColumnOptions=r[t],e(r)}))}))},selectGATable:function(e){this.currentGAId=e,this.showGovernanceAuditRules=!0},handleClick:function(){},createTbleAuto:function(){var e=this;this.$nextTick((function(){if(e.selectParam.autoCreate&&!e.selectParam.sourceRows.find((function(e){return 0===e.alreadySelectSourceTableValue.length}))&&0!==e.selectParam.alreadySelectTargetTable.length){e.param.tableData=[],e.tableHead=[],e.selectParam.sourceRows.forEach((function(t){var a=t.alreadySelectSourceTableValue[0],r=t.alreadySelectSourceTable.find((function(e){return e.id===a})).slot1;e.tableHead.push(r)})),e.selectParam.alreadySelectTargetTableValue.forEach((function(t){var a=e.selectParam.alreadySelectTargetTable.find((function(e){return e.id===t})).slot1;e.tableHead.push(a)}));var t={};e.tableHead.forEach((function(e){t[e]=1,t.options=[{value:1,label:"字段1"},{value:2,label:"字段2"}],t.selectValue="",t.id=1,t.ruletypes=[]})),e.param.tableData.push(t),e.$refs.tableData&&e.$refs.tableData.doLayout()}}))},initGA:function(e){var t=this;this.param.tableData.find((function(e){return e.id===t.currentGAId})).ruletypes=e.map((function(e){return e.slot1})),this.showGovernanceAuditRules=!1},delGA:function(e){this.param.tableData.find((function(t){return t.id===e})).ruletypes=[]},next:function(e){var t=this;return this.stepId=e,new Promise((function(a,r){var n,o=t.deepClone(t.form),i=new Set,l=u(o.allFiledMap);try{for(l.s();!(n=l.n()).done;){var c=n.value;i.clear();var d={taskRuleRelVo:{taskId:t.$route.query.taskId,sourceColumnId:c.param.tableInfo.map((function(e){return e.id})),targetColumnId:c.param.tableInfo.map((function(e){return e.targetValue})),stepId:t.stepId},taskStep:{taskId:t.$route.query.taskId,generateQualityReport:0,generateStdtestReport:0,generateSensitiveReport:0},taskStepDetail:{sourceTableId:c.id,targetTableId:t.selectParam.alreadySelectTargetTable[0].id,sqlContent:Object(s.b)(c.sqlMain),whereCondition:Object(s.b)(c.whereCondition)}};t.insertRequestDTOs.push(d);var p,m=!1,f=u(c.param.tableInfo.map((function(e){return e.targetValue})));try{for(f.s();!(p=f.n()).done;){var h=p.value;if(h&&i.has(h)){m=!0;break}i.add(h)}}catch(e){f.e(e)}finally{f.f()}if(m)return t.$message.error("目标表字段不能重复"),void(t.insertRequestDTOs=[]);if(c.param.tableInfo.map((function(e){return e.targetValue})).every((function(e){return""===e||null===e})))return t.$message.error("目标字段不能为空"),void(t.insertRequestDTOs=[]);if(!c.sqlMain)return t.$message.error("sql不能为空"),void(t.insertRequestDTOs=[])}}catch(e){l.e(e)}finally{l.f()}t.$refs.stepBaseLayerForm.validate((function(n){n?(t.$store.commit("fusionTask/changeLoading",!0),""===e?t._AJAX({url:"stepDwd.insert",method:"POST",data:JSON.stringify(t.insertRequestDTOs),headers:{"Content-Type":"application/json"}}).then((function(e){a(e)})):t._AJAX({url:"stepDwd.update",method:"POST",data:JSON.stringify(t.insertRequestDTOs),headers:{"Content-Type":"application/json"}}).then((function(e){a(e)}))):r(n)}))}))},submit:function(e){var t=this;return this.stepId=e,new Promise((function(a,r){var n,o=t.deepClone(t.form),i=new Set,l=u(o.allFiledMap);try{for(l.s();!(n=l.n()).done;){var c=n.value;i.clear();var d={taskRuleRelVo:{taskId:t.$route.query.taskId,sourceColumnId:c.param.tableInfo.map((function(e){return e.id})),targetColumnId:c.param.tableInfo.map((function(e){return e.targetValue})),stepId:t.stepId},taskStep:{taskId:t.$route.query.taskId,generateQualityReport:0,generateStdtestReport:0,generateSensitiveReport:0},taskStepDetail:{sourceTableId:c.id,targetTableId:t.selectParam.alreadySelectTargetTable[0].id,sqlContent:Object(s.b)(c.sqlMain),whereCondition:Object(s.b)(c.whereCondition)}};t.insertRequestDTOs.push(d);var p,m=!1,f=u(c.param.tableInfo.map((function(e){return e.targetValue})));try{for(f.s();!(p=f.n()).done;){var h=p.value;if(h&&i.has(h)){m=!0;break}i.add(h)}}catch(e){f.e(e)}finally{f.f()}if(m)return t.$message.error("目标表字段不能重复"),void(t.insertRequestDTOs=[]);if(c.param.tableInfo.map((function(e){return e.targetValue})).every((function(e){return""===e||null===e})))return t.$message.error("目标字段不能为空"),void(t.insertRequestDTOs=[]);if(!c.sqlMain)return t.$message.error("sql不能为空"),void(t.insertRequestDTOs=[])}}catch(e){l.e(e)}finally{l.f()}t.$refs.stepBaseLayerForm.validate((function(n){n?(t.$store.commit("fusionTask/changeLoading",!0),""===e?t._AJAX({url:"stepDwd.submitInsert",method:"POST",data:JSON.stringify(t.insertRequestDTOs),headers:{"Content-Type":"application/json"}}).then((function(e){a(e),setTimeout((function(){t.$store.commit("fusionTask/changeLoading",!1)}))})):t._AJAX({url:"stepDwd.submitUpdate",method:"POST",data:JSON.stringify(t.insertRequestDTOs),headers:{"Content-Type":"application/json"}}).then((function(e){a(e),setTimeout((function(){t.$store.commit("fusionTask/changeLoading",!1)}))}))):r(n)}))}))}})},h=(a("ee74"),a("2877")),b=Object(h.a)(f,(function(){var e=this,t=e._self._c;return t("div",[t("el-form",{ref:"stepBaseLayerForm",staticClass:"form-item",attrs:{model:e.form,"label-width":"120px",rules:e.rules,"label-position":"left",disabled:"view"===e.$route.query.filter}},[t("div",{staticClass:"tab-container"},e._l(e.form.allFiledMap,(function(a,r){return t("el-tabs",{style:e.tabWidth(r,e.form.allFiledMap.length),attrs:{type:"card"},on:{"tab-click":e.handleClick},model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},[t("el-tab-pane",{key:r,attrs:{label:"字段映射-"+(r+1),name:"first"+r}}),t("el-tab-pane",{attrs:{name:"second"+r}},[t("template",{slot:"label"},[t("el-badge",{attrs:{"is-dot":a.isDot}},[e._v("\n                            "+e._s("SQL-"+(r+1))+"\n                            "),t("el-tooltip",{staticClass:"item",attrs:{effect:"dark",placement:"right"}},[t("div",{attrs:{slot:"content"},slot:"content"},[e._v("\n                                    注：红点标记表示字段映射或配置发生改变，需要切换到sql页面重新生成sql\n                                ")]),t("i",{staticClass:"content-view iconfont iconbangzhu operate"})])],1)],1)],2)],1)})),1),e.forceUpdate?t("div",{staticClass:"content-container"},e._l(e.form.allFiledMap,(function(a,r){return t("div",{key:r},[t("div",{directives:[{name:"show",rawName:"v-show",value:e.activeName==="first"+r,expression:"activeName === 'first' + n"}]},[t("div",{staticClass:"checkboxrow"},[t("el-button",{attrs:{size:"mini",plain:"",type:"primary"},on:{click:function(t){return e.Automaticmapping(!0,a,r)}}},[e._v("字段自动映射")])],1),a.param&&a.param.tableInfo?t("el-table",{ref:"tableData",refInFor:!0,staticStyle:{width:"100%",margin:"0 auto"},attrs:{data:a.param.tableInfo,border:""}},[t("el-table-column",{attrs:{prop:"name",label:a.tableName,align:"center"}}),t("el-table-column",{attrs:{label:e.targetName,prop:"targetValue"},scopedSlots:e._u([{key:"default",fn:function(n){return[t("div",{staticClass:"flex"},[t("el-form-item",{attrs:{rules:{required:!0,message:"请选择",trigger:"change"}}},[t("el-select",{attrs:{placeholder:"请选择",clearable:""},on:{change:function(t){return e.handleChange(a,r)}},model:{value:n.row.targetValue,callback:function(t){e.$set(n.row,"targetValue",t)},expression:"scope.row.targetValue"}},e._l(e.targetColumnOptions,(function(e){return t("el-option",{key:e.id,attrs:{label:e.columnName,value:e.id}})})),1)],1)],1)]}}],null,!0)})],1):e._e(),t("br"),void 0!==a.whereCondition?t("el-form-item",{attrs:{prop:"allFiledMap.".concat(r,".whereCondition")},scopedSlots:e._u([{key:"label",fn:function(){return[t("span",[e._v("where条件")]),t("el-tooltip",{staticClass:"item",staticStyle:{"padding-left":"10px"},attrs:{effect:"dark",placement:"right"}},[t("div",{attrs:{slot:"content"},slot:"content"},[e._v("\n                                    注：where条件不需填写where关键字\n                                ")]),t("i",{staticClass:"content-view iconfont iconbangzhu operate"})])]},proxy:!0}],null,!0)},[t("el-input",{attrs:{type:"textarea",rows:5,placeholder:"请输入内容"},model:{value:a.whereCondition,callback:function(t){e.$set(a,"whereCondition",t)},expression:"i.whereCondition"}})],1):e._e()],1),e.activeName==="second"+r?t("div",[t("div",{staticClass:"sql_btn_group"},[t("el-button",{attrs:{type:"primary",size:"mini",plain:""},on:{click:function(t){return e.createSql(a,r)}}},[e._v("生成SQL")]),t("el-button",{attrs:{type:"primary",size:"mini",plain:""},on:{click:function(t){return e.formaterSql(a.sqlMain,r)}}},[e._v("格式化SQL")])],1),t("SqlEditor",{ref:"sqleditor"+r,refInFor:!0,attrs:{value:a.sqlMain},on:{changeTextarea:function(t){return e.changeTextarea(t,a,r)}}})],1):e._e()])})),0):e._e()]),t("governanceAuditRules",{attrs:{show:e.showGovernanceAuditRules},on:{submit:e.initGA,close:function(t){e.showGovernanceAuditRules=!1}}})],1)}),[],!1,null,"47619b92",null);t.default=b.exports},"051c":function(e,t,a){(e.exports=a("2350")(!1)).push([e.i,".require[data-v-30146580]{color:#f56c6c}.search[data-v-30146580]{width:800px;margin:0 auto}.row[data-v-30146580]{margin-bottom:20px;display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:start;-ms-flex-pack:start;justify-content:flex-start;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-ms-flex-wrap:nowrap;flex-wrap:nowrap}.row[data-v-30146580] .el-form-item{margin-bottom:0!important}.row .label[data-v-30146580]{width:120px;vertical-align:middle;font-size:14px;color:#606266}.row .label[data-v-30146580],.row>td[data-v-30146580]{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:start;-ms-flex-pack:start;justify-content:flex-start;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-ms-flex-wrap:nowrap;flex-wrap:nowrap}.row[data-v-30146580] .el-input__suffix-inner{display:none}.row[data-v-30146580] .el-form-item__content{margin-left:0!important}.row[data-v-30146580] .el-input.is-disabled .el-input__inner{background:#fbfbfb}",""])},"059b":function(e,t,a){"use strict";a("9045")},"0898":function(e,t,a){(e.exports=a("2350")(!1)).push([e.i,"[data-v-2df97061] .el-table td,[data-v-2df97061] .el-table th,[data-v-2df97061] .el-table th.el-table__cell>.cell{text-align:center!important}[data-v-2df97061] .el-form{width:90%;margin:0 auto}.tips[data-v-2df97061]{padding-top:5px;display:inline-block;color:#e6a23c}.checkboxrow[data-v-2df97061]{width:80%;margin:0 0 10px 0}.rule-type[data-v-2df97061]{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-ms-flex-wrap:wrap;flex-wrap:wrap}.rule-type span[data-v-2df97061]{display:inline-block}.operate[data-v-2df97061]{cursor:pointer;color:#53a7f8;font-size:12px}.require[data-v-2df97061]{color:#f56c6c;font-size:16px;margin:0 3px}.flex[data-v-2df97061]{height:100%;display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-ms-flex-wrap:nowrap;flex-wrap:nowrap}.flex[data-v-2df97061] .el-form-item{margin-bottom:0!important}.center[data-v-2df97061] .el-form-item__content{margin-left:0!important;display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-ms-flex-align:center;align-items:center}",""])},"08a4":function(e,t,a){"use strict";a.r(t),a("8e6e"),a("ac6a"),a("456d"),a("7514");var r=a("2909"),n=a("ade3"),o=(a("20d6"),a("6762"),a("2fdb"),a("df76")),i=a("bf24"),l=a("c0c9"),s=a("b781"),c=a("0300"),u=a("ce93"),d=a("108b"),p=a("e31d"),m=a("c0c7"),f=a("0b1c"),h=a("95b6"),b=a("716b"),g=a("2f62"),w=a("d862");function v(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function y(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?v(Object(a),!0).forEach((function(t){Object(n.a)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):v(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}t.default={mixins:[w.default],data:function(){return{filter:"edit"==this.$route.query.filter,storey:["au_ods","au_std","au_dwd","au_dwm","au_dws","au_app"],currentSelectDatabase:{},sqlResponse:{},showAutoCreate:!1,showHandleCreate:!1,showTableSelectionPage:!1,selectParam:{targetDatabase:"",alreadySelectTargetTable:[],alreadySelectTargetTableValue:[],isAutoCreate:!1,sourceRows:[{sourceDatabase:"",alreadySelectSourceTable:[],alreadySelectSourceTableValue:[]}]},histories:[],currentType:{type:"",index:""},nextActive:"",stepActiveId:""}},computed:{currentLayerValue:function(){return this.selectParam?this.selectParam.targetDatabase:""},isAlreadyStart:function(){return this.process[0]&&this.process[0].success},auDwmBtnDisabled:function(){return"au_dwm"===this.selectParam.targetDatabase&&"au_dwd"!==this.selectParam.sourceRows[0].sourceDatabase},odsBtnDisabled:function(){return!this.storey.includes(this.selectParam.sourceRows[0].sourceDatabase)&&"au_ods"!==this.selectParam.targetDatabase},isView:function(){return"view"===this.$route.query.filter},startStep:function(){return this.process[0]&&this.process[0].success?this.process[0]:{}},isCanDelete:function(){var e=this,t=this.process.findIndex((function(t){return t.id===e.stepActiveId}));return""!==this.stepActiveId&&0!==t&&t===this.process.length-1}},components:{searchGroup:o.default,stepStart:i.default,stepStd:s.default,stepOds:l.default,stepDwd:c.default,stepDwm:u.default,stepDws:d.default,stepApp:p.default,stepPretank:m.default,tableSelectionPage:f.default,autoCreate:h.default,handleCreate:b.default},created:function(){this.$store.commit("fusionTask/changeLoading",!1)},methods:y(y({},Object(g.b)(["_AJAX"])),{},{initAutoCreate:function(e){e.tableId&&(this.selectParam.alreadySelectTargetTableValue=[e.tableId],this.selectParam.alreadySelectTargetTable=[{id:e.tableId,tableName:e.newTableName}],this.selectParam.isAutoCreate=!0)},initHandleCreate:function(e){e.id&&(this.selectParam.alreadySelectTargetTableValue=[e.id],this.selectParam.alreadySelectTargetTable=[{id:e.id,tableName:e.tableName}],this.showHandleCreate=!1)},initMap:function(e){var t=this.currentType.type,a=this.currentType.index;if("source"===t&&(this.selectParam.sourceRows[a].alreadySelectSourceTable=e,this.selectParam.sourceRows[a].alreadySelectSourceTableValue=e.map((function(e){return e.id}))),"target"===t){if(this.selectParam.alreadySelectTargetTableValue[0]===e.map((function(e){return e.id}))[0])return void(this.showTableSelectionPage=!1);this.selectParam.alreadySelectTargetTable=e,this.selectParam.alreadySelectTargetTableValue=e.map((function(e){return e.id})),this.selectParam.isAutoCreate=!1}this.showTableSelectionPage=!1},addSourceRow:function(){this.selectParam.sourceRows.push({sourceDatabase:"",alreadySelectSourceTableValue:[],alreadySelectSourceTable:[]})},delSourceRow:function(e){this.selectParam.sourceRows.splice(e,1)},clone:function(e){return JSON.parse(JSON.stringify(e))},handleSourceChange:function(e){this.$set(e,"alreadySelectSourceTable",[]),this.$set(e,"alreadySelectSourceTableValue",[])},handleTargetChange:function(){this.selectParam.alreadySelectTargetTable=[],this.selectParam.alreadySelectTargetTableValue=[],this.selectParam.isAutoCreate=!1,this.selectParam.sourceRows.splice(1,this.selectParam.sourceRows.length)},handleCreate:function(){this.showHandleCreate=!0},autoCreate:function(){var e=this;if(""!==this.selectParam.sourceRows[0].sourceDatabase)if(0!==this.selectParam.sourceRows[0].alreadySelectSourceTableValue.length)if(""!==this.selectParam.targetDatabase){var t=this.selectParam;this._AJAX({url:"task.stepHeader.autoCreateTable",method:"POST",data:{sourceTableId:t.sourceRows[0].alreadySelectSourceTableValue[0],sourceTableName:t.sourceRows[0].alreadySelectSourceTable[0].tableName,targetLevelCode:t.targetDatabase,sourceDBType:this.storey.includes(t.sourceRows[0].sourceDatabase)?"1":"0"}}).then((function(t){e.sqlResponse=t,1e4===t.code?(e.initAutoCreate(t.data),e.showAutoCreate=null!==t.data.sqlStr):e.showAutoCreate=!0}))}else this.$AudaqueToast.warn({template:"目标层不可为空"});else this.$AudaqueToast.warn({template:"源数据层表不可为空"});else this.$AudaqueToast.warn({template:"源数据层不可为空"})},selectTable:function(e,t){if("source"!==e||""!==this.selectParam.sourceRows[t].sourceDatabase)if("target"!==e||""!==this.selectParam.targetDatabase){var a=[].concat(Object(r.a)(this.databaseList[0].options),Object(r.a)(this.databaseList[1].options));if(this.currentType={type:e,index:t},"source"===e){var n=this.selectParam.sourceRows[t].sourceDatabase;this.currentSelectDatabase=a.find((function(e){return e.code===n}))}if("target"===e){var o=this.selectParam.targetDatabase;this.currentSelectDatabase=a.find((function(e){return e.code===o}))}this.showTableSelectionPage=!0}else this.$AudaqueToast.warn({template:"目标层不可为空"});else this.$AudaqueToast.warn({template:"源数据层不可为空"})},deleteCurrentStep:function(){var e=this;this._AJAX({url:"task.stepHeader.deleteCurrentStep",method:"GET",data:{taskId:this.$route.query.taskId,stepId:this.stepActiveId}}).then((function(){e.$message({message:"删除成功",type:"success"}),e.getStepHeader().then((function(){e.backTo(e.process[e.process.length-1])}))}))},next:function(){var e=this,t=this.nameMap[this.currentLayerValue]||"stepPretank";if(this.$refs[t]){var a=this.clone(this.selectParam);this.$refs[t].next(this.stepActiveId).then((function(){e.selectParam.sourceRows=[{sourceDatabase:e.currentLayerValue,alreadySelectSourceTable:a.alreadySelectTargetTable,alreadySelectSourceTableValue:a.alreadySelectTargetTableValue}],e.getStepHeader().then((function(){var t=e.process.findIndex((function(t){return t.id===e.stepActiveId})),a=t+1,r=t>=0&&e.process[a]?e.process[a].id:null;e.selectParam.targetDatabase="",e.selectParam.alreadySelectTargetTable=[],e.selectParam.alreadySelectTargetTableValue=[],e.selectParam.isAutoCreate=!1,r?(e.stepActiveId=r,e.backTo(e.process.find((function(e){return e.id===r})))):e.stepActiveId="",setTimeout((function(){e.$store.commit("fusionTask/changeLoading",!1)}))})).catch((function(){setTimeout((function(){e.$store.commit("fusionTask/changeLoading",!1)}))}))})).catch((function(){setTimeout((function(){e.$store.commit("fusionTask/changeLoading",!1)}))}))}},save:function(){var e=this,t=this.nameMap[this.currentLayerValue]||"stepPretank";this.$refs[t]&&this.$refs[t].next(this.stepActiveId).then((function(){e.getStepHeader().then((function(){e.$router.push({path:"/dataFusionTask/dataFusionTaskList",query:{}})})).catch((function(){}))})).catch((function(){}))},pre:function(){var e=this;if(this.stepActiveId){var t=this.process.findIndex((function(t){return t.id===e.stepActiveId}));this.backTo(this.process[t-1])}else this.backTo(this.process[this.process.length-1])},backTo:function(e){var t=this;this.stepActiveId=e.id;var a=e.stepDetailList[0],r=e.stepDetailList.reduce((function(a,r){var n=t.process.findIndex((function(t){return t.id===e.id})),o=n-1>=0?n-1:null,i=o?a.find((function(e){return e.alreadySelectSourceTableValue[0]!=t.process[o].stepDetailList[0].targetTableId&&e.sourceDatabase===r.sourceDbCode})):null;return i?(i.alreadySelectSourceTable.push({id:r.sourceTableId,tableName:r.sourceTableName}),i.alreadySelectSourceTableValue.push(r.sourceTableId)):a.push({sourceDatabase:r.sourceDbCode,alreadySelectSourceTable:[{id:r.sourceTableId,tableName:r.sourceTableName}],alreadySelectSourceTableValue:[r.sourceTableId]}),a}),[]);this.selectParam={targetDatabase:a.targetDbCode,alreadySelectTargetTable:[{id:a.targetTableId,tableName:a.targetTableName}],alreadySelectTargetTableValue:[a.targetTableId],isAutoCreate:!1,sourceRows:r};var n=this.storey.includes(a.targetDbCode)?this.nameMap[a.targetDbCode]:"stepPretank";this.$nextTick((function(){t.$refs[n].handleStep(t.stepActiveId)}))},submit:function(){var e=this,t=this.nameMap[this.currentLayerValue]||"stepPretank";this.$refs[t]&&this.$refs[t].submit(this.stepActiveId).then((function(){e.$message({message:"任务创建完成",type:"success",showClose:!0}),e.$router.go(-1)}))}})}},"0b1c":function(e,t,a){"use strict";a.r(t),a("a481"),a("6762"),a("2fdb"),a("8e6e"),a("456d"),a("c5f6"),a("7514"),a("ac6a"),a("6b54");var r=a("ade3"),n=a("2f62");function o(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function i(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?o(Object(a),!0).forEach((function(t){Object(r.a)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):o(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var l={props:{show:{type:Boolean,default:!1},currentSelectDatabase:{type:Object,default:function(){}},currentLayerValue:{type:String,default:""},selectParam:{type:Object,default:function(){}},currentType:{type:Object,default:function(){}}},data:function(){return{storey:["au_ods","au_std","au_dwd","au_dwm","au_dws","au_app"],datas:[],templateSelection:"",tableData:[],selectedRow:null,multipleSelection:[],defaultProps:{label:"name",children:"children"},treeExpandData:[],searchText:"",param:{code:"",type:"",tagId:null,tableNameOrComment:"",page:1,rows:10,total:0}}},components:{},computed:{isMultiple:function(){return("au_dwd"===this.currentLayerValue||"au_dws"===this.currentLayerValue)&&"target"!==this.currentType.type}},mounted:function(){this.initValue(),this.init(),this.$nextTick((function(){document.querySelector(".pane-comp")&&(document.querySelector(".pane-comp").style.width="177px")}))},methods:i(i(i({},Object(n.b)("fusionTask",["GET_TREE"])),Object(n.b)(["_AJAX"])),{},{initValue:function(){var e=this.currentType.index;if("target"===this.currentType.type)this.isMultiple?this.templateSelection=this.selectParam.alreadySelectTargetTable:this.templateSelection=this.selectParam.alreadySelectTargetTableValue[0];else{var t=this.selectParam.sourceRows[e];this.isMultiple?this.templateSelection=t.alreadySelectSourceTable:t.alreadySelectSourceTableValue[0]}},init:function(){var e=this;this.$nextTick((function(){var t=document.querySelector(".custom-container");t&&(t.style.height=t.clientHeight+"px",e.getTree().then((function(){e.selectCurrent()})))}))},selectCurrent:function(){this.param.page=1,this.param.rows=10,this.param.code=this.currentSelectDatabase.code,this.param.type=this.currentSelectDatabase.type,this.param.tagId=null,this.param.tableNameOrComment="",this.getTable()},getTree:function(){var e=this;return new Promise((function(t,a){e.param.tableNameOrComment="",e.GET_TREE().then((function(a){e.datas=a||[],e.treeExpandData.push("1"),t(a)})).catch((function(e){a(e)}))}))},onSearch:function(){this.getTable()},getTable:function(){var e=this,t={code:this.param.code,type:this.param.type.toString(),page:this.param.page,rows:this.param.rows,tableNameOrComment:this.param.tableNameOrComment};this.param.tagId&&(t.tagId=this.param.tagId),this._AJAX({url:"task.stepHeader.getTableByDBTag",method:"get",data:t}).then((function(t){if(e.tableData=t.rows,e.param.total=t.total,Array.isArray(e.templateSelection)){var a=e.tableData.filter((function(t){return e.templateSelection.map((function(e){return e.id})).includes(t.id)}));setTimeout((function(){a.forEach((function(t){e.$refs.multipleTable.toggleRowSelection(t)}))}),100)}}))},flattenArray:function(e){for(var t=[],a=0;a<e.length;a++)Array.isArray(e[a])?t=t.concat(this.flattenArray(e[a])):t.push(e[a]);return t},sure:function(){var e=this,t=this,a=Array.isArray(this.templateSelection)?this.templateSelection:[this.tableData.find((function(t){return t.id===e.templateSelection}))];a=a.filter((function(e){return void 0!==e})),this.storey.includes(this.currentSelectDatabase.code)||1!=a[0].isConfiguredFusion?this.onSubmit():this.$AudaqueToast.warn({template:"该表已经配置过融合任务，是否继续配置？",methods:{okEvent:function(){t.onSubmit()}}})},onSubmit:function(){var e=this,t=Array.isArray(this.templateSelection)?this.templateSelection:[this.tableData.find((function(t){return t.id===e.templateSelection}))];if((t=t.filter((function(e){return void 0!==e}))).some((function(e){return 0===e.tableIscreate}))&&this.storey.includes(this.currentSelectDatabase.code))return this.$AudaqueToast.warn({template:"选中的含有未创建表，请前往：模型分层-".concat(this.currentSelectDatabase.label,"中创建"),methods:{okEvent:function(){}}}),!1;var a,r=JSON.parse(JSON.stringify(this.selectParam.sourceRows));if(r[this.currentType.index]?(r.splice(this.currentType.index,1),a=r.map((function(e){return e.alreadySelectSourceTableValue})).flat()):a=r.map((function(e){return e.alreadySelectSourceTableValue})).flat(),("au_dwd"===this.currentLayerValue||"au_dws"===this.currentLayerValue)&&t.some((function(e){return a.includes(e.id)})))return this.$AudaqueToast.warn({template:"当前选中的表与已选中的表有重复值，请重新选择",methods:{okEvent:function(){}}}),!1;this.$emit("submit",t)},isSelectable:function(e){return!0},handleClose:function(){this.$emit("close")},handleRowClick:function(e){this.selectedRow===e?this.selectedRow=null:this.selectedRow=e},handleSizeChange:function(e){this.param.page=1,this.param.rows=e,this.getTable()},handleCurrentChange:function(e){this.param.page=e,this.getTable()},handleCheckboxChange:function(e){e.checked||(this.selectedRow=null)},rowChange:function(e){this.isMultiple?this.$refs.multipleTable.toggleRowSelection(e):this.templateSelection=e.id},handleSelectionChange:function(e){var t=this,a=this.tableData.filter((function(e){return t.templateSelection.map((function(e){return e.id})).includes(e.id)})),r=e.filter((function(e){return!a.map((function(e){return e.id})).includes(e.id)})),n=a.filter((function(t){return!e.map((function(e){return e.id})).includes(t.id)}));this.templateSelection=this.templateSelection.concat(r),this.templateSelection=this.templateSelection.filter((function(e){return!n.map((function(e){return e.id})).includes(e.id)}))},handleNodeClick:function(e){this.param.code=this.currentSelectDatabase.code,this.param.type=this.currentSelectDatabase.type,this.param.tagId=Number(e.id),this.param.page=1,this.param.rows=10,this.getTable()}})},s=(a("2ce9"),a("2877")),c=Object(s.a)(l,(function(){var e=this,t=e._self._c;return t("el-dialog",{attrs:{title:"库表选择",visible:e.show,width:"80%","before-close":e.handleClose,"append-to-body":"","close-on-click-modal":!1},on:{"update:visible":function(t){e.show=t}}},[t("div",{staticClass:"custom-container",staticStyle:{"min-height":"60vh"}},[t("audaque-resize-split-page",[t("template",{slot:"leftPane"},[t("div",{staticStyle:{"padding-left":"24px","white-space":"nowrap",overflow:"hidden"}},[e._v("\n                    当前库："),t("span",{staticStyle:{cursor:"pointer",color:"#409eff"},on:{click:e.selectCurrent}},[e._v(e._s(e.currentSelectDatabase.label)+"--")])]),t("el-tree",{staticClass:"tree-dashed",attrs:{data:e.datas,props:e.defaultProps,"default-expanded-keys":e.treeExpandData,"node-key":"id"},on:{"node-click":e.handleNodeClick}})],1),t("template",{slot:"rightPane"},[t("div",{staticClass:"row",staticStyle:{"margin-bottom":"10px"}},[t("div",{staticStyle:{width:"50%"}},[t("el-input",{attrs:{placeholder:"通过表名，表中文名模糊查询"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.onSearch.apply(null,arguments)}},model:{value:e.param.tableNameOrComment,callback:function(t){e.$set(e.param,"tableNameOrComment",t)},expression:"param.tableNameOrComment"}})],1),t("div",[t("el-button",{attrs:{type:"primary"},on:{click:e.onSearch}},[e._v("筛选")])],1)]),t("el-table",{ref:"multipleTable",staticStyle:{width:"100%"},attrs:{data:e.tableData,"highlight-current-row":"",border:""},on:{"row-click":e.rowChange,"selection-change":e.handleSelectionChange}},[e.isMultiple?t("el-table-column",{attrs:{type:"selection",width:"55"}}):t("el-table-column",{attrs:{align:"center",width:"55",label:""},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-radio",{staticClass:"radio",attrs:{label:a.row.id},model:{value:e.templateSelection,callback:function(t){e.templateSelection=t},expression:"templateSelection"}},[e._v(" ")])]}}])}),t("el-table-column",{attrs:{prop:"schemaName",width:"80",label:"数据库名","show-overflow-tooltip":""}}),e.storey.includes(e.currentSelectDatabase.code)?e._e():t("el-table-column",{attrs:{prop:"isConfiguredFusion",label:"已配置融合任务","show-overflow-tooltip":"",width:"140"},scopedSlots:e._u([{key:"default",fn:function(a){return[1==a.row.isConfiguredFusion?t("div",[e._v("是")]):e._e(),0==a.row.isConfiguredFusion?t("div",[e._v("否")]):e._e()]}}],null,!1,1126889692)}),t("el-table-column",{attrs:{prop:"tableName",label:"表名","show-overflow-tooltip":""}}),t("el-table-column",{attrs:{prop:"tableComment",label:"表中文描述","show-overflow-tooltip":""}}),t("el-table-column",{attrs:{width:"80",prop:"dataNum",label:"数据量"}}),t("el-table-column",{attrs:{width:"100",prop:"tagFullName",label:"元数据标签"},scopedSlots:e._u([{key:"default",fn:function(a){return[a.row.tagFullName?t("span",{domProps:{innerHTML:e._s(a.row.tagFullName.replace(/;/g,"<br>").replace(/,/g,"→").replace(/;$/,""))}}):e._e()]}}])}),e.storey.includes(e.currentSelectDatabase.code)?t("el-table-column",{attrs:{prop:"tableIscreate",label:"表是否已创建",width:"100"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n                            "+e._s(1===t.row.tableIscreate?"已创建":"未创建")+"\n                        ")]}}],null,!1,1411126668)}):e._e()],1),t("adq-pagination",{attrs:{"current-page":e.param.page,total:e.param.total,"page-size":e.param.rows},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],1)],2)],1),t("div",{staticClass:"dialog-footer row",attrs:{slot:"footer"},slot:"footer"},[t("div",[t("el-button",{on:{click:e.handleClose}},[e._v("取消")])],1),t("div",[t("el-button",{attrs:{type:"primary"},on:{click:e.sure}},[e._v("确认")])],1)])])}),[],!1,null,"6e812f26",null);t.default=c.exports},"0f3d":function(e,t,a){"use strict";a("5ff9")},"168c":function(e,t,a){var r=a("6ec1");r.__esModule&&(r=r.default),"string"==typeof r&&(r=[[e.i,r,""]]),r.locals&&(e.exports=r.locals),(0,a("499e").default)("84b8bda0",r,!0,{sourceMap:!1,shadowMode:!1})},"172b":function(e,t,a){(e.exports=a("2350")(!1)).push([e.i,".tab-container[data-v-47619b92]{width:100%;overflow-x:auto;display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:start;-ms-flex-pack:start;justify-content:flex-start;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-ms-flex-wrap:nowrap;flex-wrap:nowrap}.tab-container>div[data-v-47619b92]{margin-right:10px}.content-container[data-v-47619b92],.content-container>div[data-v-47619b92],.content-container>div>div[data-v-47619b92]{width:100%}.flex[data-v-47619b92]{height:100%;display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-ms-flex-wrap:nowrap;flex-wrap:nowrap}.flex[data-v-47619b92] .el-form-item{margin-bottom:0!important}[data-v-47619b92] .el-table td,[data-v-47619b92] .el-table th,[data-v-47619b92] .el-table th.el-table__cell>.cell{text-align:center!important}[data-v-47619b92] .el-form{width:90%;margin:0 auto}.tips[data-v-47619b92]{padding-top:5px;display:inline-block;color:#e6a23c}.checkboxrow[data-v-47619b92]{width:80%;margin:0 0 10px 0}.rule-type[data-v-47619b92]{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-ms-flex-wrap:wrap;flex-wrap:wrap}.rule-type span[data-v-47619b92]{display:inline-block}.operate[data-v-47619b92]{cursor:pointer;color:#53a7f8;font-size:12px}.require[data-v-47619b92]{color:#f56c6c;font-size:16px;margin:0 3px}.sql_btn_group[data-v-47619b92]{margin-bottom:10px}",""])},1794:function(e,t,a){"use strict";a.r(t),a("96cf");var r,n=a("1da1"),o={props:{show:{type:Boolean,default:!1}},data:function(){return{datas:[],tableData:[{slot1:"test1",slot2:"SQL规则",slot3:"{0} in ('男', '女')",slot4:"性别检测"}],multipleSelection:[],defaultProps:{label:"name",children:"children"},treeExpandData:[],searchText:""}},components:{},computed:{},mounted:function(){},methods:{onSearch:function(){},onSubmit:function(){this.$emit("submit",this.multipleSelection)},handleClose:function(){this.$emit("close")},handleSelectionChange:function(e){this.multipleSelection=e},handleNodeClick:(r=Object(n.a)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)}))),function(){return r.apply(this,arguments)})}},i=(a("fa01"),a("2877")),l=Object(i.a)(o,(function(){var e=this,t=e._self._c;return t("el-dialog",{attrs:{title:"治理稽核规则配置",visible:e.show,width:"80%","before-close":e.handleClose,"append-to-body":""},on:{"update:visible":function(t){e.show=t}}},[t("audaque-resize-split-page",[t("template",{slot:"leftPane"},[t("el-tree",{staticClass:"tree-dashed",attrs:{data:e.datas,props:e.defaultProps,"default-expanded-keys":e.treeExpandData,"node-key":"id"},on:{"node-click":e.handleNodeClick}})],1),t("template",{slot:"rightPane"},[t("div",{staticClass:"row",staticStyle:{"margin-bottom":"10px"}},[t("div",{staticStyle:{width:"50%"}},[t("el-input",{attrs:{placeholder:"通过表名，表中文名模糊查询"},model:{value:e.searchText,callback:function(t){e.searchText=t},expression:"searchText"}})],1),t("div",[t("el-button",{attrs:{type:"primary"},on:{click:e.onSearch}},[e._v("筛选")])],1)]),t("el-table",{ref:"multipleTable",staticStyle:{width:"100%"},attrs:{data:e.tableData,"tooltip-effect":"dark"},on:{"selection-change":e.handleSelectionChange}},[t("el-table-column",{attrs:{type:"selection",label:"序号"}}),t("el-table-column",{attrs:{prop:"slot1",label:"规则名称"}}),t("el-table-column",{attrs:{prop:"slot2",label:"规则类型"}}),t("el-table-column",{attrs:{prop:"slot3",label:"规则表达式"}}),t("el-table-column",{attrs:{prop:"slot4",label:"规则表达式"}})],1),t("div",{staticClass:"row",staticStyle:{"margin-top":"10px"}},[t("div",[t("el-button",{on:{click:e.handleClose}},[e._v("取消")])],1),t("div",[t("el-button",{attrs:{type:"primary"},on:{click:e.onSubmit}},[e._v("确认")])],1)])],1)],2)],1)}),[],!1,null,"549c569a",null);t.default=l.exports},"1a2e":function(e,t,a){(e.exports=a("2350")(!1)).push([e.i,".row[data-v-549c569a]{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:end;-ms-flex-pack:end;justify-content:flex-end;-webkit-box-align:start;-ms-flex-align:start;align-items:flex-start;-ms-flex-wrap:nowrap;flex-wrap:nowrap}.row>div[data-v-549c569a]:first-child{margin-right:10px}",""])},2116:function(e,t,a){(e.exports=a("2350")(!1)).push([e.i,"[data-v-097afd5b] .el-table td,[data-v-097afd5b] .el-table th,[data-v-097afd5b] .el-table th.el-table__cell>.cell{text-align:center!important}[data-v-097afd5b] .el-form{width:90%;margin:0 auto}.tips[data-v-097afd5b]{padding-top:5px;display:inline-block;color:#e6a23c}.checkboxrow[data-v-097afd5b]{width:80%;margin:0 0 10px 0}.rule-type[data-v-097afd5b]{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-ms-flex-wrap:wrap;flex-wrap:wrap}.rule-type span[data-v-097afd5b]{display:inline-block}.operate[data-v-097afd5b]{cursor:pointer;color:#53a7f8;font-size:12px}.require[data-v-097afd5b]{color:#f56c6c;font-size:16px;margin:0 3px}.sql_btn_group[data-v-097afd5b]{margin-bottom:10px}",""])},"2ce9":function(e,t,a){"use strict";a("168c")},"2f037":function(e,t,a){var r=a("5504");r.__esModule&&(r=r.default),"string"==typeof r&&(r=[[e.i,r,""]]),r.locals&&(e.exports=r.locals),(0,a("499e").default)("230b1365",r,!0,{sourceMap:!1,shadowMode:!1})},"33fb":function(e,t,a){"use strict";a.r(t),a("7514"),a("7f7f"),a("8e6e"),a("456d"),a("ac6a"),a("6762"),a("2fdb");var r=a("ade3"),n=a("2f62");function o(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function i(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?o(Object(a),!0).forEach((function(t){Object(r.a)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):o(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var l={name:"RuleList",data:function(){return{selectedData:[],ruleNameDim:"",endList:[],isSelect:!1,ruleTypeOptionsGroup:[{name:"规则类型",children:[]}],defaultProps:{children:"children",label:"name"},isSearch:!1,getHeight:!1,total:1,param:{includeRole:!0,page:1,rows:10,id:"",ruleName:"",ruleType:"1",ruleCategory:"",expression:"",ruleDesc:"",dataState:"",createUser:"",createRange:"",updateUser:"",updateRange:""},search_dataRange:""}},props:["chooseRules","selectedValue"],computed:i({},Object(n.d)("generateRule",["generateRuleList","ruleTypeOptions","ruleCategoryOptions"])),methods:i(i({},Object(n.b)("generateRule",["GENERATERULELIST","DELETEGENERATERULE","GETRULETYPEOPTIONS_LIST","GETRULECATEGORYLIST"])),{},{updateSameList:function(){var e=this;this.generateRuleList.rows.filter((function(t){return e.endList.map((function(e){return e.id})).includes(t.id)})).forEach((function(t){e.$refs.multipleTable.toggleRowSelection(t)}))},initData:function(){var e=this,t=JSON.parse(JSON.stringify(this.param));t.createRange&&t.createRange[0]&&(t.createStartTime=t.createRange[0]),t.createRange&&t.createRange[1]&&(t.createEndTime=t.createRange[1]),delete t.createRange,t.updateRange&&t.updateRange[0]&&(t.updateStartTime=t.updateRange[0]),t.updateRange&&t.updateRange[1]&&(t.updateEndTime=t.updateRange[1]),delete t.updateRange,this.isSelect=!0,this.GENERATERULELIST(t).then((function(){e.updateSameList(),e.isSelect=!1}))},handleNodeClick:function(e){this.param.ruleType=e.code,this.QUERYLIST_PARAMS(0)},handleSizeChange:function(e){this.param.page=1,this.param.rows=e,this.initData()},handleCurrentChange:function(e){this.param.page=e,this.initData()},QUERYLIST_PARAMS:function(e){var t=this;this.param.page=1,e>0&&this.publics.resetFun(this.param,(function(){t.param.rows=10,t.search_dataRange=null})),this.initData()},delRow:function(e){var t=this;this.$AudaqueToast.warn({template:"确认删除？",methods:{okEvent:function(){t.$store.commit("SHOW_LOADING",!0),t.DELETEGENERATERULE({id:e}).then((function(e){0==e.code&&t.$AudaqueToast.tip({template:"删除成功",methods:{okEvent:function(){t.initData()}}})}))}}})},goEdit:function(e){this.$router.push("/generateRule/generateRuleEdit?optType=edit&id=".concat(e,"&ruleType=").concat(this.param.ruleType))},rowChange:function(e){this.$refs.multipleTable.toggleRowSelection(e)},handleSelectionChange:function(e){var t=this;if(!this.isSelect){var a=this.generateRuleList.rows.filter((function(e){return t.endList.map((function(e){return e.id})).includes(e.id)})).filter((function(t){return!e.map((function(e){return e.id})).includes(t.id)}));this.endList=this.endList.filter((function(e){return!a.map((function(e){return e.id})).includes(e.id)})),e.forEach((function(e){t.endList.map((function(e){return e.id})).includes(e.id)||t.endList.push(e)}))}},subButton:function(){var e=this;this.endList=this.endList.map((function(t){return{id:t.id,ruleName:t.ruleName,ruleType:t.ruleType,ruleTypeName:e.ruleTypeOptionsGroup[0].children.find((function(e){return e.code==t.ruleType})).name}})),this.chooseRules(this.endList)},dimSearch:function(){var e=this,t=JSON.parse(JSON.stringify(this.param));t.ruleName=this.ruleNameDim,delete t.createRange,delete t.updateRange,this.isSelect=!0,this.GENERATERULELIST(t).then((function(){e.updateSameList(),e.isSelect=!1}))}}),created:function(){var e=this;this.GETRULETYPEOPTIONS_LIST().then((function(t){e.ruleTypeOptionsGroup[0].children=t})),this.GETRULECATEGORYLIST(),this.initData(),this.endList=this.selectedValue||[]}},s=(a("65b30"),a("2877")),c=Object(s.a)(l,(function(){var e=this,t=e._self._c;return t("audaque-resize-split-page",[t("template",{slot:"title"},[t("audaque-table-title",{attrs:{title:""}},[t("el-input",{attrs:{placeholder:"通过规则名模糊查询",clearable:""},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.dimSearch.apply(null,arguments)}},model:{value:e.ruleNameDim,callback:function(t){e.ruleNameDim=t},expression:"ruleNameDim"}}),t("el-button",{attrs:{type:"primary"},on:{click:e.dimSearch}},[e._v("筛选")])],1)],1),t("template",{slot:"leftPane"},[e.ruleTypeOptionsGroup[0].children.length>0?t("el-tree",{attrs:{data:e.ruleTypeOptionsGroup,"current-node-key":e.param.ruleType,"node-key":"code","default-expand-all":!0,props:e.defaultProps},on:{"node-click":e.handleNodeClick}}):e._e()],1),t("template",{slot:"rightPane"},[t("el-table",{ref:"multipleTable",staticClass:"el-table-common__list",attrs:{"tooltip-effect":"light","highlight-current-row":"",stripe:"",data:e.generateRuleList.rows,selection:e.selectedData,border:""},on:{"row-click":e.rowChange,"selection-change":e.handleSelectionChange}},[t("el-table-column",{attrs:{type:"selection",width:"55"}}),t("el-table-column",{attrs:{"show-overflow-tooltip":"",type:"index",label:"序号",index:function(t){return e.$utils._indexMethod(t,e.param.page,e.param.rows)},align:"center",width:"80"}}),t("el-table-column",{attrs:{"show-overflow-tooltip":"",align:"center",prop:"ruleName",label:"规则名称"}}),t("el-table-column",{attrs:{"show-overflow-tooltip":"",align:"center",prop:"ruleType",label:"规则类型"},scopedSlots:e._u([{key:"default",fn:function(t){return e.ruleTypeOptionsGroup[0].children.length>0?[e._v("\n                    "+e._s(e.ruleTypeOptionsGroup[0].children.find((function(e){return e.code==t.row.ruleType})).name)+"\n                ")]:void 0}}],null,!0)}),t("el-table-column",{attrs:{"show-overflow-tooltip":"",align:"center",prop:"expression",label:"规则表达式"}}),t("el-table-column",{attrs:{"show-overflow-tooltip":"",align:"center",prop:"ruleDesc",label:"规则描述"}}),t("template",{slot:"empty"},[t("audaque-table-empty",{attrs:{tableFetchStatus:e.$store.state.tableFetchStatus,"is-new":!1},on:{fetch:function(t){return e.LOGLIST(e.param)}}})],1)],2),t("adq-pagination",{attrs:{"current-page":e.param.page,total:e.generateRuleList.total,"page-size":e.param.rows},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}}),t("div",{staticStyle:{display:"flex","justify-content":"flex-end","margin-top":"20px"}},[t("el-button",{attrs:{type:"primary"},on:{click:e.subButton}},[e._v("确认")])],1)],1)],2)}),[],!1,null,"bec53432",null);t.default=c.exports},3588:function(e,t,a){var r=a("1a2e");r.__esModule&&(r=r.default),"string"==typeof r&&(r=[[e.i,r,""]]),r.locals&&(e.exports=r.locals),(0,a("499e").default)("167dcafc",r,!0,{sourceMap:!1,shadowMode:!1})},"3b6f0":function(e,t,a){(e.exports=a("2350")(!1)).push([e.i,"[data-v-08c0f924] .el-table td,[data-v-08c0f924] .el-table th,[data-v-08c0f924] .el-table th.el-table__cell>.cell{text-align:center!important}[data-v-08c0f924] .el-form{width:90%;margin:0 auto}.row[data-v-08c0f924]{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:end;-ms-flex-pack:end;justify-content:flex-end;-webkit-box-align:start;-ms-flex-align:start;align-items:flex-start;-ms-flex-wrap:nowrap;flex-wrap:nowrap}.row>div[data-v-08c0f924]:first-child{margin-right:10px}.flex[data-v-08c0f924]{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-ms-flex-wrap:nowrap;flex-wrap:nowrap}.flex[data-v-08c0f924] .el-form-item{margin-bottom:0!important}.tips[data-v-08c0f924]{padding-top:5px;display:inline-block;color:#e6a23c}.checkboxrow[data-v-08c0f924]{width:80%;margin:0 0 10px 0}.rule-type[data-v-08c0f924]{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-ms-flex-wrap:wrap;flex-wrap:wrap}.rule-type span[data-v-08c0f924]{display:inline-block}.operate[data-v-08c0f924]{cursor:pointer;color:#53a7f8;font-size:12px}.require[data-v-08c0f924]{color:#f56c6c;font-size:16px;margin:0 3px}[data-v-08c0f924] .el-dialog__body{max-height:100%!important}[data-v-08c0f924] .pane-comp,[data-v-08c0f924] .tree-dashed{overflow:auto}.sql_btn_group[data-v-08c0f924]{margin-bottom:10px}",""])},"45b3":function(e,t,a){var r=a("8ecc");r.__esModule&&(r=r.default),"string"==typeof r&&(r=[[e.i,r,""]]),r.locals&&(e.exports=r.locals),(0,a("499e").default)("6f12c731",r,!0,{sourceMap:!1,shadowMode:!1})},"4bca":function(e,t,a){var r=a("2116");r.__esModule&&(r=r.default),"string"==typeof r&&(r=[[e.i,r,""]]),r.locals&&(e.exports=r.locals),(0,a("499e").default)("357b832e",r,!0,{sourceMap:!1,shadowMode:!1})},"4f8c":function(e,t,a){"use strict";a("e9e0")},5504:function(e,t,a){(e.exports=a("2350")(!1)).push([e.i,".search-date[data-v-bec53432]{width:100%!important}",""])},5840:function(e,t,a){"use strict";a("b3b5")},"5ff9":function(e,t,a){var r=a("92e8");r.__esModule&&(r=r.default),"string"==typeof r&&(r=[[e.i,r,""]]),r.locals&&(e.exports=r.locals),(0,a("499e").default)("31951909",r,!0,{sourceMap:!1,shadowMode:!1})},"65b30":function(e,t,a){"use strict";a("2f037")},"6ec1":function(e,t,a){(e.exports=a("2350")(!1)).push([e.i,".row[data-v-6e812f26]{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:end;-ms-flex-pack:end;justify-content:flex-end;-webkit-box-align:start;-ms-flex-align:start;align-items:flex-start;-ms-flex-wrap:nowrap;flex-wrap:nowrap}.row>div[data-v-6e812f26]:first-child{margin-right:10px}[data-v-6e812f26] .el-dialog__body{max-height:100%!important}[data-v-6e812f26] .pane-comp,[data-v-6e812f26] .tree-dashed{overflow:auto}",""])},"716b":function(e,t,a){"use strict";a.r(t),a("7f7f"),a("ac4d"),a("8a81"),a("5df3"),a("1c4c"),a("6b54"),a("8e6e"),a("456d"),a("ac6a");var r=a("ade3"),n=a("2f62");function o(e,t){var a="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!a){if(Array.isArray(e)||(a=function(e,t){if(e){if("string"==typeof e)return i(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);return"Object"===a&&e.constructor&&(a=e.constructor.name),"Map"===a||"Set"===a?Array.from(e):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?i(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){a&&(e=a);var r=0,n=function(){};return{s:n,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,l=!0,s=!1;return{s:function(){a=a.call(e)},n:function(){var e=a.next();return l=e.done,e},e:function(e){s=!0,o=e},f:function(){try{l||null==a.return||a.return()}finally{if(s)throw o}}}}function i(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function l(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function s(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?l(Object(a),!0).forEach((function(t){Object(r.a)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):l(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var c={props:["show","selectParam"],data:function(){return{storey:["au_ods","au_std","au_dwd","au_dwm","au_dws","au_app"],defaultProps:{children:"children",label:"name"},hrefPath:"",activeName:"first",param:{id:"",tableName:"",tableComment:"",modelName:"",modelId:"",columnInfoList:[],sql:""},rules:{modelName:[{required:!0,message:"请选择模块",trigger:"change"}],sql:[{required:!0,message:"请输入sql",trigger:"blur"}],tableName:[{required:!0,message:"请输入表名",trigger:"blur"}],tableComment:[{required:!0,message:"请输入表注释",trigger:"blur"}]}}},computed:s(s(s(s(s({},Object(n.d)("baseLayer",["baseLayerList","dataTypeOptions"])),Object(n.d)("subjectLayer",["subjectLayerList"])),Object(n.d)("specialLayer",["specialLayerList"])),Object(n.d)("safeLayer",["safeLayerList"])),{},{current:function(){return this.selectParam.targetDatabase}}),created:function(){this.GETDATATYPEOPTIONS_LIST(),"au_dwd"===this.current&&this.BASELAYER_LIST(),"au_dwm"===this.current&&this.SUBJECTLAYER_LIST(),"au_dws"===this.current&&this.SPECIALLAYER_LIST(),"au_app"===this.current&&this.SAFELAYER_LIST()},components:{},mounted:function(){this.$nextTick((function(){var e=document.querySelector(".custom-container");e&&(e.style.height=e.clientHeight+"px")}))},methods:s(s(s(s(s(s({},Object(n.b)(["_AJAX"])),Object(n.b)("baseLayer",["BASELAYER_LIST","GETDATATYPEOPTIONS_LIST"])),Object(n.b)("subjectLayer",["SUBJECTLAYER_LIST"])),Object(n.b)("specialLayer",["SPECIALLAYER_LIST"])),Object(n.b)("safeLayer",["SAFELAYER_LIST"])),{},{exportFun:function(){this.publics.exportFile(this,{au_dwd:"/baseLayer/createTableTemplateDown.do",au_dwm:"/subjectLayer/createTableTemplateDown.do",au_dws:"/specialLayer/createTableTemplateDown.do",au_app:"/safeLayer/createTableTemplateDown.do"}[this.selectParam.targetDatabase],{})},handleUpload:function(e){var t=this;if(!this.param.modelId)return this.$refs.upload.value=null,Vue.prototype.$message.warning("请选择建表目录！");this.formData=new FormData,this.formData.append("upFile",e.target.files[0]),this.formData.append("categoryId",this.param.modelId),this.loading=!0,this._AJAX({url:{au_dwd:"baseLayer.tableImport",au_dwm:"subjectLayer.tableImport",au_dws:"specialLayer.tableImport",au_app:"safeLayer.tableImport"}[this.selectParam.targetDatabase],data:this.formData,method:"POST"}).then((function(e){t.loading=!1,0===e.code?t.$message({message:"导入成功",type:"success"}):t.$message({message:"导入失败",type:"error"}),t.delFormData()})).catch((function(){t.loading=!1,t.delFormData()}))},delFormData:function(){this.$refs.upload.value=null;var e,t=o(this.formData.keys());try{for(t.s();!(e=t.n()).done;){var a=e.value;this.formData.delete(a)}}catch(e){t.e(e)}finally{t.f()}},addRow:function(){this.param.columnInfoList.push({})},removeRow:function(e){this.param.columnInfoList.splice(e,1)},handleClose:function(){this.$emit("close")},handleClick:function(e){this.activeName=e.name},handleMoveNodeClick:function(e){this.param.modelName=e.name,this.param.modelId=e.id},subBtn:function(){var e=this;if(this.param.modelId){var t=this,a={au_dwd:"baseLayer",au_dwm:"subjectLayer",au_dws:"specialLayer",au_app:"safeLayer"};"first"==t.activeName?this.$refs.createTableForm.validate((function(r){if(!r)return!1;e.$store.commit("SHOW_LOADING",!0),e.$store.dispatch("".concat(a[e.selectParam.targetDatabase],"/CREATETABLESD"),t.param).then((function(t){0==t.code&&(e.$message.success("建表成功"),e.$emit("success",t.result))}))})):"third"==t.activeName&&this.$refs.createTableByDdl.validate((function(r){if(!r)return!1;var n=e.param.sql;t.param.sql=encodeURIComponent(n),e.$store.commit("SHOW_LOADING",!0),e.$store.dispatch("".concat(a[e.selectParam.targetDatabase],"/CREATETABLEDDL"),t.param).then((function(t){0==t.code&&(e.$message.success("建表成功"),e.$emit("success",t.result))})),e.param.sql=n}))}else this.$message({message:"请选择建表目录",type:"warning"})}})},u=(a("059b"),a("2877")),d=Object(u.a)(c,(function(){var e=this,t=e._self._c;return t("el-dialog",{attrs:{title:"手动建表",visible:e.show,"before-close":e.handleClose,"append-to-body":""},on:{"update:visible":function(t){e.show=t}}},[t("div",{staticClass:"custom-container"},[t("audaque-resize-split-page",[t("template",{slot:"leftPane"},["au_dwd"===e.current?t("el-tree",{ref:"tree",staticClass:"tree-dashed",attrs:{data:e.baseLayerList,"node-key":"value","expand-on-click-node":!1,"highlight-current":"",props:e.defaultProps,"default-expand-all":!0},on:{"node-click":function(t){return e.handleMoveNodeClick(t,"au_dwd")}}}):e._e(),"au_dwm"===e.current?t("el-tree",{ref:"tree",staticClass:"tree-dashed",attrs:{data:e.subjectLayerList,"node-key":"value","expand-on-click-node":!1,"highlight-current":"",props:e.defaultProps,"default-expand-all":!0},on:{"node-click":function(t){return e.handleMoveNodeClick(t,"au_dwm")}}}):e._e(),"au_dws"===e.current?t("el-tree",{ref:"tree",staticClass:"tree-dashed",attrs:{data:e.specialLayerList,"node-key":"value","expand-on-click-node":!1,"highlight-current":"",props:e.defaultProps,"default-expand-all":!0},on:{"node-click":function(t){return e.handleMoveNodeClick(t,"au_dws")}}}):e._e(),"au_app"===e.current?t("el-tree",{ref:"tree",staticClass:"tree-dashed",attrs:{data:e.safeLayerList,"node-key":"value","expand-on-click-node":!1,"highlight-current":"",props:e.defaultProps,"default-expand-all":!0},on:{"node-click":function(t){return e.handleMoveNodeClick(t,"au_app")}}}):e._e()],1),t("template",{slot:"rightPane"},[t("el-tabs",{on:{"tab-click":e.handleClick},model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},[t("el-tab-pane",{attrs:{label:"手动建表",name:"first"}},[[t("el-form",{ref:"createTableForm",staticClass:"form-item",attrs:{model:e.param,"label-width":"120px",rules:e.rules}},[t("el-row",[t("el-col",{attrs:{span:24}},[t("el-form-item",{attrs:{label:"模块",prop:"modelName",rules:e.rules.modelName}},[t("el-input",{attrs:{disabled:"",placeholder:"请选择模块","show-word-limit":""},model:{value:e.param.modelName,callback:function(t){e.$set(e.param,"modelName","string"==typeof t?t.trim():t)},expression:"param.modelName"}})],1),t("el-form-item",{attrs:{label:"表名",prop:"tableName",rules:e.rules.tableName}},[t("el-input",{attrs:{placeholder:"请输入表名",maxlength:"200","show-word-limit":""},model:{value:e.param.tableName,callback:function(t){e.$set(e.param,"tableName","string"==typeof t?t.trim():t)},expression:"param.tableName"}})],1),t("el-form-item",{attrs:{label:"表注释",prop:"tableComment",rules:e.rules.tableComment}},[t("el-input",{attrs:{placeholder:"请输入表注释",maxlength:"200","show-word-limit":""},model:{value:e.param.tableComment,callback:function(t){e.$set(e.param,"tableComment","string"==typeof t?t.trim():t)},expression:"param.tableComment"}})],1)],1),t("el-col",{attrs:{span:24}},[t("table",{staticClass:"custom_table custom_table1"},[t("thead",[t("tr",[t("th",[e._v("序号")]),t("th",[e._v("列名")]),t("th",[e._v("列中文名")]),t("th",[e._v("类型")]),t("th",[e._v("可为空")]),t("th",[e._v("主键")]),t("th",[e._v("长度")]),t("th",[e._v("精度")]),t("th",[t("el-tooltip",{staticClass:"item",attrs:{size:"mini",effect:"dark",content:"新增",placement:"top-start"}},[t("el-button",{attrs:{size:"mini",type:"primary",icon:"el-icon-plus",circle:""},on:{click:e.addRow}})],1)],1)])]),t("tbody",e._l(e.param.columnInfoList,(function(a,r){return t("tr",{key:r},[t("td",[t("label",[e._v(e._s(r+1))])]),t("td",[t("el-input",{attrs:{size:"mini",placeholder:"请输入",maxlength:"200","show-word-limit":""},model:{value:a.columnName,callback:function(t){e.$set(a,"columnName","string"==typeof t?t.trim():t)},expression:"i.columnName"}})],1),t("td",[t("el-input",{attrs:{size:"mini",placeholder:"请输入",maxlength:"200","show-word-limit":""},model:{value:a.columnComment,callback:function(t){e.$set(a,"columnComment","string"==typeof t?t.trim():t)},expression:"i.columnComment"}})],1),t("td",[t("el-select",{attrs:{filterable:"",size:"mini"},model:{value:a.columnType,callback:function(t){e.$set(a,"columnType",t)},expression:"i.columnType"}},e._l(e.dataTypeOptions,(function(e){return t("el-option",{key:e.code,attrs:{label:e.name,value:e.code}})})),1)],1),t("td",[t("el-select",{attrs:{size:"mini"},model:{value:a.nullAble,callback:function(t){e.$set(a,"nullAble",t)},expression:"i.nullAble"}},[t("el-option",{key:"1",attrs:{label:"Y",value:"1"}}),t("el-option",{key:"0",attrs:{label:"N",value:"0"}})],1)],1),t("td",[t("el-select",{attrs:{size:"mini"},model:{value:a.primaryKey,callback:function(t){e.$set(a,"primaryKey",t)},expression:"i.primaryKey"}},[t("el-option",{key:"1",attrs:{label:"是",value:"1"}}),t("el-option",{key:"0",attrs:{label:"否",value:"0"}})],1)],1),t("td",[t("el-input",{attrs:{size:"mini",placeholder:"请输入",maxlength:"200","show-word-limit":""},model:{value:a.length,callback:function(t){e.$set(a,"length","string"==typeof t?t.trim():t)},expression:"i.length"}})],1),t("td",[t("el-input",{attrs:{size:"mini",placeholder:"请输入",maxlength:"200","show-word-limit":""},model:{value:a.scale,callback:function(t){e.$set(a,"scale","string"==typeof t?t.trim():t)},expression:"i.scale"}})],1),t("td",[t("el-tooltip",{staticClass:"item",attrs:{size:"mini",effect:"dark",content:"删除",placement:"top-start"}},[t("i",{staticClass:"el-icon-remove",style:{color:"#f00"},on:{click:function(t){return e.removeRow(r)}}})])],1)])})),0)])])],1)],1)]],2),t("el-tab-pane",{attrs:{label:"导入建表",name:"second"}},[[t("i",{staticClass:"iconfont icondaochu2 audaque-rect-icon",staticStyle:{cursor:"pointer"},attrs:{title:"下载导入模板"},on:{click:function(t){return e.exportFun(e.path)}}},[e._v("下载导入模板")]),t("i",{staticClass:"iconfont icondaoru1 audaque-rect-icon import-template",staticStyle:{cursor:"pointer"},on:{click:function(t){return e.$refs.upload.click()}}},[e._v("导入模板\n                                "),t("input",{ref:"upload",staticClass:"inputFile",staticStyle:{display:"none"},attrs:{type:"file",accept:".xls,.xlsx"},on:{change:function(t){return e.handleUpload(t)}}})])]],2),t("el-tab-pane",{attrs:{label:"DDL建表",name:"third"}},[[t("el-form",{ref:"createTableByDdl",staticClass:"form-item",attrs:{model:e.param,"label-width":"120px",rules:e.rules}},[t("el-row",[t("el-col",{attrs:{span:24}},[t("el-form-item",{attrs:{label:"模块",prop:"modelName",rules:e.rules.modelName}},[t("el-input",{attrs:{disabled:"",placeholder:"请选择模块","show-word-limit":""},model:{value:e.param.modelName,callback:function(t){e.$set(e.param,"modelName","string"==typeof t?t.trim():t)},expression:"param.modelName"}})],1),t("el-form-item",{attrs:{label:"DDL语句",prop:"sql",rules:e.rules.sql}},[t("el-input",{attrs:{rows:15,placeholder:"请输入sql",type:"textarea"},model:{value:e.param.sql,callback:function(t){e.$set(e.param,"sql","string"==typeof t?t.trim():t)},expression:"param.sql"}})],1)],1)],1)],1)]],2)],1)],1)],2)],1),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:e.handleClose}},[e._v("取 消")]),t("el-button",{attrs:{type:"primary"},on:{click:e.subBtn}},[e._v("创建")])],1)])}),[],!1,null,"0431ed02",null);t.default=d.exports},"77d62":function(e,t,a){var r=a("0898");r.__esModule&&(r=r.default),"string"==typeof r&&(r=[[e.i,r,""]]),r.locals&&(e.exports=r.locals),(0,a("499e").default)("3830b238",r,!0,{sourceMap:!1,shadowMode:!1})},"8ecc":function(e,t,a){(e.exports=a("2350")(!1)).push([e.i,".row[data-v-99ccb9a0]{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:end;-ms-flex-pack:end;justify-content:flex-end;-webkit-box-align:start;-ms-flex-align:start;align-items:flex-start;-ms-flex-wrap:nowrap;flex-wrap:nowrap}.row>div[data-v-99ccb9a0]:first-child{margin-right:10px}.flex[data-v-99ccb9a0]{height:100%;display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-ms-flex-wrap:nowrap;flex-wrap:nowrap}.flex[data-v-99ccb9a0] .el-form-item{margin-bottom:0!important}.flex[data-v-99ccb9a0] .el-form-item__content{margin-left:0!important}[data-v-99ccb9a0] .el-table td,[data-v-99ccb9a0] .el-table th,[data-v-99ccb9a0] .el-table th.el-table__cell>.cell{text-align:center!important}[data-v-99ccb9a0] .el-form{width:90%;margin:0 auto}.tips[data-v-99ccb9a0]{padding-top:5px;display:inline-block;color:#e6a23c}.checkboxrow[data-v-99ccb9a0]{width:80%;margin:0 0 10px 0}.rule-type[data-v-99ccb9a0]{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-ms-flex-wrap:wrap;flex-wrap:wrap}.rule-type span[data-v-99ccb9a0]{display:inline-block}.operate[data-v-99ccb9a0]{cursor:pointer;color:#53a7f8;font-size:12px}.require[data-v-99ccb9a0]{color:#f56c6c;font-size:16px;margin:0 3px}[data-v-99ccb9a0] .el-dialog__body{max-height:100%!important}[data-v-99ccb9a0] .pane-comp,[data-v-99ccb9a0] .tree-dashed{overflow:auto}.sql_btn_group[data-v-99ccb9a0]{margin-bottom:10px}",""])},9045:function(e,t,a){var r=a("e738");r.__esModule&&(r=r.default),"string"==typeof r&&(r=[[e.i,r,""]]),r.locals&&(e.exports=r.locals),(0,a("499e").default)("2fda1bf3",r,!0,{sourceMap:!1,shadowMode:!1})},"92e8":function(e,t,a){(e.exports=a("2350")(!1)).push([e.i,"[data-v-1b5a4e2b] .el-table td,[data-v-1b5a4e2b] .el-table th,[data-v-1b5a4e2b] .el-table th.el-table__cell>.cell{text-align:center!important}[data-v-1b5a4e2b] .el-form{width:90%;margin:0 auto}.tips[data-v-1b5a4e2b]{padding-top:5px;display:inline-block;color:#e6a23c}.checkboxrow[data-v-1b5a4e2b]{width:80%;margin:10px 0}.rule-type[data-v-1b5a4e2b]{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-ms-flex-wrap:wrap;flex-wrap:wrap}.rule-type span[data-v-1b5a4e2b]{display:inline-block}.operate[data-v-1b5a4e2b]{cursor:pointer;color:#53a7f8;font-size:12px}.require[data-v-1b5a4e2b]{color:#f56c6c;font-size:16px;margin:0 3px}",""])},9516:function(e,t,a){"use strict";a("4bca")},"95b6":function(e,t,a){"use strict";a.r(t),a("28a5"),a("6762"),a("2fdb"),a("8e6e"),a("ac6a"),a("456d");var r=a("ade3"),n=a("2f62"),o=a("e762");function i(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function l(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?i(Object(a),!0).forEach((function(t){Object(r.a)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):i(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var s={props:["show","selectParam","sqlResponse"],data:function(){return{storey:["au_ods","au_std","au_dwd","au_dwm","au_dws","au_app"]}},components:{},computed:{decodeStr:function(){return function(e){return Object(o.a)(decodeURIComponent(e))}}},mounted:function(){},methods:l(l({},Object(n.b)(["_AJAX"])),{},{handleClose:function(){this.$emit("close")}})},c=a("2877"),u=Object(c.a)(s,(function(){var e=this,t=e._self._c;return t("el-dialog",{staticStyle:{height:"80vh"},attrs:{title:"自动建表",visible:e.show,width:"80%","before-close":e.handleClose,"append-to-body":""},on:{"update:visible":function(t){e.show=t}}},[t("div",{staticStyle:{padding:"20px"}},[0===e.sqlResponse.code&&e.sqlResponse.message.includes("$")?t("div",[t("div",[e._v("日志："+e._s(e.sqlResponse.message.split("$")[0]))]),t("div",[e._v("语句："+e._s(e.decodeStr(e.sqlResponse.message.split("$")[1])))])]):0!==e.sqlResponse.code||e.sqlResponse.message.includes("$")?1e4===e.sqlResponse.code?t("div",[e.sqlResponse.data.sqlStr?t("div",[e._v("\n                "+e._s(e.sqlResponse.data.sqlStr)+"\n            ")]):t("div",[e._v("成功")])]):e._e():t("div",[t("div",[e._v("日志："+e._s(e.sqlResponse.message))])])]),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"})])}),[],!1,null,"b921deea",null);t.default=u.exports},a80c:function(e,t,a){(e.exports=a("2350")(!1)).push([e.i,"[data-v-9eb4d822] .el-table td,[data-v-9eb4d822] .el-table th,[data-v-9eb4d822] .el-table th.el-table__cell>.cell{text-align:center!important}[data-v-9eb4d822] .el-form{width:90%;margin:0 auto}.flex[data-v-9eb4d822]{height:100%;display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-ms-flex-wrap:nowrap;flex-wrap:nowrap}.flex[data-v-9eb4d822] .el-form-item{margin-bottom:0!important}.tips[data-v-9eb4d822]{padding-top:5px;display:inline-block;color:#e6a23c}.checkboxrow[data-v-9eb4d822]{width:80%;margin:0 0 10px 0}.rule-type[data-v-9eb4d822]{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-ms-flex-wrap:wrap;flex-wrap:wrap}.rule-type span[data-v-9eb4d822]{display:inline-block}.operate[data-v-9eb4d822]{cursor:pointer;color:#53a7f8;font-size:12px}.require[data-v-9eb4d822]{color:#f56c6c;font-size:16px;margin:0 3px}",""])},adfa:function(e,t,a){"use strict";a("45b3")},b3b5:function(e,t,a){var r=a("3b6f0");r.__esModule&&(r=r.default),"string"==typeof r&&(r=[[e.i,r,""]]),r.locals&&(e.exports=r.locals),(0,a("499e").default)("b516a316",r,!0,{sourceMap:!1,shadowMode:!1})},b781:function(e,t,a){"use strict";a.r(t),a("7f7f"),a("8e6e"),a("456d"),a("8615"),a("6762"),a("2fdb"),a("ac6a"),a("5df3"),a("4f7f"),a("7514");var r=a("ade3"),n=a("2f62"),o=a("db05"),i=a.n(o),l=a("f029"),s=a("e762");function c(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function u(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?c(Object(a),!0).forEach((function(t){Object(r.a)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):c(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var d={props:["selectParam"],watch:{newSelectParam:{handler:function(e){var t=this;this.$nextTick((function(){t.$store.state.fusionTask.isLoading||e.alreadySelectTargetTable.length>0&&(t.param.sourceTableName=e.sourceRows[0].alreadySelectSourceTable[0].tableName,t.param.targetTableName=e.alreadySelectTargetTable[0].tableName,t.param.sourceTableId=e.sourceRows[0].alreadySelectSourceTable[0].id,t.param.targetTableId=e.alreadySelectTargetTable[0].id,t.param.automaticTableCreation=e.isAutoCreate,t.basicInfoForm.sqlMain="",t.getCloumnList(e.sourceRows[0].alreadySelectSourceTable[0].id,e.alreadySelectTargetTable[0].id))}))},deep:!0}},data:function(){return{basicInfoForm:{sqlMain:""},isDot:!1,treeCheckId:"",indexs:"",dispositionheard:[],dispositionData:[],dispositionExpand:"",ruleobjet:{},catCode:"",taile:"",pages:{page:1,rows:10,total:0,name:""},defaultProps:{label:"name",children:"children"},treeExpandData:[],datasCondition:[],showCondition:!1,activeName:"first",autoMapValue:!1,initReportValue:!1,sourceName:"",tagName:"",param:{sourceTableName:"",targetTableName:"",tableInfo:[],initReport:"",automaticTableCreation:"",whereCondition:"",sqlValue:"",taskId:this.$route.query.taskId,sourceTableId:"",targetTableId:"",stepId:"",stepDetailId:"",levelCode:"au_std",complete:0},lastWhere:"",targetColumnOptions:[],rules:{sourceDatabase:[{required:!0,message:"请选择",trigger:"change"}],whereCondition:[{validator:function(e,t,a){/^where\s+/i.test(t)||/^WHERE\s+/i.test(t)?a(new Error("where条件不需填写where关键字")):a()},trigger:"blur"}]},alreadySelectTargetTable:[]}},components:{SqlEditor:l.default},computed:u(u({},Object(n.d)("stepStd",[])),{},{newSelectParam:function(){return u({},this.selectParam)},computedStand:function(){return function(e){return""!==e.sourceColumnId&&null!==e.sourceColumnId}}}),mounted:function(){},methods:u(u(u({},Object(n.b)("stepStd",["INSERTORUPDATE"])),Object(n.b)(["_AJAX"])),{},{changeOrnotWhere:function(){null!=this.lastWhere&&""!=this.lastWhere&&this.lastWhere!=this.param.whereCondition&&(this.param.sqlValue="",this.basicInfoForm.sqlMain="",this.isDot=!0)},handleSelect:function(e){this.param.sqlValue="",this.basicInfoForm.sqlMain="",this.isDot=!0,this.param.tableInfo[e].ruleId="",this.param.tableInfo[e].ruleName="",this.param.tableInfo[e].catCode="";var t=this.param.tableInfo[e].targetValue;this.param.tableInfo[e].sourceColumnId=null!=t&&""!=t?this.targetColumnOptions.find((function(e){return e.id===t})).sourceColumnId:""},rowChange:function(e){var t=this;this.dispositionExpand==e.selfId?this.$nextTick((function(){t.dispositionExpand="",t.ruleobjet={}})):this.$nextTick((function(){t.dispositionExpand=e.selfId,t.ruleobjet=e}))},radioCancelSelect:function(e,t,a){var r=this;"INPUT"!==e.target.tagName&&(this.dispositionExpand==a?this.$nextTick((function(){r.dispositionExpand="",r.ruleobjet={}})):this.$nextTick((function(){r.dispositionExpand=t.selfId,r.ruleobjet=t})))},gettargetList:function(){var e=this;return new Promise((function(t){e._AJAX({url:"appStep.getColumnList",method:"GET",data:{sourceTableId:e.param.sourceTableId,targetTableId:e.param.targetTableId}}).then((function(a){e.targetColumnOptions=a[e.param.targetTableId],t(a)}))}))},deepClone:function(e){return JSON.parse(JSON.stringify(e))},generateSql:function(){var e=this,t=this.param.tableInfo.filter((function(e){return""!=e.targetValue&&null!=e.targetValue})).map((function(e){return e.targetValue}));if(new Set(t).size!==t.length)this.$message.error("目标表的表字段不允许重复");else{var a=this.param.tableInfo.filter((function(e){return null!=e.sourceColumnId&&""!=e.sourceColumnId})),r=this.param.tableInfo.filter((function(e){return null!=e.targetValue&&""!=e.targetValue})).map((function(e){return e.targetValue}));if(r.length>0&&a.filter((function(e){return r.includes(e.sourceColumnId)})).length>0)return void this.$message.error("目标表的表字段的标准列已经被选中");if(this.param.tableInfo.every((function(e){return""===e.targetValue||null===e.targetValue})))this.$message.error("目标表的字段最少填一个，不可全部为空");else{var n=this.deepClone(this.param);this.initReportValue?n.initReport=1:n.initReport=0,n.automaticTableCreation?n.automaticTableCreation=1:n.automaticTableCreation=0,n.sqlValue=Object(s.b)(this.basicInfoForm.sqlMain),n.whereCondition=Object(s.b)(n.whereCondition),this._AJAX({url:"stdStep.getStdStepSql",method:"POST",data:n}).then((function(t){e.lastWhere=e.param.whereCondition,e.$set(e.basicInfoForm,"sqlMain",t),e.$refs.sqleditor.setVal();var a=e.activeName;e.activeName="",e.$nextTick((function(){e.activeName=a})),e.isDot=!1,e.$message.success("生成SQL成功！")}))}}},changeTextarea:function(e){this.$set(this.basicInfoForm,"sqlMain",e)},formaterSql:function(){var e=this.$refs.sqleditor;e.editor.setValue(i.a.format(e.editor.getValue()))},Automaticmapping:function(e){var t=this;e?this.param.tableInfo.forEach((function(e){var a=t.targetColumnOptions.filter((function(e){return null!==e.sourceColumnId&&""!=e.sourceColumnId})),r=a.map((function(e){return e.sourceColumnId}));if(r.length>0){var n=t.targetColumnOptions.filter((function(e){return r.includes(e.id)})).filter((function(t){return t.columnName==e.sourceValue}));if(n.length>0){var o=a.filter((function(e){return e.sourceColumnId==n[0].id}));if(o.length>0)e.targetValue=o[0].id,e.sourceColumnId=o[0].sourceColumnId;else{var i=t.targetColumnOptions.find((function(t){return t.columnName===e.sourceValue}));e.targetValue=i?i.id:""}}else{var l=t.targetColumnOptions.find((function(t){return t.columnName===e.sourceValue}));e.targetValue=l?l.id:""}}else{var s=t.targetColumnOptions.find((function(t){return t.columnName===e.sourceValue}));e.targetValue=s?s.id:""}})):this.param.tableInfo.forEach((function(e){e.targetValue="",e.sourceColumnId=""}))},getopendialog:function(e){var t=this;this._AJAX({url:"stdStep.configurationMenuList",method:"GET"}).then((function(a){t.datasCondition=a,t.ruleobjet={},t.dispositionExpand="",""!=t.param.tableInfo[e].catCode?(t.dispositionExpand=t.param.tableInfo[e].catCode+"&"+t.param.tableInfo[e].ruleId,t.catCode=t.param.tableInfo[e].catCode):(t.catCode="SOURCE_CODE_MAPPING",t.dispositionData=[],t.dispositionheard=[]),t.getDisposition({code:t.catCode}),t.indexs=e,t.showCondition=!0}))},getCloumnList:function(e,t){var a=this;this._AJAX({url:"appStep.getColumnList",method:"GET",data:{sourceTableId:e,targetTableId:t}}).then((function(r){a.param.tableInfo=r[e].map((function(e){return{sourceid:e.id,sourceValue:e.columnName,additionColumn:e.additionColumn,targetValue:"",ruleId:"",catCode:"",ruleName:"",sourceColumnId:""}})),a.targetColumnOptions=r[t]}))},onSubmit:function(){var e=this.param.tableInfo[this.indexs];null!==this.targetColumnOptions.find((function(t){return t.id===e.targetValue})).sourceColumnId||"SOURCE_CODE_MAPPING"!=this.catCode?(e.ruleId=this.ruleobjet.id||"",e.catCode=this.ruleobjet.id?this.catCode:"","SOURCE_CODE_MAPPING"==this.catCode&&(e.ruleName=this.ruleobjet.sourceCodeName||""),"FUNCTION"==this.catCode&&(e.ruleName=this.ruleobjet.example||""),this.showCondition=!1):this.$message.warning("该字段列不是标准列，不能选源代码映射")},handleSizeChange:function(e){this.pages.page=1,this.pages.rows=e,this.getDisposition({code:this.catCode})},handleCurrentChange:function(e){this.pages.page=e,this.getDisposition({code:this.catCode})},onSearch:function(){this.getDisposition({code:this.catCode})},getDisposition:function(e){var t=this;"SOURCE_CODE_MAPPING"==e.code?this._AJAX({url:"stdStep.dgpCodeMappingPage",method:"GET",data:this.pages}).then((function(a){t.taile="通过源代码名称模糊查询",t.dispositionheard=a.heard;var r=a.data.rows;t.pages.total=a.data.total,r.forEach((function(t){t.selfId="".concat(e.code,"&").concat(t.id)})),t.dispositionData=r})):"FUNCTION"==e.code&&this._AJAX({url:"stdStep.fuctionPage",method:"GET",data:this.pages}).then((function(a){t.taile="通过函数名称、函数英文名模糊查询",t.dispositionheard=a.heard;var r=a.data.rows;t.pages.total=a.data.total,r.forEach((function(t){t.selfId="".concat(e.code,"&").concat(t.id)})),t.dispositionData=r}))},handleClose:function(){this.pages.name="",this.showCondition=!1},handleNodeClick:function(e){this.catCode=e.code,this.getDisposition({code:e.code})},handleClick:function(){},handleStep:function(e){var t=this;return this.$store.commit("fusionTask/changeLoading",!0),new Promise((function(a,r){e>0&&t._AJAX({url:"stdStep.getStepStdDeail",method:"GET",data:{taskId:t.param.taskId,levelCode:t.param.levelCode}}).then((function(e){Object.values(e).some((function(e){return null!==e}))&&(t.param=e,t.param.complete=0,t.param.levelCode="au_std",0==e.initReport?t.initReportValue=!1:t.initReportValue=!0,t.gettargetList().then((function(){setTimeout((function(){t.$store.commit("fusionTask/changeLoading",!1)})),t.$nextTick((function(){t.basicInfoForm.sqlMain=t.param.sqlValue})),a(e)})))})).catch((function(e){r(e)}))}))},next:function(e){var t=this;return this.param.stepId=e,new Promise((function(e,a){var r=t.param.tableInfo.filter((function(e){return""!=e.targetValue&&null!=e.targetValue})).map((function(e){return e.targetValue}));if(new Set(r).size!==r.length)t.$message.error("目标表的表字段不允许重复");else{var n=t.param.tableInfo.filter((function(e){return null!=e.sourceColumnId&&""!=e.sourceColumnId})),o=t.param.tableInfo.filter((function(e){return null!=e.targetValue&&""!=e.targetValue})).map((function(e){return e.targetValue}));if(o.length>0&&n.filter((function(e){return o.includes(e.sourceColumnId)})).length>0)return void t.$message.error("目标表的表字段的标准列已经被选中");""!==t.basicInfoForm.sqlMain?t.param.tableInfo.every((function(e){return""===e.targetValue||null===e.targetValue&&""!=e.targetValue}))?t.$message.error("目标表的字段最少填一个，不可全部为空"):t.$refs.stepStandardLayerForm.validate((function(r){if(r){t.$store.commit("fusionTask/changeLoading",!0);var n=t.deepClone(t.param);t.initReportValue?n.initReport=1:n.initReport=0,t.param.automaticTableCreation?n.automaticTableCreation=1:n.automaticTableCreation=0,n.sqlValue=Object(s.b)(t.basicInfoForm.sqlMain),n.whereCondition=Object(s.b)(t.param.whereCondition),t.INSERTORUPDATE(n).then((function(t){e(t)})).catch((function(e){a(e)}))}})):t.$message.error("sql不可以为空，请去填写sql")}}))},submit:function(e){var t=this;return this.param.stepId=e,this.param.complete=1,new Promise((function(e,a){var r=t.param.tableInfo.filter((function(e){return""!=e.targetValue&&null!=e.targetValue})).map((function(e){return e.targetValue}));if(new Set(r).size!==r.length)t.$message.error("目标表的表字段不允许重复");else{var n=t.param.tableInfo.filter((function(e){return null!=e.sourceColumnId&&""!=e.sourceColumnId})),o=t.param.tableInfo.filter((function(e){return null!=e.targetValue&&""!=e.targetValue})).map((function(e){return e.targetValue}));if(o.length>0&&n.filter((function(e){return o.includes(e.sourceColumnId)})).length>0)return void t.$message.error("目标表的表字段的标准列已经被选中");""!=t.basicInfoForm.sqlMain||null!=t.basicInfoForm.sqlMain?t.param.tableInfo.every((function(e){return""===e.targetValue||null===e.targetValue}))?t.$message.error("目标表的字段最少填一个，不可全部为空"):t.$refs.stepStandardLayerForm.validate((function(r){if(r){t.$store.commit("fusionTask/changeLoading",!0);var n=t.deepClone(t.param);t.initReportValue?n.initReport=1:n.initReport=0,t.param.automaticTableCreation?n.automaticTableCreation=1:n.automaticTableCreation=0,n.sqlValue=Object(s.b)(t.basicInfoForm.sqlMain),n.whereCondition=Object(s.b)(t.param.whereCondition),t.INSERTORUPDATE(n).then((function(a){t.$store.commit("fusionTask/changeLoading",!1),e(a)})).catch((function(e){t.$store.commit("fusionTask/changeLoading",!1),a(e)}))}})):t.$message.error("sql不可以为空，请去填写sql")}}))}})},p=(a("adfa"),a("2877")),m=Object(p.a)(d,(function(){var e=this,t=e._self._c;return t("div",[t("el-form",{ref:"stepStandardLayerForm",staticClass:"form-item",attrs:{model:e.param,"label-width":"120px",rules:e.rules,"label-position":"left",disabled:"view"===e.$route.query.filter}},[t("div",[t("el-tabs",{attrs:{type:"card"},on:{"tab-click":e.handleClick},model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},[t("el-tab-pane",{attrs:{label:"字段映射",name:"first"}},[t("div",[t("div",{staticClass:"checkboxrow"},[t("el-button",{attrs:{size:"mini",plain:"",type:"primary"},on:{click:function(t){return e.Automaticmapping(!0)}}},[e._v("字段自动映射")])],1),t("el-table",{ref:"tableData",staticStyle:{width:"100%",margin:"0 auto"},attrs:{data:e.param.tableInfo,border:""}},[t("el-table-column",{attrs:{prop:"sourceValue",label:e.param.sourceTableName,align:"center"}}),t("el-table-column",{attrs:{label:e.param.targetTableName,prop:"targetValue"},scopedSlots:e._u([{key:"default",fn:function(a){return[e.targetColumnOptions.length>0?t("div",{staticClass:"flex"},[t("el-form-item",{attrs:{rules:{required:!0,message:"请选择",trigger:"change"}}},[t("el-select",{attrs:{placeholder:"请选择",clearable:""},on:{change:function(t){return e.handleSelect(a.$index)}},model:{value:a.row.targetValue,callback:function(t){e.$set(a.row,"targetValue",t)},expression:"scope.row.targetValue"}},e._l(e.targetColumnOptions,(function(e){return t("el-option",{key:e.id,attrs:{label:e.columnName,value:e.id}})})),1)],1)],1):e._e()]}}])}),t("el-table-column",{attrs:{label:"是否标准列"},scopedSlots:e._u([{key:"default",fn:function(a){return[e.computedStand(a.row)?t("span",{staticStyle:{color:"#d00d0d"}},[e._v("标准列")]):e._e()]}}])}),t("el-table-column",{attrs:{prop:"ruleId",width:"450",align:"center"},scopedSlots:e._u([{key:"header",fn:function(){return[t("span",[e._v("标准转换")]),t("el-tooltip",{staticClass:"item",staticStyle:{"padding-left":"3px"},attrs:{effect:"dark",placement:"right"}},[t("div",{attrs:{slot:"content"},slot:"content"},[e._v("\n                                            注：只有标准列才可以添加源代码映射，在模型/模型分层/标准层中添加标准列\n                                        ")]),t("i",{staticClass:"content-view iconfont iconbangzhu operate"})])]},proxy:!0},{key:"default",fn:function(a){return[0==a.row.additionColumn&&""!=a.row.targetValue&&null!=a.row.targetValue?t("div",{staticClass:"flex"},[t("el-form-item",[t("el-input",{attrs:{disabled:""==a.row.catCode||"SOURCE_CODE_MAPPING"==a.row.catCode||null==a.row.catCode},model:{value:a.row.ruleName,callback:function(t){e.$set(a.row,"ruleName",t)},expression:"scope.row.ruleName"}}),t("el-button",{attrs:{type:"primary",icon:"el-icon-edit",size:"mini",circle:""},on:{click:function(t){return e.getopendialog(a.$index)}}})],1)],1):e._e()]}}])})],1),t("br"),t("el-form-item",{attrs:{prop:"whereCondition"}},[t("template",{slot:"label"},[t("span",[e._v("where条件")]),t("el-tooltip",{staticClass:"item",staticStyle:{"padding-left":"10px"},attrs:{effect:"dark",placement:"right"}},[t("div",{attrs:{slot:"content"},slot:"content"},[e._v("\n                                        注：where条件不需填写where关键字\n                                    ")]),t("i",{staticClass:"content-view iconfont iconbangzhu operate"})])],1),t("el-input",{attrs:{type:"textarea",rows:5,placeholder:"请输入内容"},on:{blur:e.changeOrnotWhere},model:{value:e.param.whereCondition,callback:function(t){e.$set(e.param,"whereCondition",t)},expression:"param.whereCondition"}})],2)],1)]),t("el-tab-pane",{attrs:{name:"second"}},[t("template",{slot:"label"},[t("el-badge",{attrs:{"is-dot":e.isDot}},[e._v("\n                            SQL\n                            "),t("el-tooltip",{staticClass:"item",attrs:{effect:"dark",placement:"right"}},[t("div",{attrs:{slot:"content"},slot:"content"},[e._v("\n                                    注：红点标记表示字段映射或配置发生改变，需要切换到sql页面重新生成sql\n                                ")]),t("i",{staticClass:"content-view iconfont iconbangzhu operate"})])],1)],1),"second"===e.activeName?t("div",[t("div",{staticClass:"sql_btn_group"},[t("el-button",{attrs:{type:"primary",size:"mini",plain:""},on:{click:e.generateSql}},[e._v("生成SQL")]),t("el-button",{attrs:{type:"primary",size:"mini",plain:""},on:{click:function(t){return e.formaterSql(e.basicInfoForm.sqlMain)}}},[e._v("格式化SQL")])],1),t("SqlEditor",{ref:"sqleditor",attrs:{value:e.basicInfoForm.sqlMain},on:{changeTextarea:function(t){return e.changeTextarea(t)}}})],1):e._e()],2)],1)],1)]),e.showCondition?t("el-dialog",{attrs:{title:"标准转换配置",visible:e.showCondition,width:"80%","before-close":e.handleClose,"append-to-body":""},on:{"update:visible":function(t){e.showCondition=t}}},[t("div",{staticClass:"custom-container",staticStyle:{height:"60vh"}},[t("audaque-resize-split-page",[t("template",{slot:"leftPane"},[t("el-tree",{ref:"tree",staticClass:"tree-dashed",attrs:{data:e.datasCondition,props:e.defaultProps,"default-expanded-keys":e.treeExpandData,"current-node-key":e.catCode,"node-key":"code"},on:{"node-click":e.handleNodeClick}})],1),t("template",{slot:"rightPane"},[t("div",{staticClass:"row",staticStyle:{"margin-bottom":"10px"}},[t("div",{staticStyle:{width:"50%"}},[t("el-input",{attrs:{placeholder:e.taile,clearable:""},model:{value:e.pages.name,callback:function(t){e.$set(e.pages,"name",t)},expression:"pages.name"}})],1),t("div",[t("el-button",{attrs:{type:"primary"},on:{click:e.onSearch}},[e._v("筛选")])],1)]),t("el-table",{staticClass:"el-table-common__list",attrs:{"tooltip-effect":"light","highlight-current-row":"",stripe:"",data:e.dispositionData,border:""},on:{"row-click":e.rowChange}},[e.dispositionData.length>0?t("el-table-column",{attrs:{label:"选择"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-radio",{staticClass:"radio",attrs:{label:a.row.selfId},nativeOn:{click:function(t){return t.preventDefault(),t.stopPropagation(),e.radioCancelSelect(t,a.row,a.row.selfId)}},model:{value:e.dispositionExpand,callback:function(t){e.dispositionExpand=t},expression:"dispositionExpand"}},[e._v(" ")])]}}],null,!1,2164990980)}):e._e(),e.dispositionData.length>0?t("el-table-column",{attrs:{"show-overflow-tooltip":"",type:"index",label:"序号",index:function(t){return e.$utils._indexMethod(t,e.pages.page,e.pages.rows)},align:"center",width:"80"}}):e._e(),e._l(e.dispositionheard,(function(e,a){return[t("el-table-column",{key:a,attrs:{"show-overflow-tooltip":"",align:"center",prop:e.name,label:e.code}})]}))],2),t("adq-pagination",{attrs:{"current-page":e.pages.page,total:e.pages.total,"page-size":e.pages.rows},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],1)],2)],1),t("div",{attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:e.handleClose}},[e._v("取消")]),t("el-button",{attrs:{type:"primary"},on:{click:e.onSubmit}},[e._v("确认")])],1)]):e._e()],1)}),[],!1,null,"99ccb9a0",null);t.default=m.exports},bf24:function(e,t,a){"use strict";a.r(t),a("ac6a"),a("7514");var r={props:["selectParam"],watch:{selectParam:{handler:function(e){},deep:!0}},data:function(){return{showGovernanceAuditRules:!1,currentType:{type:"",index:""},currentGAId:"",activeName:"first",sqlValue:"",autoMapValue:!1,initReportValue:!1,param:{whereCondition:"",tableData:[],asyncConfig:1,growField:""},rules:{sourceDatabase:[{required:!0,message:"请选择",trigger:"change"}]},tableHead:[],alreadySelectTargetTable:[]}},components:{governanceAuditRules:a("1794").default},computed:{comSourceIsDisabled:function(){return function(e){return 1!==e.value&&""!==this.selectParam.targetDatabase&&e.value>this.param.targetDatabase}},comTargetIsDisabled:function(){return function(e){var t=this.selectParam.sourceRows.filter((function(e){return""!==e.sourceDatabase}));if(0===t.length)return!1;var a=t.reduce((function(e,t){return e.value>t.sourceDatabase?e:t})),r=this.selectParam.sourceRows.find((function(e){return""!==e.sourceDatabase}));return!!(1!==e.value&&r&&e.value<=a.sourceDatabase)}}},mounted:function(){},methods:{selectGATable:function(e){this.currentGAId=e,this.showGovernanceAuditRules=!0},handleClick:function(){},createTbleAuto:function(){var e=this;this.$nextTick((function(){if(e.selectParam.autoCreate&&!e.selectParam.sourceRows.find((function(e){return 0===e.alreadySelectSourceTableValue.length}))&&0!==e.selectParam.alreadySelectTargetTable.length){e.param.tableData=[],e.tableHead=[],e.selectParam.sourceRows.forEach((function(t){var a=t.alreadySelectSourceTableValue[0],r=t.alreadySelectSourceTable.find((function(e){return e.id===a})).slot1;e.tableHead.push(r)})),e.selectParam.alreadySelectTargetTableValue.forEach((function(t){var a=e.selectParam.alreadySelectTargetTable.find((function(e){return e.id===t})).slot1;e.tableHead.push(a)}));var t={};e.tableHead.forEach((function(e){t[e]=1,t.options=[{value:1,label:"字段1"},{value:2,label:"字段2"}],t.selectValue="",t.id=1,t.ruletypes=[]})),e.param.tableData.push(t),e.$refs.tableData&&e.$refs.tableData.doLayout()}}))},initGA:function(e){var t=this;this.param.tableData.find((function(e){return e.id===t.currentGAId})).ruletypes=e.map((function(e){return e.slot1})),this.showGovernanceAuditRules=!1},delGA:function(e){this.param.tableData.find((function(t){return t.id===e})).ruletypes=[]},next:function(){var e=this;return new Promise((function(t,a){e.$refs.stepStartForm.validate((function(e){e?t(e):a(e)}))}))},submit:function(){var e=this;return new Promise((function(t,a){e.$refs.stepStartForm.validate((function(e){e?t(e):a(e)}))}))}}},n=(a("0f3d"),a("2877")),o=Object(n.a)(r,(function(){var e=this,t=e._self._c;return t("div",[t("el-form",{ref:"stepStartForm",staticClass:"form-item",attrs:{model:e.param,"label-width":"120px",rules:e.rules,"label-position":"left",disabled:"view"===e.$route.query.filter}},[t("div",[t("el-tabs",{attrs:{type:"card"},on:{"tab-click":e.handleClick},model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},[t("el-tab-pane",{attrs:{label:"字段映射",name:"first"}},[t("div",[t("div",{staticClass:"checkboxrow"},[t("el-checkbox",{model:{value:e.autoMapValue,callback:function(t){e.autoMapValue=t},expression:"autoMapValue"}},[e._v("字段自动映射")]),t("el-checkbox",{model:{value:e.initReportValue,callback:function(t){e.initReportValue=t},expression:"initReportValue"}},[e._v("生成质量稽查报告")])],1),t("el-table",{ref:"tableData",staticStyle:{width:"100%",margin:"0 auto"},attrs:{data:e.param.tableData,border:""}},[e._l(e.tableHead,(function(a,r){return t("el-table-column",{key:r,attrs:{prop:a,label:a,align:"center"},scopedSlots:e._u([{key:"default",fn:function(a){return 1===r?[e.selectParam.autoCreate?t("div",[e._v("-")]):t("el-form-item",{attrs:{prop:"tableData.".concat(a.$index,".selectValue"),rules:{required:!0,message:"请选择",trigger:"change"}}},[t("el-select",{attrs:{placeholder:"请选择"},model:{value:a.row.selectValue,callback:function(t){e.$set(a.row,"selectValue",t)},expression:"scope.row.selectValue"}},e._l(a.row.options,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1)]:void 0}}],null,!0)})})),t("el-table-column",{attrs:{label:"稽查规则",prop:"inspect",width:"400",align:"center"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("div",{staticClass:"rule-type"},[t("div",[e._v("SQL规则：")]),t("div",{staticClass:"rule-type-tag"},[e._l(a.row.ruletypes,(function(a,r){return t("el-tag",{key:r,attrs:{type:"success"}},[e._v(e._s(a))])})),e._v(" \n                                        ")],2)])]}}])}),e.initReportValue?t("el-table-column",{attrs:{prop:"operator",label:"稽查规则操作",width:"200",align:"center"},scopedSlots:e._u([{key:"default",fn:function(a){return[e._v("\n                                     "),t("span",{staticClass:"operate iconfont iconFill",on:{click:function(t){return e.selectGATable(a.row.id)}}}),e._v("\n                                     "),e.initReportValue?t("span",{staticClass:"iconfont iconShape1 operate",on:{click:function(t){return e.delGA(a.row.id)}}}):e._e()]}}],null,!1,3849815998)}):e._e()],2),t("el-form-item",{attrs:{label:"同步配置：",rules:{required:!0,message:"输入",trigger:"blur"},"class-name":"tablerow"}},[t("el-radio",{attrs:{label:1},model:{value:e.param.asyncConfig,callback:function(t){e.$set(e.param,"asyncConfig",t)},expression:"param.asyncConfig"}},[e._v("全量")]),t("el-radio",{attrs:{label:2},model:{value:e.param.asyncConfig,callback:function(t){e.$set(e.param,"asyncConfig",t)},expression:"param.asyncConfig"}},[e._v("增量")])],1),2===e.param.asyncConfig?t("el-form-item",{attrs:{label:"增量字段：",prop:"growField",rules:{required:!0,message:"请输入",trigger:"change"}}},[t("el-input",{attrs:{placeholder:"请输入内容"},model:{value:e.param.growField,callback:function(t){e.$set(e.param,"growField",t)},expression:"param.growField"}})],1):e._e(),t("el-form-item",{attrs:{label:"where条件",prop:"whereCondition",rules:{required:!0,message:"请输入",trigger:"change"}}},[t("el-input",{attrs:{type:"textarea",rows:5,placeholder:"请输入内容"},model:{value:e.param.whereCondition,callback:function(t){e.$set(e.param,"whereCondition",t)},expression:"param.whereCondition"}}),t("span",{staticClass:"tips"},[e._v("注：增量时可以设置，where条件不需填写where关键字")])],1)],1)]),t("el-tab-pane",{attrs:{label:"sql",name:"second"}},[t("div",[t("el-input",{attrs:{type:"textarea",rows:4,placeholder:"请输入内容"},model:{value:e.sqlValue,callback:function(t){e.sqlValue=t},expression:"sqlValue"}})],1)])],1)],1)]),t("governanceAuditRules",{attrs:{show:e.showGovernanceAuditRules},on:{submit:e.initGA,close:function(t){e.showGovernanceAuditRules=!1}}})],1)}),[],!1,null,"1b5a4e2b",null);t.default=o.exports},c0c7:function(e,t,a){"use strict";a.r(t),a("ac4d"),a("8a81"),a("1c4c"),a("6b54"),a("8e6e"),a("456d"),a("5df3"),a("4f7f"),a("7f7f"),a("a481"),a("ac6a"),a("7514");var r=a("ade3"),n=a("1794"),o=a("2f62"),i=a("e762"),l=a("f029");function s(e,t){var a="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!a){if(Array.isArray(e)||(a=function(e,t){if(e){if("string"==typeof e)return c(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);return"Object"===a&&e.constructor&&(a=e.constructor.name),"Map"===a||"Set"===a?Array.from(e):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?c(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){a&&(e=a);var r=0,n=function(){};return{s:n,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,i=!0,l=!1;return{s:function(){a=a.call(e)},n:function(){var e=a.next();return i=e.done,e},e:function(e){l=!0,o=e},f:function(){try{i||null==a.return||a.return()}finally{if(l)throw o}}}}function c(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function u(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function d(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?u(Object(a),!0).forEach((function(t){Object(r.a)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):u(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var p={props:["selectParam"],watch:{newSelectParam:{handler:function(e){var t=this;this.$nextTick((function(){t.$store.state.fusionTask.isLoading||(e.alreadySelectTargetTable.length>0?(t.sourceName=e.sourceRows[0].alreadySelectSourceTable[0].tableName,t.targetName=e.alreadySelectTargetTable[0].tableName,t.getColumn(e.sourceRows[0].alreadySelectSourceTable[0].id,e.alreadySelectTargetTable[0].id).then((function(a){t.param.tableInfo=a[e.sourceRows[0].alreadySelectSourceTable[0].id].map((function(e){return{id:e.id,name:e.columnName,targetValue:"",ruleId:"",catCode:""}})),t.targetColumnOptions=a[e.alreadySelectTargetTable[0].id]})),t.targetName=e.alreadySelectTargetTable[0].tableName):t.param.whereCondition="")}))},deep:!0}},data:function(){return{sourceColumnName:[],targetColumnName:[],selectedValue:"",stepId:"",sourceName:"",targetName:"",targetColumnOptions:[],showGovernanceAuditRules:!1,currentType:{type:"",index:""},currentGAId:"",activeName:"first",sqlValue:"",autoMapValue:!1,initReportValue:!1,param:{whereCondition:"",tableData:[],asyncConfig:1,growField:"",tableInfo:[]},targetColumnNames:[],rules:{sourceDatabase:[{required:!0,message:"请选择",trigger:"change"}]},tableHead:[],alreadySelectTargetTable:[]}},components:{governanceAuditRules:n.default,SqlEditor:l.default},computed:{newSelectParam:function(){return d({},this.selectParam)}},mounted:function(){},methods:d(d({},Object(o.b)(["_AJAX"])),{},{deepClone:function(e){return JSON.parse(JSON.stringify(e))},handleStep:function(e){var t=this;this.$store.commit("fusionTask/changeLoading",!0),this._AJAX({url:"stepPretank.echo",method:"GET",data:{stepId:e}}).then((function(e){t.param.growField=e.taskStep.increaseField,t.param.asyncConfig=e.taskStep.syncType,t.param.whereCondition=e.taskStepDetail.whereCondition,t.targetColumnName=e.taskRuleRelVo.targetColumnName,t.getColumn(t.selectParam.sourceRows[0].alreadySelectSourceTable[0].id,t.selectParam.alreadySelectTargetTable[0].id).then((function(a){t.param.tableInfo=a[t.selectParam.sourceRows[0].alreadySelectSourceTable[0].id].map((function(t,a){return{id:t.id,name:t.columnName,targetValue:e.taskRuleRelVo.targetColumnId[a],ruleId:"",catCode:""}})),t.targetColumnOptions=a[t.selectParam.alreadySelectTargetTable[0].id],setTimeout((function(){t.$store.commit("fusionTask/changeLoading",!1)}))}))}))},handleChange:function(e){var t=this.targetColumnOptions.find((function(t){return t.id===e}));t&&this.targetColumnName.push(t.columnName)},getMyExcelData:function(e){},Automaticmapping:function(e){var t=this;e?this.param.tableInfo.forEach((function(e){var a=t.targetColumnOptions.find((function(t){return t.columnName.toLowerCase().replace(/_/g,"")===e.name.toLowerCase().replace(/_/g,"")}));e.targetValue=a?a.id:"",t.targetColumnName.push(e.name)})):this.param.tableInfo.forEach((function(e){e.targetValue=""}))},getColumn:function(e,t){var a=this;return new Promise((function(r){a._AJAX({url:"stepPretank.getOriginOrTargetColumn",method:"GET",data:{sourceTableId:e,targetTableId:t}}).then((function(t){var n=t[e];a.sourceColumnName=n.map((function(e){return e.columnName})),r(t)}))}))},selectGATable:function(e){this.currentGAId=e,this.showGovernanceAuditRules=!0},handleClick:function(){},initGA:function(e){var t=this;this.param.tableData.find((function(e){return e.id===t.currentGAId})).ruletypes=e.map((function(e){return e.slot1})),this.showGovernanceAuditRules=!1},delGA:function(e){this.param.tableData.find((function(t){return t.id===e})).ruletypes=[]},next:function(e){var t=this;this.stepId=e;var a=new Set;setTimeout((function(){t.$store.commit("fusionTask/changeLoading",!0)}));var r,n=!1,o=s(this.param.tableInfo.map((function(e){return e.targetValue})));try{for(o.s();!(r=o.n()).done;){var l=r.value;if(l&&a.has(l)){n=!0;break}a.add(l)}}catch(e){o.e(e)}finally{o.f()}return n?(this.$message.error("目标表字段不能重复"),this.insertRequestDTOs=[],void setTimeout((function(){t.$store.commit("fusionTask/changeLoading",!1)}))):new Promise((function(r,n){a.clear();var o={taskRuleRelVo:{taskId:t.$route.query.taskId,sourceColumnId:t.param.tableInfo.map((function(e){return e.id})),targetColumnId:t.param.tableInfo.map((function(e){return e.targetValue})),sourceColumnName:t.sourceColumnName,targetColumnName:t.targetColumnName,stepId:t.stepId},taskStep:{taskId:t.$route.query.taskId,generateQualityReport:0,generateStdtestReport:0,generateSensitiveReport:0,syncType:t.param.asyncConfig,increaseField:t.param.growField},taskStepDetail:{sourceTableId:t.selectParam.sourceRows[0].alreadySelectSourceTable[0].id,targetTableId:t.selectParam.alreadySelectTargetTable[0].id,whereCondition:Object(i.b)(t.param.whereCondition)}};t.$refs.stepBaseLayerForm.validate((function(a){a?""==e?t._AJAX({url:"stepPretank.insert",method:"POST",data:o}).then((function(e){r(e),setTimeout((function(){t.$store.commit("fusionTask/changeLoading",!1)}))})):t._AJAX({url:"stepPretank.update",method:"POST",data:o}).then((function(e){r(e),setTimeout((function(){t.$store.commit("fusionTask/changeLoading",!1)}))})):n(a)}))}))},submit:function(e){var t=this;this.stepId=e;var a=new Set;setTimeout((function(){t.$store.commit("fusionTask/changeLoading",!0)}));var r,n=!1,o=s(this.param.tableInfo.map((function(e){return e.targetValue})));try{for(o.s();!(r=o.n()).done;){var l=r.value;if(l&&a.has(l)){n=!0;break}a.add(l)}}catch(e){o.e(e)}finally{o.f()}return n?(this.$message.error("目标表字段不能重复"),this.insertRequestDTOs=[],void setTimeout((function(){t.$store.commit("fusionTask/changeLoading",!1)}))):new Promise((function(r,n){a.clear();var o={taskRuleRelVo:{taskId:t.$route.query.taskId,sourceColumnId:t.param.tableInfo.map((function(e){return e.id})),targetColumnId:t.param.tableInfo.map((function(e){return e.targetValue})),sourceColumnName:t.sourceColumnName,targetColumnName:t.targetColumnName,stepId:t.stepId},taskStep:{taskId:t.$route.query.taskId,generateQualityReport:0,generateStdtestReport:0,generateSensitiveReport:0,syncType:t.param.asyncConfig,increaseField:t.param.growField},taskStepDetail:{sourceTableId:t.selectParam.sourceRows[0].alreadySelectSourceTable[0].id,targetTableId:t.selectParam.alreadySelectTargetTable[0].id,whereCondition:Object(i.b)(t.param.whereCondition)}};t.$refs.stepBaseLayerForm.validate((function(a){a?""==e?t._AJAX({url:"stepPretank.insert",method:"POST",data:o}).then((function(e){r(e),setTimeout((function(){t.$store.commit("fusionTask/changeLoading",!1)}))})):t._AJAX({url:"stepPretank.update",method:"POST",data:o}).then((function(e){r(e),setTimeout((function(){t.$store.commit("fusionTask/changeLoading",!1)}))})):n(a)}))}))}})},m=(a("ee0f"),a("2877")),f=Object(m.a)(p,(function(){var e=this,t=e._self._c;return t("div",[t("el-form",{ref:"stepBaseLayerForm",staticClass:"form-item",attrs:{model:e.param,"label-width":"120px",rules:e.rules,"label-position":"left",disabled:"view"===e.$route.query.filter}},[t("div",[t("el-tabs",{attrs:{type:"card"},on:{"tab-click":e.handleClick},model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},[t("el-tab-pane",{attrs:{label:"字段映射",name:"first"}},[t("div",[t("div",{staticClass:"checkboxrow"},[t("el-button",{attrs:{size:"mini",plain:"",type:"primary"},on:{click:function(t){return e.Automaticmapping(!0)}}},[e._v("字段自动映射")])],1),t("el-table",{ref:"tableData",staticStyle:{width:"100%",margin:"0 auto"},attrs:{data:e.param.tableInfo,border:""}},[t("el-table-column",{attrs:{prop:"name",label:e.sourceName,align:"center"}}),t("el-table-column",{attrs:{label:e.targetName,prop:"targetValue"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("div",{staticClass:"flex"},[t("el-form-item",{attrs:{rules:{required:!0,message:"请选择",trigger:"change"}}},[t("el-select",{attrs:{placeholder:"请选择",clearable:""},on:{change:e.handleChange},model:{value:a.row.targetValue,callback:function(t){e.$set(a.row,"targetValue",t)},expression:"scope.row.targetValue"}},e._l(e.targetColumnOptions,(function(e){return t("el-option",{key:e.id,attrs:{label:e.columnName,value:e.id}})})),1)],1)],1)]}}])})],1),t("el-form-item",{attrs:{label:"同步配置",rules:{required:!0,message:"输入",trigger:"blur"},"class-name":"tablerow"}},[t("el-radio",{attrs:{label:1},model:{value:e.param.asyncConfig,callback:function(t){e.$set(e.param,"asyncConfig",t)},expression:"param.asyncConfig"}},[e._v("全量")]),t("el-radio",{attrs:{label:2},model:{value:e.param.asyncConfig,callback:function(t){e.$set(e.param,"asyncConfig",t)},expression:"param.asyncConfig"}},[e._v("增量")])],1),2===e.param.asyncConfig?t("el-form-item",{attrs:{label:"增量字段",prop:"growField",rules:{required:!0,message:"请输入",trigger:"change"}}},[t("el-select",{attrs:{placeholder:"请选择",clearable:""},model:{value:e.param.growField,callback:function(t){e.$set(e.param,"growField",t)},expression:"param.growField"}},e._l(e.sourceColumnName,(function(e){return t("el-option",{key:e,attrs:{label:e,value:e}})})),1)],1):e._e(),t("br"),t("el-form-item",{attrs:{prop:"whereCondition"},scopedSlots:e._u([{key:"label",fn:function(){return[t("span",[e._v("where条件")]),t("el-tooltip",{staticClass:"item",staticStyle:{"padding-left":"10px"},attrs:{effect:"dark",placement:"right"}},[t("div",{attrs:{slot:"content"},slot:"content"},[e._v("\n                                        注：增量时可以设置，where条件不需填写where关键字\n                                    ")]),t("i",{staticClass:"content-view iconfont iconbangzhu operate"})])]},proxy:!0}])},[t("el-input",{attrs:{type:"textarea",rows:5,placeholder:"请输入内容"},model:{value:e.param.whereCondition,callback:function(t){e.$set(e.param,"whereCondition",t)},expression:"param.whereCondition"}})],1)],1)])],1)],1)]),t("governanceAuditRules",{attrs:{show:e.showGovernanceAuditRules},on:{submit:e.initGA,close:function(t){e.showGovernanceAuditRules=!1}}})],1)}),[],!1,null,"9eb4d822",null);t.default=f.exports},c0c9:function(e,t,a){"use strict";a.r(t),a("8e6e"),a("456d"),a("5df3"),a("4f7f"),a("8615"),a("ac6a"),a("7514");var r=a("ade3"),n=a("e762"),o=a("2f62"),i=a("1794"),l=a("33fb"),s=a("db05"),c=a.n(s),u=a("f029");function d(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function p(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?d(Object(a),!0).forEach((function(t){Object(r.a)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):d(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var m={props:["selectParam"],watch:{selectParam:{handler:function(e){if(this.autoMapValue="",e.alreadySelectTargetTable.length>0){this.sourceTableName=e.sourceRows[0].alreadySelectSourceTable[0].tableName,this.targetTableName=e.alreadySelectTargetTable[0].tableName;var t=e.sourceRows[0].alreadySelectSourceTable[0].id,a=e.alreadySelectTargetTable[0].id;this.sourceTableId=t,this.targetTableId=a,this.getCloumnList(t,a)}},deep:!0},basicInfoForm:{handler:function(e){var t=this;if(e.sqlMain){var a=this.activeName;this.activeName="",this.$nextTick((function(){t.activeName=a}))}},deep:!0}},data:function(){return{selectedValue:[],stepId:"",currentIndex:"",currentTargetColumnId:"",selectedRuleData:[],showRuleDialog:!1,sourceTableName:"",targetTableName:"",sourceTableId:"",targetTableId:"",columnMap:{},showGovernanceAuditRules:!1,currentType:{type:"",index:""},currentGAId:"",activeName:"first",sqlValue:"",autoMapValue:!1,initReportValue:!1,param:{tableInfo:[],whereCondition:"",tableData:[],asyncConfig:1,growField:""},targetColumnOptions:[],rules:{sourceDatabase:[{required:!0,message:"请选择",trigger:"change"}]},tableHead:[],alreadySelectTargetTable:[],dialogVisible:!0,basicInfoForm:{sqlMain:""}}},components:{governanceAuditRules:i.default,ruleList:l.default,SqlEditor:u.default},computed:p({comSourceIsDisabled:function(){return function(e){return 1!==e.value&&""!==this.selectParam.targetDatabase&&e.value>this.param.targetDatabase}},targetColumnIsAdditionColumn:function(){return function(e){var t=this.targetColumnOptions.find((function(t){return t.id===e.targetValue}));if(t)return null!==t.additionColumn&&1===t.additionColumn}},comTargetIsDisabled:function(){return function(e){var t=this.selectParam.sourceRows.filter((function(e){return""!==e.sourceDatabase}));if(0===t.length)return!1;var a=t.reduce((function(e,t){return e.value>t.sourceDatabase?e:t})),r=this.selectParam.sourceRows.find((function(e){return""!==e.sourceDatabase}));return!!(1!==e.value&&r&&e.value<=a.sourceDatabase)}}},Object(o.d)("generateRule",["generateRuleList","ruleTypeOptions","ruleCategoryOptions"])),mounted:function(){},methods:p(p(p({},Object(o.b)("generateRule",["GENERATERULELIST","DELETEGENERATERULE","GETRULETYPEOPTIONS_LIST","GETRULECATEGORYLIST"])),Object(o.b)(["_AJAX"])),{},{selectGATable:function(e){this.currentGAId=e,this.showGovernanceAuditRules=!0},handleClick:function(){},createTbleAuto:function(){var e=this;this.$nextTick((function(){if(e.selectParam.autoCreate&&!e.selectParam.sourceRows.find((function(e){return 0===e.alreadySelectSourceTableValue.length}))&&0!==e.selectParam.alreadySelectTargetTable.length){e.param.tableData=[],e.tableHead=[],e.selectParam.sourceRows.forEach((function(t){var a=t.alreadySelectSourceTableValue[0],r=t.alreadySelectSourceTable.find((function(e){return e.id===a})).slot1;e.tableHead.push(r)})),e.selectParam.alreadySelectTargetTableValue.forEach((function(t){var a=e.selectParam.alreadySelectTargetTable.find((function(e){return e.id===t})).slot1;e.tableHead.push(a)}));var t={};e.tableHead.forEach((function(e){t[e]=1,t.options=[{value:1,label:"字段1"},{value:2,label:"字段2"}],t.selectValue="",t.id=1,t.ruletypes=[]})),e.param.tableData.push(t),e.$refs.tableData&&e.$refs.tableData.doLayout()}}))},initGA:function(e){var t=this;this.param.tableData.find((function(e){return e.id===t.currentGAId})).ruletypes=e.map((function(e){return e.slot1})),this.showGovernanceAuditRules=!1},delGA:function(e){this.param.tableData.find((function(t){return t.id===e})).ruletypes=[]},handleStep:function(e){var t=this;this.stepId=e,this._AJAX({url:"stepOds.echo",method:"GET",data:{stepId:e}}).then((function(e){var a=e.echoVo,r=e.tableIdColumnMap;t.targetColumnOptions=Object.values(r)[1],t.param.asyncConfig=a.syncType,t.param.growField=a.increaseField,t.param.initReportValue=1===a.generateQualityReport;var n=a.stepDetailList[0];t.sourceTableId=n.sourceTableId,t.targetTableId=n.targetTableId,t.sourceTableName=n.sourceTableName,t.targetTableName=n.targetTableName,t.basicInfoForm.sqlMain=n.sqlContent,t.param.whereCondition=n.whereCondition;var o=n.rowList;t.param.tableInfo=o.map((function(e){return{sourceColumnId:e.sourceColumnId,sourceColumnName:e.sourceColumnName,targetValue:e.targetColumnId,ruleIds:e.ruleIds,selectedRuleData:e.ruleData}})),t.$refs.tableData.doLayout()}))},next:function(e){var t=this;return new Promise((function(a,r){t.stepId=e;var o=t.param.tableInfo.filter((function(e){return e.targetValue})).map((function(e){return{ruleIds:e.ruleIds,sourceColumnId:e.sourceColumnId,targetColumnId:e.targetValue,sourceColumnName:e.sourceColumnName,targetColumnName:t.targetColumnOptions.find((function(t){return t.id===e.targetValue})).columnName}})),i={levelCode:"au_ods",syncType:t.param.asyncConfig,increaseField:t.param.growField?t.param.growField:"",generateQualityReport:t.initReportValue?1:0},l={sourceTableId:t.sourceTableId,targetTableId:t.targetTableId,sqlContent:Object(n.b)(t.basicInfoForm.sqlMain),whereCondition:t.param.whereCondition?Object(n.b)(t.param.whereCondition):""},s={taskId:t.$route.query.taskId,stepId:e,taskRuleRelList:o,taskStepDto:i,taskStepDetailDto:l};t.verifyParam(s)&&t.$refs.stepAggregationLayerForm.validate((function(e){e&&(t.$store.commit("fusionTask/changeLoading",!0),t._AJAX({url:"stepOds.next",method:"POST",data:s}).then((function(e){a(e)})).catch((function(e){r(e)})))}))}))},submit:function(e){var t=this;return new Promise((function(a,r){t.stepId=e;var n=t.generateParam();t.verifyParam(n)&&t.$refs.stepAggregationLayerForm.validate((function(e){e&&(t.$store.commit("fusionTask/changeLoading",!0),t._AJAX({url:"stepOds.complete",method:"POST",data:n}).then((function(e){a(e),setTimeout((function(){t.$store.commit("fusionTask/changeLoading",!1)}))})).catch((function(e){t.$store.commit("fusionTask/changeLoading",!1),r(e)})))}))}))},getCloumnList:function(e,t){var a=this;this._AJAX({url:"stepOds.getOriginOrTargetColumn",method:"GET",data:{sourceTableId:e,targetTableId:t}}).then((function(r){a.param.tableInfo=r[e].map((function(e){return{sourceColumnId:e.id,sourceColumnName:e.columnName,targetValue:"",ruleIds:""}})),a.$refs.tableData.doLayout(),a.targetColumnOptions=r[t],a.columnMap=r}))},matchColumnDim:function(e,t){return e.replaceAll("_","").replaceAll("-","").toLowerCase()===t.replaceAll("_","").replaceAll("-","").toLowerCase()},Automaticmapping:function(e){var t=this;e?this.param.tableInfo.forEach((function(e){var a=t.targetColumnOptions.find((function(a){return t.matchColumnDim(e.sourceColumnName,a.columnName)}));e.targetValue=a?a.id:""})):this.param.tableInfo.forEach((function(e){e.targetValue=""}))},chooseRules:function(e){var t=this;this.showRuleDialog=!1;var a=[];e.forEach((function(e){var t=a.find((function(t){return t.ruleTypeName===e.ruleTypeName}));if(t)t.ruleNameList.push({ruleName:e.ruleName});else{var r={ruleTypeName:e.ruleTypeName,ruleNameList:[{ruleName:e.ruleName}]};a.push(r)}})),this.selectedRuleData=a,this.param.tableInfo[this.currentIndex].selectedRuleData=a;var r,n=[];e.map((function(e){n.push(e.id)})),r=n.join(",");var o=this.param.tableInfo.find((function(e){return e.targetValue===t.currentTargetColumnId}));o&&(o.ruleIds=r,o.selectObj=e)},addRule:function(e,t){this.currentTargetColumnId=e.targetValue,this.currentIndex=t,this.showRuleDialog=!0},modifyRule:function(e,t){this.currentTargetColumnId=e.targetValue,this.currentIndex=t,this.selectedValue=e.selectObj,this.showRuleDialog=!0},deleteRule:function(e,t){this.param.tableInfo[t].selectedRuleData="",this.param.tableInfo[t].ruleIds=""},generateParam:function(){var e=this,t=this.param.tableInfo.filter((function(e){return e.targetValue})).map((function(t){return{ruleIds:t.ruleIds,sourceColumnId:t.sourceColumnId,targetColumnId:t.targetValue,sourceColumnName:t.sourceColumnName,targetColumnName:e.targetColumnOptions.find((function(e){return e.id===t.targetValue})).columnName}})),a={levelCode:"au_ods",syncType:this.param.asyncConfig,increaseField:this.param.growField,generateQualityReport:this.initReportValue?1:0},r={sourceTableId:this.sourceTableId,targetTableId:this.targetTableId,sqlContent:"",whereCondition:this.param.whereCondition?Object(n.b)(this.param.whereCondition):""};return{taskId:this.$route.query.taskId,stepId:this.stepId,taskRuleRelList:t,taskStepDto:a,taskStepDetailDto:r}},isHasDuplicateProperty:function(e,t){for(var a=new Set,r=0;r<e.length;r++){var n=e[r][t];if(a.has(n))return!0;a.add(n)}return!1},verifyParam:function(e){var t=e;return t.taskRuleRelList&&t.taskRuleRelList.some((function(e){return""!==e.sourceColumnId&&""!==e.targetColumnId}))?!this.isHasDuplicateProperty(t.taskRuleRelList,"targetColumnId")||(this.$message.error("目标表的字段不可重复，请重新选择!"),!1):(this.$message.error("目标表的字段最少填一个，不可全部为空!"),!1)},changeTextarea:function(e){this.$set(this.basicInfoForm,"sqlMain",e)},formaterSql:function(e){var t=this.$refs.sqleditor;t.editor.setValue(c.a.format(t.editor.getValue()))},generateSql:function(){var e=this,t=this.generateParam();this.$refs.stepAggregationLayerForm.validate((function(a){a&&e._AJAX({url:"stepOds.generateSql",method:"POST",data:t}).then((function(t){e.$set(e.basicInfoForm,"sqlMain",t[0].sql),e.$refs.sqleditor.setVal()})).catch((function(e){}))}))}})},f=(a("e67c"),a("2877")),h=Object(f.a)(m,(function(){var e=this,t=e._self._c;return t("div",[t("el-form",{ref:"stepAggregationLayerForm",staticClass:"form-item",attrs:{model:e.param,"label-width":"120px",rules:e.rules,"label-position":"left",disabled:"view"===e.$route.query.filter}},[t("div",[t("el-tabs",{attrs:{type:"card"},on:{"tab-click":e.handleClick},model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},[t("el-tab-pane",{attrs:{label:"字段映射",name:"first"}},[t("div",[t("div",{staticClass:"checkboxrow"},[t("el-button",{attrs:{size:"mini",plain:"",type:"primary"},on:{click:function(t){return e.Automaticmapping(!0)}}},[e._v("字段自动映射")])],1),t("el-table",{ref:"tableData",staticStyle:{width:"100%",margin:"0 auto"},attrs:{data:e.param.tableInfo,border:""}},[t("el-table-column",{attrs:{prop:"sourceColumnName",label:e.sourceTableName,align:"center"}}),t("el-table-column",{attrs:{label:e.targetTableName,prop:"targetValue"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("div",{staticClass:"flex"},[t("el-form-item",{staticClass:"center",attrs:{rules:{required:!0,message:"请选择",trigger:"change"}}},[t("el-select",{attrs:{clearable:"",placeholder:"请选择"},model:{value:a.row.targetValue,callback:function(t){e.$set(a.row,"targetValue",t)},expression:"scope.row.targetValue"}},e._l(e.targetColumnOptions,(function(e){return t("el-option",{key:e.id,attrs:{label:e.columnName,value:e.id}})})),1)],1)],1)]}}])})],1),t("br"),t("el-form-item",{attrs:{label:"同步配置",rules:{required:!0,message:"输入",trigger:"blur"},"class-name":"tablerow"}},[t("el-radio",{attrs:{label:1},model:{value:e.param.asyncConfig,callback:function(t){e.$set(e.param,"asyncConfig",t)},expression:"param.asyncConfig"}},[e._v("全量")]),t("el-radio",{attrs:{label:2},model:{value:e.param.asyncConfig,callback:function(t){e.$set(e.param,"asyncConfig",t)},expression:"param.asyncConfig"}},[e._v("增量")])],1),2===e.param.asyncConfig?t("el-form-item",{attrs:{label:"增量字段",prop:"growField",rules:{required:!0,message:"请输入",trigger:"change"}}},[t("el-select",{attrs:{placeholder:"请选择",clearable:""},model:{value:e.param.growField,callback:function(t){e.$set(e.param,"growField",t)},expression:"param.growField"}},e._l(e.param.tableInfo,(function(e){return t("el-option",{key:e.sourceColumnName,attrs:{label:e.sourceColumnName,value:e.sourceColumnName}})})),1)],1):e._e(),t("el-form-item",{attrs:{prop:"whereCondition"},scopedSlots:e._u([{key:"label",fn:function(){return[t("span",[e._v("where条件")]),t("el-tooltip",{staticClass:"item",staticStyle:{"padding-left":"10px"},attrs:{effect:"dark",placement:"right"}},[t("div",{attrs:{slot:"content"},slot:"content"},[e._v("\n                                        注：增量时可以设置，where条件不需填写where关键字\n                                    ")]),t("i",{staticClass:"content-view iconfont iconbangzhu operate"})])]},proxy:!0}])},[t("el-input",{attrs:{type:"textarea",rows:5,placeholder:"请输入内容"},model:{value:e.param.whereCondition,callback:function(t){e.$set(e.param,"whereCondition",t)},expression:"param.whereCondition"}})],1)],1)])],1)],1)]),t("governanceAuditRules",{attrs:{show:e.showGovernanceAuditRules},on:{submit:e.initGA,close:function(t){e.showGovernanceAuditRules=!1}}}),e.showRuleDialog?t("el-dialog",{attrs:{title:"治理稽核规则配置",visible:e.showRuleDialog},on:{close:function(t){e.showRuleDialog=!1}}},[t("ruleList",{staticStyle:{height:"70vh"},attrs:{chooseRules:e.chooseRules,selectedValue:e.selectedValue}})],1):e._e()],1)}),[],!1,null,"2df97061",null);t.default=h.exports},c721:function(e,t,a){var r=a("a80c");r.__esModule&&(r=r.default),"string"==typeof r&&(r=[[e.i,r,""]]),r.locals&&(e.exports=r.locals),(0,a("499e").default)("d437cdc6",r,!0,{sourceMap:!1,shadowMode:!1})},ce93:function(e,t,a){"use strict";a.r(t),a("7f7f"),a("8e6e"),a("456d"),a("c5f6"),a("5df3"),a("4f7f"),a("ac6a"),a("20d6"),a("7514");var r=a("ade3"),n=a("2f62"),o=a("a026"),i=a("f029"),l=a("db05"),s=a.n(l),c=a("e762");function u(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function d(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?u(Object(a),!0).forEach((function(t){Object(r.a)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):u(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var p={props:["selectParam"],watch:{selectParam:{handler:function(e){var t=this;this.GETSOURCECOLUMNLIST({sourceTableId:e.sourceRows[0].alreadySelectSourceTable[0].id,targetTableId:e.alreadySelectTargetTable[0].id}).then((function(){var e=t.sourceTableValue;t.customData=t.sourceColumnList[e]}))},deep:!0}},data:function(){return{middleValue:"",customData:[],isDot:!1,taskStep:{id:"",taskId:this.$route.query.taskId,autoCreateTab:0,isAutoCreate:!1,taskStepDetail:{id:null,stepId:null,sourceTableId:null,targetTableId:null,sqlContent:"",whereCondition:"",taskRuleRelList:[]}},dialogVisible:!1,updateData:{ruleId:""},index:null,columnSortList:[],columnSortedList:[],checkData:[],selectItem:"",ysyyTableData:{targetColumnId:null,baseTableId:null,sourceColumnId:null},taskId:this.$route.query.taskId,stepId:this.$route.query.stepId,basicInfoForm:{sqlMain:""},activeName:"first",autoMapValue:!1,taskFusionInfoList:[],param:{page:1,rows:10,whereCondition:"",tableData:[],asyncConfig:1,growField:""},rules:{sourceDatabase:[{required:!0,message:"请选择",trigger:"change"}],ruleId:[{required:!0,message:"请选择",trigger:"change"}]},alreadySelectTargetTable:[]}},components:{SqlEditor:i.default},computed:d(d({},Object(n.d)("dataFusionTask",["fusionStrategyOptions","sourceColumnList","tableDataYSYY","tableColumnData","stepAndDetail"])),{},{sourceTableValue:function(){return this.selectParam.sourceRows[0].alreadySelectSourceTable[0].id},isNotDelRuleId:function(){return function(e){var t=this.taskStep.taskStepDetail.taskRuleRelList.find((function(t){return t.sourceColumnId==e}));return void 0===t||"del"!==t.optType}}}),mounted:function(){},created:function(){this.GETFUSIONSTRATEGY_LIST()},methods:d(d(d({},Object(n.b)("dataFusionTask",["GETFUSIONSTRATEGY_LIST","GETSOURCECOLUMNLIST","GETYSYYTABLEDATA","GETCOLUMNSORTDATA","UPDATESORT","INSERTSORT","DELSORT","ADDSTEP","UPDATESTEP","QUERYSTEPANDDETAIL"])),Object(n.b)(["_AJAX"])),{},{handleClose:function(e){var t=this.taskStep.taskStepDetail.taskRuleRelList.findIndex((function(t){return t.sourceColumnId==e}));this.taskStep.taskStepDetail.taskRuleRelList[t].optType="del",this.basicInfoForm.sqlMain="",this.isDot=!0},switchChange:function(e){this.columnSortedList&&this.columnSortedList.length&&this.columnSortedList.forEach((function(t){e.columnId==t.columnId&&(t.sortType=e.sortType)}))},updateMiddleValue:function(e){e&&"del"===e.optType?this.middleValue="":this.middleValue=this.updateData.ruleId||""},update:function(e,t){var a=this;if(null==e.targetColumnCode||null==e.targetColumnCode||""==e.targetColumnCode)return o.default.prototype.$message.warning("请选择字段在进行配置");var r=this.taskStep.taskStepDetail.taskRuleRelList.find((function(t){return t.sourceColumnId==e.id}));this.ysyyTableData={baseTableId:this.sourceTableValue,sourceColumnId:e.id,taskId:this.taskId,sourceColumnName:e.columnName,targetColumnId:e.targetColumnCode},this.selectItem="",this.checkData=[],this.index=t,this.updateData=JSON.parse(JSON.stringify(e)),"null"==e.ruleId?this.$set(this.updateData,"ruleId",""):this.$set(this.updateData,"ruleId",e.ruleId),this.updateMiddleValue(r);var n=this.updateData.ruleId;this.GETYSYYTABLEDATA(this.ysyyTableData).then((function(){1==n&&"del"!==r.optType&&(a.selectItem=r.sourceEntityId),2==n&&a.tableDataYSYY.forEach((function(e){if(r&&r.taskFusionInfoList){var t=r.taskFusionInfoList.find((function(t){return t.sourceEntityId===e.tableId}));"del"!==r.optType&&(e.limit=t.sortNum,e.sortType=t.sortType),setTimeout((function(){a.$refs.YSYYData.toggleRowSelection(e,!0)}),1e3)}}))})).then((function(){a.GETCOLUMNSORTDATA({sourceTableId:a.sourceTableValue,sourceColumnId:e.id,taskId:a.taskId,targetColumnId:e.targetColumnCode}).then((function(){a.columnSortList=a.tableColumnData,a.columnSortedList=a.tableColumnData,a.checkData=[],a.columnSortList&&a.columnSortList.length&&r&&r.taskFusionInfoList&&a.columnSortList.forEach((function(e){e.sortType="desc";var t=r.taskFusionInfoList.find((function(t){return t.columnName===e.columnName}));t&&"del"!==r.optType&&(e.sortType=t.sortType,a.checkData.push(e))})),a.dialogVisible=!0,setTimeout((function(){a.rowDrop()}),1e3)}))}))},rowDrop:function(){var e=this;this.$dragging.$on("dragged",(function(t){var a=t.value;e.columnSortedList=a.list.map((function(e,t){return{id:e.id,sortNum:e.sortNum||t,columnId:e.columnId,columnName:e.columnName,columnComment:e.columnComment,taskRuleRelId:e.taskRuleRelId,sourceEntityId:e.sourceEntityId,sortType:e.sortType}}))})),this.$dragging.$on("dragend",(function(){}))},change:function(){this.basicInfoForm.sqlMain="",this.isDot=!0},matchColumnDim:function(e,t){return e.replaceAll("_","").replaceAll("-","").toLowerCase()===t.replaceAll("_","").replaceAll("-","").toLowerCase()},Automaticmapping:function(e){var t=this;e?this.customData.forEach((function(e){var a=t.sourceColumnList[t.selectParam.alreadySelectTargetTable[0].id].find((function(a){return t.matchColumnDim(e.columnName,a.columnName)}));e.targetColumnCode=a?a.id:""})):this.customData.forEach((function(e){e.targetColumnCode=""}))},rowChange:function(e){this.selectItem=e.tableId},handleClick:function(){},cancelSelect:function(){},showType:function(e){this.updateData.ruleId=e},generateSql:function(){var e=this,t=this.customData.filter((function(e){return""!=e.targetColumnCode&&null!=e.targetColumnCode})).map((function(e){return e.targetColumnCode}));if(new Set(t).size!==t.length)this.$message.error("目标表的表字段不允许重复");else{this.taskStep.isAutoCreate=this.selectParam.isAutoCreate,this.taskStep.taskStepDetail.stepId=this.stepId,this.taskStep.taskStepDetail.sourceTableId=this.sourceTableValue,this.taskStep.taskStepDetail.targetTableId=this.selectParam.alreadySelectTargetTable[0].id,this.taskStep.taskStepDetail.whereCondition=Object(c.b)(this.param.whereCondition),this.customData.forEach((function(t){if(""!=t.targetColumnCode){var a={};a.sourceColumnId=t.id,a.targetColumnId=t.targetColumnCode,a.taskId=e.taskId,a.catCode="FUSION_STRATEGY",e.taskStep.taskStepDetail.taskRuleRelList.length>0?null==e.taskStep.taskStepDetail.taskRuleRelList.find((function(e){return e.sourceColumnId==t.id}))&&e.taskStep.taskStepDetail.taskRuleRelList.push(a):e.taskStep.taskStepDetail.taskRuleRelList.push(a)}}));var a=JSON.parse(JSON.stringify(this.taskStep));a.taskStepDetail.taskRuleRelList.filter((function(e){return"del"===e.optType})).forEach((function(e){e.ruleId=null})),this._AJAX({url:"dwm.generateSql",method:"POST",data:a}).then((function(t){var a=t[0].sql;e.$set(e.basicInfoForm,"sqlMain",a),e.$set(e.taskStep.taskStepDetail,"sqlContent",Object(c.b)(a)),setTimeout((function(){e.$refs.sqleditor.setVal()}),500),e.isDot=!1,e.$message.success("生成SQL成功！")})).catch((function(e){}))}},changeTextarea:function(e){this.$set(this.basicInfoForm,"sqlMain",e)},formaterSql:function(e){var t=this.$refs.sqleditor;t.editor.setValue(s.a.format(t.editor.getValue()))},cancel:function(){this.dialogVisible=!1,this.updateData={ruleId:""}},fusionTypeName:function(e){return{1:"一数一源",2:"来源优先级",3:"数据新鲜度",4:"最大值",5:"最小值",6:"最高频"}[e]},submitData:function(){var e=this,t=this.updateData.ruleId;if(1==this.updateData.ruleId&&""===this.selectItem)return o.default.prototype.$message.warning("请选择一条数据！");var a={sourceColumnId:this.customData[this.index].id,targetColumnId:this.customData[this.index].targetColumnCode,sourceColumnName:this.customData[this.index].columnName,taskId:this.taskId,ruleId:t,optType:"",catCode:"FUSION_STRATEGY"};1==t?(a.sourceEntityId=this.selectItem,this.taskStep.taskStepDetail.taskRuleRelList=this.taskStep.taskStepDetail.taskRuleRelList.filter((function(t){return t.sourceColumnId!=e.ysyyTableData.sourceColumnId})),this.taskStep.taskStepDetail.taskRuleRelList.push(a)):2==t?(a.taskFusionInfoList=[],this.tableDataYSYY.forEach((function(e){var t={};t.sourceEntityId=e.tableId,t.sortNum=e.limit,a.taskFusionInfoList.push(t)})),this.taskStep.taskStepDetail.taskRuleRelList=this.taskStep.taskStepDetail.taskRuleRelList.filter((function(t){return t.sourceColumnId!=e.ysyyTableData.sourceColumnId})),this.taskStep.taskStepDetail.taskRuleRelList.push(a)):3==t?(this.taskStep.taskStepDetail.taskRuleRelList=this.taskStep.taskStepDetail.taskRuleRelList.filter((function(e){return e.sourceColumnId!==a.sourceColumnId})),a.taskFusionInfoList=[],this.checkData.forEach((function(e){var t={id:e.id,sortNum:e.sortNum,columnId:e.columnId,columnName:e.columnName,columnComment:e.columnComment,taskRuleRelId:e.taskRuleRelId,sourceEntityId:e.columnId,sortType:e.sortType};a.taskFusionInfoList.push(t)})),this.taskStep.taskStepDetail.taskRuleRelList.push(a)):(this.taskStep.taskStepDetail.taskRuleRelList=this.taskStep.taskStepDetail.taskRuleRelList.filter((function(t){return t.sourceColumnId!=e.ysyyTableData.sourceColumnId})),this.taskStep.taskStepDetail.taskRuleRelList.push(a)),delete this.customData[this.index].ruleId,delete this.customData[this.index].ruleName,this.$set(this.customData[this.index],"ruleName",this.fusionTypeName(t)),this.$set(this.customData[this.index],"ruleId",t),this.dialogVisible=!1,this.updateData={ruleId:""},this.basicInfoForm.sqlMain="",this.isDot=!0},handleStep:function(e){var t=this;this.QUERYSTEPANDDETAIL({taskId:this.taskId,id:e}).then((function(){t.param.whereCondition=t.stepAndDetail.taskStepDetail.whereCondition,t.taskStep.taskStepDetail.id=t.stepAndDetail.taskStepDetail.id,t.basicInfoForm.sqlMain=t.stepAndDetail.taskStepDetail.sqlContent,t.stepAndDetail.taskStepDetail.taskRuleRelList.forEach((function(e){var a=e.ruleId,r={sourceColumnId:e.sourceColumnId,targetColumnId:e.targetColumnId,sourceColumnName:e.sourceColumnName,taskId:e.taskId,ruleId:a,catCode:"FUSION_STRATEGY",optType:""};if(1==a)r.sourceEntityId=e.ysyyTableData[0].sourceEntityId,t.taskStep.taskStepDetail.taskRuleRelList.push(r);else if(2==a)r.taskFusionInfoList=[],e.ysyyTableData.forEach((function(e){var t={};t.sourceEntityId=e.tableId,t.sortNum=e.sortNum,r.taskFusionInfoList.push(t)})),t.taskStep.taskStepDetail.taskRuleRelList.push(r);else if(3==a){r.taskFusionInfoList=[];var n=e.fusionSorts.filter((function(e){return 1==e.checked}));if(!n)return;n.forEach((function(e){var t={id:e.id,sortNum:e.sortNum,columnId:e.columnId,columnName:e.columnName,columnComment:e.columnComment,taskRuleRelId:e.taskRuleRelId,sourceEntityId:e.columnId,sortType:e.sortType};r.taskFusionInfoList.push(t)})),t.taskStep.taskStepDetail.taskRuleRelList.push(r)}else t.taskStep.taskStepDetail.taskRuleRelList.push(r)})),t.GETSOURCECOLUMNLIST({sourceTableId:t.stepAndDetail.taskStepDetail.sourceTableId,targetTableId:t.stepAndDetail.taskStepDetail.targetTableId}).then((function(){var e=t.sourceTableValue;t.customData=t.sourceColumnList[e],t.customData.forEach((function(e,a){var r=t.deepClone(t.stepAndDetail.taskStepDetail.taskRuleRelList.find((function(t){return t.sourceColumnId===e.id})));r&&(e.targetColumnCode=r.targetColumnId,e.ruleId=r.ruleId,null!=r.targetColumnId&&t.$set(t.customData[a],"targetColumnCode",Number(r.targetColumnId)),t.$set(t.customData[a],"ruleId",r.ruleId+""))}))}))}))},deepClone:function(e){if(e)return JSON.parse(JSON.stringify(e))},submit:function(e){var t=this,a=this;return""==a.basicInfoForm.sqlMain?a.$message.error("sql不能为空"):(this.$store.commit("fusionTask/changeLoading",!0),new Promise((function(r,n){a.$refs.stepThemeLayerForm.validate((function(o){o&&(a.taskStep.isAutoCreate=a.selectParam.isAutoCreate,a.taskStep.taskStepDetail.sourceTableId=a.sourceTableValue,a.taskStep.taskStepDetail.sqlContent=Object(c.b)(a.basicInfoForm.sqlMain),a.taskStep.taskStepDetail.whereCondition=a.param.whereCondition,a.taskStep.taskStepDetail.targetTableId=a.selectParam.alreadySelectTargetTable[0].id,e?(a.taskStep.id=e,a.taskStep.taskStepDetail.stepId=e,a.UPDATESTEP(a.taskStep).then((function(){t.$store.commit("fusionTask/changeLoading",!1),r(o)})).catch((function(){t.$store.commit("fusionTask/changeLoading",!1),n(o)}))):a.ADDSTEP(a.taskStep).then((function(){t.$store.commit("fusionTask/changeLoading",!1),r(o)})).catch((function(){t.$store.commit("fusionTask/changeLoading",!1),n(o)})))}))})))},next:function(e){var t=this;return""==t.basicInfoForm.sqlMain?t.$message.error("sql不能为空"):new Promise((function(a,r){t.$refs.stepThemeLayerForm.validate((function(n){n&&(t.$store.commit("fusionTask/changeLoading",!0),t.taskStep.isAutoCreate=t.selectParam.isAutoCreate,t.taskStep.taskStepDetail.sourceTableId=t.sourceTableValue,t.taskStep.taskStepDetail.targetTableId=t.selectParam.alreadySelectTargetTable[0].id,t.taskStep.taskStepDetail.sqlContent=Object(c.b)(t.basicInfoForm.sqlMain),t.taskStep.taskStepDetail.whereCondition=t.param.whereCondition,e?(t.taskStep.id=e,t.taskStep.taskStepDetail.stepId=e,t.UPDATESTEP(t.taskStep).then((function(){a(n)})).catch((function(){r(n)}))):t.ADDSTEP(t.taskStep).then((function(){a(n)})).catch((function(){r(n)})))}))}))}})},m=(a("9516"),a("2877")),f=Object(m.a)(p,(function(){var e=this,t=e._self._c;return t("div",[t("el-form",{ref:"stepThemeLayerForm",staticClass:"form-item",attrs:{model:e.param,"label-width":"120px",rules:e.rules,"label-position":"left",disabled:"view"===e.$route.query.filter}},[t("div",[t("el-tabs",{attrs:{type:"card"},on:{"tab-click":e.handleClick},model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},[t("el-tab-pane",{attrs:{label:"字段映射",name:"first"}},[t("div",[t("div",{staticClass:"checkboxrow"},[t("el-button",{attrs:{size:"mini",plain:"",type:"primary"},on:{click:function(t){return e.Automaticmapping(!0)}}},[e._v("字段自动映射")])],1),t("el-table",{ref:"tableData",staticStyle:{width:"100%",margin:"0 auto"},attrs:{data:e.customData,border:""}},[t("el-table-column",{attrs:{label:e.selectParam.sourceRows[0].alreadySelectSourceTable[0].tableName,align:"center",prop:"columnName"}}),t("el-table-column",{attrs:{label:e.selectParam.alreadySelectTargetTable[0].tableName,prop:"targetColumnCode"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-select",{attrs:{filterable:"",clearable:"",size:"mini"},on:{change:function(t){return e.change(a.row,a.$index)}},model:{value:a.row.targetColumnCode,callback:function(t){e.$set(a.row,"targetColumnCode",t)},expression:"scope.row.targetColumnCode"}},e._l(e.sourceColumnList[e.selectParam.alreadySelectTargetTable[0].id],(function(e){return t("el-option",{key:e.id,attrs:{label:e.columnName,value:e.id}})})),1)]}}])}),t("el-table-column",{attrs:{label:"融合策略",prop:"ruleName",width:"200",align:"center"},scopedSlots:e._u([{key:"default",fn:function(a){return"null"!=a.row.ruleId?[a.row.ruleId&&e.isNotDelRuleId(a.row.id)?t("el-tag",{attrs:{closable:""},on:{close:function(t){return e.handleClose(a.row.id)}}},[e._v("\n                                        "+e._s(1==a.row.ruleId?"一数一源":2==a.row.ruleId?"来源优先级":3==a.row.ruleId?"数据新鲜度":4==a.row.ruleId?"最大值":5==a.row.ruleId?"最小值":6==a.row.ruleId?"最高频":"-")+"\n                                    ")]):e._e()]:void 0}}],null,!0)}),t("el-table-column",{attrs:{label:"融合策略配置",prop:"inspect",width:"200",align:"center"},scopedSlots:e._u([{key:"default",fn:function(a){return["au_dwd"==e.selectParam.sourceRows[0].sourceDatabase&&1!==a.row.additionColumn?t("span",[t("a",{attrs:{title:"配置"},on:{click:function(t){return e.update(a.row,a.$index)}}},[t("i",{staticClass:"el-icon-circle-check"}),e._v("配置")])]):e._e()]}}])})],1),t("br"),t("el-form-item",{attrs:{prop:"whereCondition",rules:{required:!1,message:"请输入",trigger:"change"}},scopedSlots:e._u([{key:"label",fn:function(){return[t("span",[e._v("where条件")]),t("el-tooltip",{staticClass:"item",staticStyle:{"padding-left":"10px"},attrs:{effect:"dark",placement:"right"}},[t("div",{attrs:{slot:"content"},slot:"content"},[e._v("\n                                        注：增量时可以设置，where条件不需填写where关键字\n                                    ")]),t("i",{staticClass:"content-view iconfont iconbangzhu operate"})])]},proxy:!0}])},[t("el-input",{attrs:{type:"textarea",rows:5,placeholder:"请输入内容"},model:{value:e.param.whereCondition,callback:function(t){e.$set(e.param,"whereCondition",t)},expression:"param.whereCondition"}})],1)],1)]),t("el-tab-pane",{attrs:{label:"sql",name:"second"}},[t("template",{slot:"label"},[t("el-badge",{attrs:{"is-dot":e.isDot}},[e._v("\n                            SQL\n                            "),t("el-tooltip",{staticClass:"item",attrs:{effect:"dark",placement:"right"}},[t("div",{attrs:{slot:"content"},slot:"content"},[e._v("\n                                    注：红点标记表示字段映射或配置发生改变，需要切换到sql页面重新生成sql\n                                ")]),t("i",{staticClass:"content-view iconfont iconbangzhu operate"})])],1)],1),"second"===e.activeName?t("div",[t("div",{staticClass:"sql_btn_group"},[t("el-button",{attrs:{type:"primary",size:"mini",plain:""},on:{click:e.generateSql}},[e._v("生成SQL")]),t("el-button",{attrs:{type:"primary",size:"mini",plain:""},on:{click:function(t){return e.formaterSql(e.basicInfoForm.sqlMain)}}},[e._v("格式化SQL")])],1),t("SqlEditor",{ref:"sqleditor",attrs:{value:e.basicInfoForm.sqlMain},on:{changeTextarea:function(t){return e.changeTextarea(t)}}})],1):e._e()],2)],1)],1)]),e.dialogVisible?t("el-dialog",{attrs:{title:"合并规则配置",visible:e.dialogVisible,width:"50%"},on:{close:e.cancel,"update:visible":function(t){e.dialogVisible=t}}},[[t("el-form",{ref:"updateForm",staticClass:"form-item",attrs:{model:e.updateData,"label-width":"120px",rules:e.rules}},[t("el-row",[t("el-col",{attrs:{span:24}},[t("el-form-item",{attrs:{label:"融合策略",prop:"ruleId",rules:e.rules.ruleId}},[t("el-select",{attrs:{filterable:"",size:"mini"},on:{change:e.showType},model:{value:e.middleValue,callback:function(t){e.middleValue=t},expression:"middleValue"}},e._l(e.fusionStrategyOptions,(function(e){return t("el-option",{key:e.code,attrs:{label:e.name,value:e.code}})})),1)],1),t("el-table",{directives:[{name:"show",rawName:"v-show",value:1==e.middleValue,expression:"middleValue == 1"}],ref:"YSYYData",staticStyle:{width:"100%",margin:"0 auto"},attrs:{data:e.tableDataYSYY,"row-key":function(e){return e.tableId},border:""},on:{"row-click":e.rowChange}},[t("el-table-column",{attrs:{align:"center",width:"55",label:""},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-radio",{staticClass:"radio",attrs:{label:a.row.tableId},model:{value:e.selectItem,callback:function(t){e.selectItem=t},expression:"selectItem"}},[e._v(" ")])]}}],null,!1,1525676395)}),t("el-table-column",{attrs:{"show-overflow-tooltip":"",type:"index",label:"序号",index:function(t){return e.$utils._indexMethod(t,e.param.page,e.param.rows)},align:"center",width:"80"}}),e._e(),t("el-table-column",{attrs:{label:"部门",width:"80","show-overflow-tooltip":"",align:"center",prop:"deptName"}}),t("el-table-column",{attrs:{label:"系统",width:"80","show-overflow-tooltip":"",align:"center",prop:"systemName"}}),t("el-table-column",{attrs:{label:"表名","show-overflow-tooltip":"",align:"center",prop:"tableName"}})],1),t("el-table",{directives:[{name:"show",rawName:"v-show",value:2==e.middleValue,expression:"middleValue == 2"}],ref:"YSYYData1",staticStyle:{width:"100%",margin:"0 auto"},attrs:{data:e.tableDataYSYY,border:""}},[t("el-table-column",{attrs:{"show-overflow-tooltip":"",type:"index",label:"序号",index:function(t){return e.$utils._indexMethod(t,e.param.page,e.param.rows)},align:"center",width:"80"}}),t("el-table-column",{attrs:{width:"140",align:"center",prop:"limit"},scopedSlots:e._u([{key:"header",fn:function(){return[t("span",[e._v("优先级")]),t("el-tooltip",{staticClass:"item",staticStyle:{"padding-left":"3px"},attrs:{effect:"dark",placement:"right"}},[t("div",{attrs:{slot:"content"},slot:"content"},[e._v("\n                                            注：优先级数值越小代表优先级越高\n                                        ")]),t("i",{staticClass:"content-view iconfont iconbangzhu operate"})])]},proxy:!0},{key:"default",fn:function(a){return[t("el-input-number",{attrs:{size:"mini","controls-position":"right",min:1,max:1e3},model:{value:a.row.limit,callback:function(t){e.$set(a.row,"limit",t)},expression:"scope.row.limit"}})]}}],null,!1,187014258)}),t("el-table-column",{attrs:{label:"部门",width:"80","show-overflow-tooltip":"",align:"center",prop:"deptName"}}),t("el-table-column",{attrs:{label:"系统",width:"80","show-overflow-tooltip":"",align:"center",prop:"systemName"}}),t("el-table-column",{attrs:{label:"表名","show-overflow-tooltip":"",align:"center",prop:"tableName"}}),e._v("\n                            >\n                        ")],1),t("div",{directives:[{name:"show",rawName:"v-show",value:3==e.middleValue,expression:"middleValue == 3"}]},[e.columnSortList?t("div",e._l(e.columnSortList,(function(a){return t("div",{directives:[{name:"dragging",rawName:"v-dragging",value:{item:a,list:e.columnSortList,group:"data"},expression:"{\n                                        item: item,\n                                        list: columnSortList,\n                                        group: 'data',\n                                    }"}],key:a.columnId,staticStyle:{border:"2px"}},[t("el-checkbox",{attrs:{label:a},on:{change:e.cancelSelect},model:{value:e.checkData,callback:function(t){e.checkData=t},expression:"checkData"}},[e._v("\n                                        "+e._s(a.columnName+(a.columnComment?"("+a.columnComment+")":""))+"\n                                    ")]),t("el-switch",{staticStyle:{float:"right"},attrs:{size:"mini","active-value":"asc","inactive-value":"desc","active-text":"升序","inactive-text":"降序"},on:{change:function(t){return e.switchChange(a)}},model:{value:a.sortType,callback:function(t){e.$set(a,"sortType",t)},expression:"item.sortType"}}),t("br"),t("br")],1)})),0):e._e()])],1)],1)],1)],t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:e.cancel}},[e._v("取 消")]),t("el-button",{attrs:{type:"primary"},on:{click:e.submitData}},[e._v("确 定")])],1)],2):e._e()],1)}),[],!1,null,"097afd5b",null);t.default=f.exports},d862:function(e,t,a){"use strict";a.r(t),a("8e6e"),a("456d"),a("7f7f"),a("7514"),a("6762"),a("2fdb"),a("ac6a");var r=a("ade3"),n=a("2f62");function o(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function i(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?o(Object(a),!0).forEach((function(t){Object(r.a)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):o(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var l={computed:i({},Object(n.d)("fusionTask",["databaseConf"])),data:function(){return{storey:["au_ods","au_std","au_dwd","au_dwm","au_dws","au_app"],databaseList:[{label:"前置库",options:[]},{label:"",options:[]}],nameMap:{0:"stepStart",au_ods:"stepOds",au_std:"stepStd",au_dwd:"stepDwd",au_dwm:"stepDwm",au_dws:"stepDws",au_app:"stepApp"},titleMap:{0:"开始",1:"归集层",2:"标准层",3:"基础层",4:"主题层",5:"专题层",6:"安全层",7:"前置库"},process:[{id:"",title:"开始",stepId:"",success:!1}]}},methods:i(i({},Object(n.b)("fusionTask",["GET_DATA_BASE_LIST","GET_STEP_HEADERR"])),{},{getStepHeader:function(){var e=this;return new Promise((function(t){e.GET_STEP_HEADERR({taskId:e.$route.query.taskId}).then((function(a){if(a&&a.length>0){var r=a;r.forEach((function(t,a){if(0===a)t.success=!0,t.title="开始";else{var r=t.stepDetailList[0].targetDbCode;t.success=!0,t.title=e.storey.includes(r)?e.databaseList[1].options.find((function(e){return e.code===r})).label:e.databaseList[0].options.find((function(e){return e.code===r})).label}})),e.process=r}t(a)}))}))}}),created:function(){var e=this;this.isLoading=!0,this.databaseList[1].options=[],this.GET_DATA_BASE_LIST().then((function(){e.databaseConf.frontDBList.forEach((function(t,a){e.databaseList[0].options.push({label:t.name,value:a+1,type:t.type,code:t.code})})),e.databaseConf.modelDBList.forEach((function(t,a){e.databaseList[1].options.push({label:t.name,value:a+1,type:t.type,code:t.code})})),e.getStepHeader().then((function(t){e.$route.query.stepId&&e.process.find((function(t){return t.id==e.$route.query.stepId}))?e.backTo(e.process.find((function(t){return t.id==e.$route.query.stepId}))):t.length>0&&e.backTo(e.process[e.process.length-1])}))}))}};t.default=l},df76:function(e,t,a){"use strict";a.r(t),a("7514"),a("6762"),a("2fdb");var r={props:["selectParam","databaseList","isAlreadyStart","stepActiveId","startStep"],data:function(){return{storey:["au_ods","au_std","au_dwd","au_dwm","au_dws","au_app"],numSort:{au_ods:1,au_std:2,au_dwd:3,au_dwm:4,au_dws:5,au_app:6}}},components:{},computed:{isView:function(){return"view"===this.$route.query.filter},comSourceIsDisabled:function(){return function(e){var t=this;return!this.isAlreadyStart&&"0"!==e.type||"au_std"===this.selectParam.sourceRows[0].sourceDatabase&&"au_dwd"===this.selectParam.targetDatabase&&!this.storey.includes(e.code)||!!(""!==this.selectParam.targetDatabase&&this.storey.includes(this.selectParam.targetDatabase)&&"1"===e.type&&e.value>=this.databaseList[1].options.find((function(e){return e.code===t.selectParam.targetDatabase})).value)||!e&&void 0}},comTargetIsDisabled:function(){return function(e){var t=this,a=this.selectParam.sourceRows.filter((function(e){return""!==e.sourceDatabase&&"0"!==e.type})),r=a.map((function(e){return t.numSort[e.sourceDatabase]}));if(!(this.isAlreadyStart&&this.stepActiveId!=this.startStep.id||"1"===e.type))return!0;if(!this.storey.includes(this.selectParam.sourceRows[0].sourceDatabase)&&"au_ods"!==e.code)return!0;if(0===a.length)return!1;var n=r.reduce((function(e,t){return e>t?e:t}));return"0"!==e.type&&e.value<=n}}},mounted:function(){},methods:{tdWidth:function(){return"au_dwd"===this.selectParam.targetDatabase||"au_dws"===this.selectParam.targetDatabase?{width:"38px"}:{}},delRow:function(e){this.$emit("delRow",e)},addRow:function(){this.$emit("addRow")},autoCreate:function(){this.$emit("autoCreate")},sourceChange:function(e){this.$emit("sourceChange",e)},targetChange:function(){this.$emit("targetChange")},selectTable:function(e,t){this.$emit("select",e,t)},toHandleCreate:function(){this.$emit("handleCreate")}}},n=(a("4f8c"),a("2877")),o=Object(n.a)(r,(function(){var e=this,t=e._self._c;return t("table",{staticClass:"search"},[e._l(e.selectParam.sourceRows,(function(a,r){return t("tr",{key:r,staticClass:"row"},[e._m(0,!0),t("td",[t("el-select",{attrs:{disabled:0===r&&e.isAlreadyStart||e.isView,placeholder:"请选择",clearable:""},on:{change:function(t){return e.sourceChange(a)}},model:{value:a.sourceDatabase,callback:function(t){e.$set(a,"sourceDatabase",t)},expression:"p.sourceDatabase"}},e._l(e.databaseList,(function(a){return t("el-option-group",{key:a.label,attrs:{label:a.label}},e._l(a.options,(function(a){return t("el-option",{key:a.code,attrs:{label:a.label,value:a.code,disabled:e.comSourceIsDisabled(a)}})})),1)})),1)],1),t("td",{staticClass:"task_seconed_select"},[t("el-select",{attrs:{multiple:"",placeholder:"请选择原表",disabled:""},model:{value:a.alreadySelectSourceTableValue,callback:function(t){e.$set(a,"alreadySelectSourceTableValue",t)},expression:"p.alreadySelectSourceTableValue"}},e._l(a.alreadySelectSourceTable,(function(e){return t("el-option",{key:e.id,attrs:{label:e.tableName,value:e.id}})})),1)],1),t("td",{attrs:{slot:"footer"},slot:"footer"},[t("el-button",{attrs:{disabled:0===r&&e.isAlreadyStart||e.isView,type:"primary"},on:{click:function(t){return e.selectTable("source",r)}}},[e._v("选择")])],1),t("td",[0!==r||"au_dwd"!==e.selectParam.targetDatabase&&"au_dws"!==e.selectParam.targetDatabase?e._e():t("el-button",{attrs:{size:"mini",type:"primary",icon:"el-icon-plus",circle:"",disabled:e.isView},on:{click:e.addRow}})],1),t("td",[0!==r?t("el-button",{attrs:{size:"mini",type:"danger",icon:"el-icon-minus",disabled:e.isView,circle:""},on:{click:function(t){return e.delRow(r)}}}):e._e()],1)])})),t("tr",{staticClass:"row"},[e._m(1),t("td",[t("el-select",{attrs:{placeholder:"请选择",clearable:"",disabled:e.isView},on:{change:e.targetChange},model:{value:e.selectParam.targetDatabase,callback:function(t){e.$set(e.selectParam,"targetDatabase",t)},expression:"selectParam.targetDatabase"}},e._l(e.databaseList,(function(a){return t("el-option-group",{key:a.label,attrs:{label:a.label}},e._l(a.options,(function(a){return t("el-option",{key:a.code,attrs:{label:a.label,value:a.code,disabled:e.comTargetIsDisabled(a)}})})),1)})),1)],1),e.selectParam.autoCreate?e._e():t("td",{staticClass:"task_seconed_select"},[t("el-select",{attrs:{multiple:"",placeholder:"请选择目标表",disabled:""},model:{value:e.selectParam.alreadySelectTargetTableValue,callback:function(t){e.$set(e.selectParam,"alreadySelectTargetTableValue",t)},expression:"selectParam.alreadySelectTargetTableValue"}},e._l(e.selectParam.alreadySelectTargetTable,(function(e){return t("el-option",{key:e.id,attrs:{label:e.tableName,value:e.id}})})),1)],1),t("td",[e.selectParam.autoCreate?e._e():t("el-button",{attrs:{disabled:e.isView,type:"primary"},on:{click:function(t){return e.selectTable("target")}}},[e._v("选择")])],1),t("td",{style:e.tdWidth()})])],2)}),[function(){var e=this._self._c;return e("td",{staticClass:"label"},[e("span",{staticClass:"require"},[this._v("*")]),this._v("源数据层")])},function(){var e=this._self._c;return e("td",{staticClass:"label"},[e("span",{staticClass:"require"},[this._v("*")]),this._v("目标数据层")])}],!1,null,"30146580",null);t.default=o.exports},e31d:function(e,t,a){"use strict";a.r(t),a("7f7f"),a("8e6e"),a("8615"),a("456d"),a("7514"),a("ac6a"),a("5df3"),a("4f7f");var r=a("ade3"),n=a("2f62"),o=a("db05"),i=a.n(o),l=a("f029"),s=a("e762");function c(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function u(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?c(Object(a),!0).forEach((function(t){Object(r.a)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):c(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var d={props:["selectParam"],data:function(){return{basicInfoForm:{sqlMain:""},isDot:!1,treeCheckId:"",indexs:"",dispositionheard:[],dispositionData:[],dispositionExpand:"",ruleobjet:{},catCode:"",pages:{page:1,rows:10,total:0,name:"",code:""},defaultProps:{label:"name",children:"children"},treeExpandData:["DESENSITIZATION_ALGORITHM"],datasCondition:[],showCondition:!1,activeName:"first",autoMapValue:!1,sourceName:"",tagName:"",param:{sourceTableName:"",targetTableName:"",tableInfo:[],automaticTableCreation:"",whereCondition:"",sqlValue:"",taskId:this.$route.query.taskId,sourceTableId:"",targetTableId:"",stepId:"",stepDetailId:"",levelCode:"au_app",complete:0},targetColumnOptions:[],lastWhere:"",rules:{sourceDatabase:[{required:!0,message:"请选择",trigger:"change"}],whereCondition:[{validator:function(e,t,a){/^where\s+/i.test(t)||/^WHERE\s+/i.test(t)?a(new Error("where条件不需填写where关键字")):a()},trigger:"blur"}]},alreadySelectTargetTable:[]}},watch:{newSelectParam:{handler:function(e){var t=this;this.$nextTick((function(){t.$store.state.fusionTask.isLoading||e.alreadySelectTargetTable.length>0&&(t.param.sourceTableName=e.sourceRows[0].alreadySelectSourceTable[0].tableName,t.param.targetTableName=e.alreadySelectTargetTable[0].tableName,t.param.sourceTableId=e.sourceRows[0].alreadySelectSourceTable[0].id,t.param.targetTableId=e.alreadySelectTargetTable[0].id,t.param.automaticTableCreation=e.isAutoCreate,t.getCloumnList(e.sourceRows[0].alreadySelectSourceTable[0].id,e.alreadySelectTargetTable[0].id))}))},deep:!0}},components:{SqlEditor:l.default},computed:{newSelectParam:function(){return u({},this.selectParam)}},mounted:function(){},methods:u(u(u({},Object(n.b)(["_AJAX"])),Object(n.b)("stepStd",["INSERTORUPDATE"])),{},{handleSelect:function(e){this.param.tableInfo[e].ruleId="",this.param.tableInfo[e].ruleName="",this.param.tableInfo[e].catCode="",this.param.sqlValue="",this.basicInfoForm.sqlMain="",this.isDot=!0},changeOrnotWhere:function(){null!=this.lastWhere&&""!=this.lastWhere&&this.lastWhere!=this.param.whereCondition&&(this.param.sqlValue="",this.basicInfoForm.sqlMain="")},rowChange:function(e){var t=this;this.dispositionExpand==e.selfId?this.$nextTick((function(){t.dispositionExpand="",t.ruleobjet={}})):this.$nextTick((function(){t.dispositionExpand=e.selfId,t.ruleobjet=e}))},radioCancelSelect:function(e,t,a){var r=this;"INPUT"!==e.target.tagName&&(this.dispositionExpand==a?this.$nextTick((function(){r.dispositionExpand="",r.ruleobjet={}})):this.$nextTick((function(){r.dispositionExpand=t.selfId,r.ruleobjet=t})))},generateSql:function(){var e=this,t=this.param.tableInfo.filter((function(e){return""!=e.targetValue&&null!=e.targetValue})).map((function(e){return e.targetValue}));if(new Set(t).size!==t.length)this.$message.error("目标表的表字段不允许重复");else if(this.param.tableInfo.every((function(e){return""===e.targetValue||null===e.targetValue})))this.$message.error("目标表的字段最少填一个，不可全部为空");else{var a=this.deepClone(this.param);a.automaticTableCreation?a.automaticTableCreation=1:a.automaticTableCreation=0,a.sqlValue=Object(s.b)(this.basicInfoForm.sqlMain),a.whereCondition=Object(s.b)(a.whereCondition),this._AJAX({url:"stdStep.getStdStepSql",method:"POST",data:a}).then((function(t){e.lastWhere=e.param.whereCondition,e.$set(e.basicInfoForm,"sqlMain",t),e.$refs.sqleditor.setVal();var a=e.activeName;e.activeName="",e.$nextTick((function(){e.activeName=a})),e.isDot=!1,e.$message.success("生成SQL成功！")}))}},gettargetList:function(){var e=this;return new Promise((function(t){e._AJAX({url:"appStep.getColumnList",method:"GET",data:{sourceTableId:e.param.sourceTableId,targetTableId:e.param.targetTableId}}).then((function(a){e.targetColumnOptions=a[e.param.targetTableId],t(a)}))}))},getDisposition:function(e){var t=this;"ENCRYPTION_ALGORITHM_SM4"==e.code?(this.pages.code="SM4",this._AJAX({url:"appStep.encryptPage",method:"GET",data:this.pages}).then((function(a){t.dispositionheard=a.heard;var r=a.data.rows;t.pages.total=a.data.total,r.forEach((function(t){t.selfId="".concat(e.code,"&").concat(t.id)})),t.dispositionData=r}))):"ENCRYPTION_ALGORITHM_DES"==e.code?(this.pages.code="DES",this._AJAX({url:"appStep.encryptPage",method:"GET",data:this.pages}).then((function(a){t.dispositionheard=a.heard;var r=a.data.rows;t.pages.total=a.data.total,r.forEach((function(t){t.selfId="".concat(e.code,"&").concat(t.id)})),t.dispositionData=r}))):"CARACTER_ALGORITHM"==e.code&&this._AJAX({url:"appStep.sensitivePage",method:"GET",data:this.pages}).then((function(a){t.dispositionheard=a.heard,t.pages.total=a.data.total;var r=a.data.rows;r.forEach((function(t){t.selfId="".concat(e.code,"&").concat(t.id)})),t.dispositionData=r}))},getopendialog:function(e){var t=this;this._AJAX({url:"appStep.getAlgorithmTree",method:"GET"}).then((function(a){t.datasCondition=a,t.ruleobjet={},t.dispositionExpand="",""!=t.param.tableInfo[e].catCode&&null!=t.param.tableInfo[e].catCode?(t.dispositionExpand=t.param.tableInfo[e].catCode+"&"+t.param.tableInfo[e].ruleId,t.catCode=t.param.tableInfo[e].catCode):(t.catCode="CARACTER_ALGORITHM",t.dispositionData=[],t.dispositionheard=[]),t.getDisposition({code:t.catCode}),t.$nextTick((function(){t.$refs.tree.setCurrentKey(t.catCode)})),t.indexs=e,t.showCondition=!0}))},Automaticmapping:function(e){var t=this;e?this.param.tableInfo.forEach((function(e){var a=t.targetColumnOptions.find((function(t){return t.columnName===e.sourceValue}));e.targetValue=a?a.id:""})):this.param.tableInfo.forEach((function(e){e.targetValue=""}))},getCloumnList:function(e,t){var a=this;this._AJAX({url:"appStep.getColumnList",method:"GET",data:{sourceTableId:e,targetTableId:t}}).then((function(r){a.param.tableInfo=r[e].map((function(e){if(0==e.additionColumn)return{sourceid:e.id,sourceValue:e.columnName,additionColumn:e.additionColumn,targetValue:"",ruleId:"",catCode:"",ruleName:""}})),a.targetColumnOptions=r[t]}))},onSubmit:function(){Object.keys(this.ruleobjet).length>0?"CARACTER_ALGORITHM"==this.catCode?(this.param.tableInfo[this.indexs].ruleName=this.ruleobjet.name,this.param.tableInfo[this.indexs].ruleId=this.ruleobjet.id,this.param.tableInfo[this.indexs].catCode=this.catCode):("ENCRYPTION_ALGORITHM_DES"==this.catCode||"ENCRYPTION_ALGORITHM_SM4"==this.catCode)&&(this.param.tableInfo[this.indexs].ruleName=this.ruleobjet.encryptName,this.param.tableInfo[this.indexs].ruleId=this.ruleobjet.id,this.param.tableInfo[this.indexs].catCode=this.catCode):(this.param.tableInfo[this.indexs].ruleName="",this.param.tableInfo[this.indexs].ruleId="",this.param.tableInfo[this.indexs].catCode="",this.catCode=""),this.showCondition=!1},changeTextarea:function(e){this.$set(this.basicInfoForm,"sqlMain",e)},formaterSql:function(){var e=this.$refs.sqleditor;e.editor.setValue(i.a.format(e.editor.getValue()))},handleSizeChange:function(e){this.pages.page=1,this.pages.rows=e,this.getDisposition({code:this.catCode})},handleCurrentChange:function(e){this.pages.page=e,this.getDisposition({code:this.catCode})},onSearch:function(){this.getDisposition({code:this.catCode})},handleClose:function(){this.pages.name="",this.showCondition=!1},handleNodeClick:function(e){e.children?(this.dispositionheard=[],this.dispositionData=[]):(this.catCode=e.code,this.getDisposition({code:e.code}))},deepClone:function(e){return JSON.parse(JSON.stringify(e))},handleClick:function(){},handleStep:function(e){var t=this;return this.$store.commit("fusionTask/changeLoading",!0),new Promise((function(a,r){e>0&&t._AJAX({url:"stdStep.getStepStdDeail",method:"GET",data:{taskId:t.param.taskId,levelCode:t.param.levelCode}}).then((function(e){Object.values(e).some((function(e){return null!==e}))&&(t.param=e,t.param.complete=0,t.param.levelCode="au_app",t.gettargetList().then((function(e){setTimeout((function(){t.$store.commit("fusionTask/changeLoading",!1)})),t.$nextTick((function(){t.basicInfoForm.sqlMain=t.param.sqlValue})),a(e)})))})).catch((function(e){r(e)}))}))},next:function(e){var t=this;return this.param.stepId=e,new Promise((function(e,a){var r=t.param.tableInfo.filter((function(e){return""!=e.targetValue})).map((function(e){return e.targetValue}));new Set(r).size!==r.length?t.$message.error("目标表的表字段不允许重复"):""!==t.basicInfoForm.sqlMain?t.param.tableInfo.every((function(e){return""===e.targetValue||null===e.targetValue}))?t.$message.error("目标表的字段最少填一个，不可全部为空"):t.$refs.stepStandardLayerForm.validate((function(r){if(r){t.$store.commit("fusionTask/changeLoading",!0);var n=t.deepClone(t.param);t.param.automaticTableCreation?n.automaticTableCreation=1:n.automaticTableCreation=0,n.sqlValue=Object(s.b)(t.basicInfoForm.sqlMain),n.whereCondition=Object(s.b)(t.param.whereCondition),t.INSERTORUPDATE(n).then((function(t){e(t)})).catch((function(e){a(e)}))}})):t.$message.error("sql不可以为空，请去填写sql")}))},submit:function(e){var t=this;return this.param.stepId=e,this.param.complete=1,new Promise((function(e,a){var r=t.param.tableInfo.filter((function(e){return""!=e.targetValue})).map((function(e){return e.targetValue}));new Set(r).size!==r.length?t.$message.error("目标表的表字段不允许重复"):""!==t.basicInfoForm.sqlMain?t.param.tableInfo.every((function(e){return""===e.targetValue||null===e.targetValue}))?t.$message.error("目标表的字段最少填一个，不可全部为空"):t.$refs.stepStandardLayerForm.validate((function(r){if(r){t.$store.commit("fusionTask/changeLoading",!0);var n=t.deepClone(t.param);t.param.automaticTableCreation?n.automaticTableCreation=1:n.automaticTableCreation=0,n.sqlValue=Object(s.b)(t.basicInfoForm.sqlMain),n.whereCondition=Object(s.b)(t.param.whereCondition),t.INSERTORUPDATE(n).then((function(a){t.$store.commit("fusionTask/changeLoading",!1),e(a)})).catch((function(e){t.$store.commit("fusionTask/changeLoading",!1),a(e)}))}})):t.$message.error("sql不可以为空，请去填写sql")}))}})},p=(a("5840"),a("2877")),m=Object(p.a)(d,(function(){var e=this,t=e._self._c;return t("div",[t("el-form",{ref:"stepStandardLayerForm",staticClass:"form-item",attrs:{model:e.param,"label-width":"120px",rules:e.rules,"label-position":"left",disabled:"view"===e.$route.query.filter}},[t("div",[t("el-tabs",{attrs:{type:"card"},on:{"tab-click":e.handleClick},model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},[t("el-tab-pane",{attrs:{label:"字段映射",name:"first"}},[t("div",[t("div",{staticClass:"checkboxrow"},[t("el-button",{attrs:{size:"mini",plain:"",type:"primary"},on:{click:function(t){return e.Automaticmapping(!0)}}},[e._v("字段自动映射")])],1),t("el-table",{ref:"tableData",staticStyle:{width:"100%",margin:"0 auto"},attrs:{data:e.param.tableInfo,border:""}},[t("el-table-column",{attrs:{prop:"sourceValue",label:e.param.sourceTableName,align:"center"}}),t("el-table-column",{attrs:{label:e.param.targetTableName,prop:"targetValue"},scopedSlots:e._u([{key:"default",fn:function(a){return[e.targetColumnOptions.length>0?t("div",{staticClass:"flex"},[t("el-form-item",{attrs:{rules:{required:!0,message:"请选择",trigger:"change"}}},[t("el-select",{attrs:{placeholder:"请选择",clearable:""},on:{change:function(t){return e.handleSelect(a.$index)}},model:{value:a.row.targetValue,callback:function(t){e.$set(a.row,"targetValue",t)},expression:"scope.row.targetValue"}},e._l(e.targetColumnOptions,(function(e){return t("el-option",{key:e.id,attrs:{label:e.columnName,value:e.id}})})),1)],1)],1):e._e()]}}])}),t("el-table-column",{attrs:{label:"脱敏/加密策略",prop:"ruleId",width:"450",align:"center"},scopedSlots:e._u([{key:"default",fn:function(a){return[1!=a.row.additionColumn?t("div",{staticClass:"flex"},[t("el-form-item",[t("el-input",{attrs:{disabled:""},model:{value:a.row.ruleName,callback:function(t){e.$set(a.row,"ruleName",t)},expression:"scope.row.ruleName"}}),t("el-button",{attrs:{type:"primary",icon:"el-icon-edit",size:"mini",circle:""},on:{click:function(t){return e.getopendialog(a.$index)}}})],1)],1):e._e()]}}])})],1),t("br"),t("el-form-item",{attrs:{prop:"whereCondition"},scopedSlots:e._u([{key:"label",fn:function(){return[t("span",[e._v("where条件")]),t("el-tooltip",{staticClass:"item",staticStyle:{"padding-left":"10px"},attrs:{effect:"dark",placement:"right"}},[t("div",{attrs:{slot:"content"},slot:"content"},[e._v("\n                                        注：where条件不需填写where关键字\n                                    ")]),t("i",{staticClass:"content-view iconfont iconbangzhu operate"})])]},proxy:!0}])},[t("el-input",{attrs:{type:"textarea",rows:5,placeholder:"请输入内容"},on:{blur:e.changeOrnotWhere},model:{value:e.param.whereCondition,callback:function(t){e.$set(e.param,"whereCondition",t)},expression:"param.whereCondition"}})],1)],1)]),t("el-tab-pane",{attrs:{label:"sql",name:"second"}},[t("template",{slot:"label"},[t("el-badge",{attrs:{"is-dot":e.isDot}},[e._v("\n                            SQL\n                            "),t("el-tooltip",{staticClass:"item",attrs:{effect:"dark",placement:"right"}},[t("div",{attrs:{slot:"content"},slot:"content"},[e._v("\n                                    注：红点标记表示字段映射或配置发生改变，需要切换到sql页面重新生成sql\n                                ")]),t("i",{staticClass:"content-view iconfont iconbangzhu operate"})])],1)],1),t("div",["second"===e.activeName?t("div",[t("div",{staticClass:"sql_btn_group"},[t("el-button",{attrs:{type:"primary",size:"mini",plain:""},on:{click:e.generateSql}},[e._v("生成SQL")]),t("el-button",{attrs:{type:"primary",size:"mini",plain:""},on:{click:function(t){return e.formaterSql(e.basicInfoForm.sqlMain)}}},[e._v("格式化SQL")])],1),t("SqlEditor",{ref:"sqleditor",attrs:{value:e.basicInfoForm.sqlMain},on:{changeTextarea:function(t){return e.changeTextarea(t)}}})],1):e._e()])],2)],1)],1)]),t("el-dialog",{attrs:{title:"策略配置",visible:e.showCondition,width:"80%","before-close":e.handleClose,"append-to-body":""},on:{"update:visible":function(t){e.showCondition=t}}},[t("div",{staticStyle:{height:"60vh"}},[t("audaque-resize-split-page",[t("template",{slot:"leftPane"},[t("el-tree",{ref:"tree",staticClass:"tree-dashed",attrs:{data:e.datasCondition,props:e.defaultProps,"default-expand-all":!0,"node-key":"code"},on:{"node-click":e.handleNodeClick}})],1),t("template",{slot:"rightPane"},[t("div",{staticClass:"row",staticStyle:{"margin-bottom":"10px"}},[t("div",{staticStyle:{width:"50%"}},[t("el-input",{attrs:{placeholder:"通过规则名称模糊查询",clearable:""},model:{value:e.pages.name,callback:function(t){e.$set(e.pages,"name",t)},expression:"pages.name"}})],1),t("div",[t("el-button",{attrs:{type:"primary"},on:{click:e.onSearch}},[e._v("筛选")])],1)]),t("el-table",{staticClass:"el-table-common__list",attrs:{"tooltip-effect":"light","highlight-current-row":"",stripe:"",data:e.dispositionData,border:""},on:{"row-click":e.rowChange}},[e.dispositionData.length>0?t("el-table-column",{attrs:{label:"选择"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-radio",{staticClass:"radio",attrs:{label:a.row.selfId},nativeOn:{click:function(t){return t.preventDefault(),t.stopPropagation(),e.radioCancelSelect(t,a.row,a.row.selfId)}},model:{value:e.dispositionExpand,callback:function(t){e.dispositionExpand=t},expression:"dispositionExpand"}},[e._v(" ")])]}}],null,!1,2164990980)}):e._e(),e.dispositionData.length>0?t("el-table-column",{attrs:{"show-overflow-tooltip":"",type:"index",label:"序号",index:function(t){return e.$utils._indexMethod(t,e.pages.page,e.pages.rows)},align:"center",width:"80"}}):e._e(),e._l(e.dispositionheard,(function(a,r){return[t("el-table-column",{key:r,attrs:{"show-overflow-tooltip":"",align:"center",prop:a.name,label:a.code},scopedSlots:e._u([{key:"default",fn:function(r){return["reversible"===a.name?t("span",[e._v(e._s(1===r.row.reversible?"可逆":"不可逆"))]):"type"===a.name?t("span",[e._v(e._s(1===r.row.type?"字符替换":"其他"))]):"encryptType"===a.name?t("span",[e._v(e._s("1"===r.row.encryptType?"DES":"SM4"))]):t("span",[e._v(e._s(r.row[a.name]))])]}}],null,!0)})]}))],2),t("adq-pagination",{attrs:{"current-page":e.pages.page,total:e.pages.total,"page-size":e.pages.rows},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}}),t("div",{staticClass:"row",staticStyle:{"margin-top":"10px"}},[t("div",[t("el-button",{on:{click:e.handleClose}},[e._v("取消")])],1),t("div",[t("el-button",{attrs:{type:"primary"},on:{click:e.onSubmit}},[e._v("确认")])],1)])],1)],2)],1)])],1)}),[],!1,null,"08c0f924",null);t.default=m.exports},e67c:function(e,t,a){"use strict";a("77d62")},e738:function(e,t,a){(e.exports=a("2350")(!1)).push([e.i,".get-edit-item[data-v-0431ed02]{padding-top:20px;margin:0 50px}.get-edit-item li[data-v-0431ed02]{margin-top:20px;display:-webkit-box;display:-ms-flexbox;display:flex}.get-edit-item li .get-edit-type[data-v-0431ed02]{height:40px;line-height:40px}.get-edit-item li .get-edit-title[data-v-0431ed02]{width:80px;color:#3a405b;height:40px;line-height:40px}.get-edit-item li .el-tree[data-v-0431ed02]{width:100%;border:1px solid #dcdfe6;padding:24px}.custom_table1 tbody td[data-v-0431ed02],.custom_table1 thead th[data-v-0431ed02]{width:11%}.custom_table[data-v-0431ed02]{border-collapse:collapse;width:100%;text-align:left}.custom_table thead tr[data-v-0431ed02]{background:#f9fafb}.custom_table thead th[data-v-0431ed02]{color:#666;font-size:13px}.custom_table tbody tr[data-v-0431ed02]{border:1px solid #ebeef5;padding:5px 0}.custom_table tbody i[data-v-0431ed02]{color:red;font-size:30px;cursor:pointer}",""])},e9e0:function(e,t,a){var r=a("051c");r.__esModule&&(r=r.default),"string"==typeof r&&(r=[[e.i,r,""]]),r.locals&&(e.exports=r.locals),(0,a("499e").default)("abb5b90a",r,!0,{sourceMap:!1,shadowMode:!1})},ee0f:function(e,t,a){"use strict";a("c721")},ee74:function(e,t,a){"use strict";a("f239")},f239:function(e,t,a){var r=a("172b");r.__esModule&&(r=r.default),"string"==typeof r&&(r=[[e.i,r,""]]),r.locals&&(e.exports=r.locals),(0,a("499e").default)("bb9bff6a",r,!0,{sourceMap:!1,shadowMode:!1})},fa01:function(e,t,a){"use strict";a("3588")}}]);