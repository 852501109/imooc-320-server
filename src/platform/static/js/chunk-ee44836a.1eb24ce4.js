(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-ee44836a"],{4125:function(e,t,a){"use strict";a("784e")},"63d3":function(e,t,a){(e.exports=a("2350")(!1)).push([e.i,".get-edit-item[data-v-14e2a421]{padding-top:20px;margin:0 50px}.get-edit-item li[data-v-14e2a421]{margin-top:20px;display:-webkit-box;display:-ms-flexbox;display:flex}.get-edit-item li .get-edit-type[data-v-14e2a421]{height:40px;line-height:40px}.get-edit-item li .get-edit-title[data-v-14e2a421]{width:80px;color:#3a405b;height:40px;line-height:40px}.get-edit-item li .el-tree[data-v-14e2a421]{width:100%;border:1px solid #dcdfe6;padding:24px}.row[data-v-14e2a421]{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-pack:start;-ms-flex-pack:start;justify-content:flex-start;-webkit-box-align:center;-ms-flex-align:center;align-items:center;margin-bottom:10px}.row>div[data-v-14e2a421]{margin-right:10px}[data-v-14e2a421] .el-table{width:96%;margin:0 auto}",""])},"784e":function(e,t,a){var r=a("63d3");r.__esModule&&(r=r.default),"string"==typeof r&&(r=[[e.i,r,""]]),r.locals&&(e.exports=r.locals),(0,a("499e").default)("2f22107b",r,!0,{sourceMap:!1,shadowMode:!1})},f15f:function(e,t,a){"use strict";a.r(t),a("8e6e"),a("456d"),a("ac6a"),a("c5f6"),a("7f7f"),a("7514");var r=a("ade3"),i=a("2f62");function l(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function o(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?l(Object(a),!0).forEach((function(t){Object(r.a)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):l(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var n={data:function(){return{rowId:this.$route.query.id,filter:"view"!=this.$route.query.filter,statuslist:[{name:"关闭",id:"0"},{name:"开启",id:"1"}],tableData:[{cn:"哥哥哥",en:"ggg"},{cn:"哥哥哥",en:"ggg"}],delColList:[],currentTable:[],logicList:[],relateDimList:[],relatedDimCols:[],curRelateDim:[],logicColList:[],startOptions:[],endOptions:[],param:{id:"",refTargetId:"",dimDesc:"",dimNameCn:"",relateColId:"",refTargetColId:""},rules:{refTargetId:[{required:!0,message:"请选择维度表",trigger:"change"}],dimDesc:[{required:!0,validator:this.checkDimName,trigger:"blur"}],dimNameCn:[{required:!0,message:"请输入关联中文名",trigger:"blur"}],relateColId:[{validator:this.validateCustom,required:!0,trigger:"change"}]}}},computed:{},methods:o(o(o({},Object(i.b)("develop",["QUERY_DAP_SUM_SCCLIMIT_DEF_DETAIL","UPDATE_DAP_SUM_SCCLIMIT_DEF","INSERT_DAP_SUM_SCCLIMIT_DEF","GET_DAP_SUM_SCCLIMIT_DEF_DOMAIN","GET_DAP_SUM_SCCLIMIT_DEF_LOGIC","GET_DAP_SUM_SCCLIMIT_DEF_LOGIC_COL"])),Object(i.b)(["_AJAX"])),{},{checkDimName:function(e,t,a){return t?/^[a-zA-Z].*$/.test(t)?void a():a(new Error("必须以英文开头")):a(new Error("英文名不可为空"))},validateCustom:function(e,t,a){""===t?a(new Error("请选择当前维度字段")):""===this.param.refTargetColId?a(new Error("请选择被关联维度字段")):a()},changeTextarea:function(e){this.$set(this.param,"calcExpress",e)},del:function(e){null!==this.currentTable[e].tabJoinId&&""!==this.currentTable[e].tabJoinId&&void 0!==this.currentTable[e].tabJoinId&&this.delColList.push({tabJoinId:this.currentTable[e].tabJoinId}),this.currentTable.splice(e,1)},add:function(){var e=this;this.$refs.subForm.validate((function(t){if(!t)return!1;for(var a=e.relateDimList.find((function(t){return t.dimTabId===e.param.refTargetId})).tabName,r=e.curRelateDim.find((function(t){return t.id===e.param.relateColId})).colName,i=e.relatedDimCols.find((function(t){return t.id===e.param.refTargetColId})).colName,l=0;l<e.currentTable.length;l++){var o=e.currentTable[l];if(o.refTargetName===a&&o.refTargetColName===i)return void e.$message.warning("已建关联，无需重复建立")}e.currentTable.push({refTargetId:e.param.refTargetId,refTargetName:a,dimDesc:e.param.dimDesc,dimNameCn:e.param.dimNameCn,relateColId:e.param.relateColId,relateColName:r,refTargetColId:e.param.refTargetColId,refTargetColName:i})}))},initCurRelateDim:function(){var e=this;this._AJAX({url:"dimLogicTab.getRelatedDimCols",method:"GET",data:{tabId:this.$route.query.tabId}}).then((function(t){e.curRelateDim=t}))},changeRelateDim:function(e){var t=this;this.param.refTargetColId="",this._AJAX({url:"dimLogicTab.getRelatedDimCols",method:"GET",data:{tabId:e}}).then((function(e){t.relatedDimCols=e}))},changeLogic:function(e){var t=this;this.param.logicColId="",this.GET_DAP_SUM_SCCLIMIT_DEF_LOGIC_COL({tabId:e}).then((function(e){t.logicColList=e}))},changeColName:function(){this.initExp()},initExp:function(){var e=this;if(""===this.param.calcExpress&&this.param.logicTabId&&this.param.logicColId){var t=this.logicList.find((function(t){return t.code===e.param.logicTabId})).name,a=this.logicColList.find((function(t){return t.code===e.param.logicColId})).name;this.$refs.sqleditor.editor.setValue("select ".concat(a," from ").concat(t))}},indicatorsSubmit:function(){},indicatorsClose:function(){this.indicatorsAsync=!1},validateExpress:function(e,t,a){this.param.beginExpressFuc?this.param.beginExpress?this.param.endExpressFuc?this.param.endExpress?a():a(new Error("请选择结束时间函数表达式")):a(new Error("请选择结束时间函数表达式函数")):a(new Error("请输入开始时间函数表达式")):a(new Error("请选择开始时间函数表达式函数"))},getAlreadyRelateList:function(){var e=this;this._AJAX({url:"dimLogicTab.getRelatedList",method:"GET",data:{dimId:Number(this.$route.query.dimId)}}).then((function(t){e.currentTable=t}))},getRelateDimList:function(){var e=this;this._AJAX({url:"dimLogicTab.getRelateDimList",method:"GET",data:{tabId:this.$route.query.tabId,srcDbType:this.$route.query.srcDbType}}).then((function(t){e.relateDimList=t}))},subBtn:function(){var e=this,t=this;this.$store.commit("SHOW_LOADING",!0);var a={colList:this.currentTable.map((function(t){return{tabJoinId:t.tabJoinId,relateId:Number(e.$route.query.tabId),relateName:e.$route.query.tabName,relateDimId:e.$route.query.dimId,relateColId:t.relateColId,relateColName:t.relateColName,refTargetId:t.refTargetId,refTargetName:t.refTargetName,refTargetColId:t.refTargetColId,refTargetColName:t.refTargetColName,dimNameCn:t.dimNameCn,dimDesc:t.dimDesc}})),delColList:this.delColList};a.colList.forEach((function(e){void 0===e.tabJoinId&&delete e.tabJoinId})),this._AJAX({url:"dimLogicTab.saveDapRelateDim",method:"POST",data:a}).then((function(){e.$AudaqueToast.tip({template:"添加成功",methods:{okEvent:function(){t.$router.go(-1)}}})}))}}),mounted:function(){},created:function(){this.getRelateDimList(),this.initCurRelateDim(),this.getAlreadyRelateList()}},s=(a("4125"),a("2877")),d=Object(s.a)(n,(function(){var e=this,t=e._self._c;return t("audaque-detail-form-page",{attrs:{title:"关联关系","opt-type":e.$route.query.filter},on:{"submit-click":e.subBtn}},[[t("el-form",{ref:"subForm",staticClass:"form-item",attrs:{model:e.param,"label-width":"120px",rules:e.rules,disabled:!e.filter}},[t("el-row",[t("el-col",{attrs:{span:24}},[t("el-form-item",{attrs:{label:"被关联维度",prop:"refTargetId",rules:e.rules.refTargetId}},[t("el-select",{attrs:{placeholder:"请选择维度表"},on:{change:e.changeRelateDim},model:{value:e.param.refTargetId,callback:function(t){e.$set(e.param,"refTargetId",t)},expression:"param.refTargetId"}},e._l(e.relateDimList,(function(e){return t("el-option",{key:e.dimTabId,attrs:{value:e.dimTabId,label:e.tabName}})})),1)],1),t("el-form-item",{attrs:{label:"关联英文名",prop:"dimDesc",rules:e.rules.dimDesc}},[t("el-input",{attrs:{disabled:!e.filter,placeholder:"请输入关联英文名","show-word-limit":""},model:{value:e.param.dimDesc,callback:function(t){e.$set(e.param,"dimDesc","string"==typeof t?t.trim():t)},expression:"param.dimDesc"}})],1),t("el-form-item",{attrs:{label:"关联中文名",prop:"dimNameCn",rules:e.rules.dimNameCn}},[t("el-input",{attrs:{disabled:!e.filter,placeholder:"请输入关联中文名","show-word-limit":""},model:{value:e.param.dimNameCn,callback:function(t){e.$set(e.param,"dimNameCn","string"==typeof t?t.trim():t)},expression:"param.dimNameCn"}})],1),t("div",{staticStyle:{padding:"30px","font-size":"15px"}},[e._v("编辑关联逻辑")]),t("el-form-item",{attrs:{label:"关联字段",prop:"relateColId",rules:e.rules.relateColId}},[t("div",{staticClass:"row"},[t("el-select",{attrs:{placeholder:"当前维度字段"},on:{change:e.changeLogic},model:{value:e.param.relateColId,callback:function(t){e.$set(e.param,"relateColId",t)},expression:"param.relateColId"}},e._l(e.curRelateDim,(function(e){return t("el-option",{key:e.id,attrs:{value:e.id,label:e.colName}})})),1),t("el-select",{attrs:{placeholder:"被关联维度字段"},model:{value:e.param.refTargetColId,callback:function(t){e.$set(e.param,"refTargetColId",t)},expression:"param.refTargetColId"}},e._l(e.relatedDimCols,(function(e){return t("el-option",{key:e.id,attrs:{value:e.id,label:e.colName}})})),1),t("el-button",{attrs:{type:"primary"},on:{click:e.add}},[e._v("关联")])],1)]),t("div",{staticStyle:{padding:"30px","font-size":"15px"}},[e._v("已建关联")]),t("el-table",{ref:"multipleTable",staticClass:"el-table-common__list",attrs:{"tooltip-effect":"light","highlight-current-row":"",stripe:"",data:e.currentTable,border:""}},[t("el-table-column",{attrs:{"show-overflow-tooltip":"",align:"center",prop:"relateColName",label:"关联字段"}}),t("el-table-column",{attrs:{"show-overflow-tooltip":"",align:"center",prop:"refTargetName",label:"被关联维度表"}}),t("el-table-column",{attrs:{"show-overflow-tooltip":"",align:"center",prop:"refTargetColName",label:"被关联维度字段"}}),t("el-table-column",{attrs:{"show-overflow-tooltip":"",align:"center",prop:"dimDesc",label:"关联英文名"}}),t("el-table-column",{attrs:{"show-overflow-tooltip":"",align:"center",prop:"dimNameCn",label:"关联中文名"}}),t("el-table-column",{attrs:{"show-overflow-tooltip":"",align:"center",label:"操作"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("i",{staticClass:"el-icon-delete",on:{click:function(t){return e.del(a.$index)}}})]}}])})],1)],1)],1)],1)]],2)}),[],!1,null,"14e2a421",null);t.default=d.exports}}]);