(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-4df6c226","chunk-6368203c","chunk-912e8344","chunk-2d0a4b1f"],{"05d9":function(e,t,a){"use strict";a.r(t),a("6762"),a("2fdb"),a("a481"),a("8e6e"),a("ac6a"),a("456d"),a("c5f6"),a("7514"),a("6b54");var r=a("ade3"),o=a("2f62");function l(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function i(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?l(Object(a),!0).forEach((function(t){Object(r.a)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):l(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var n={props:{show:{type:Boolean,default:!1},currentSelectDatabase:{type:Object,default:function(){}},currentLayerValue:{type:String,default:""},selectParam:{type:Object,default:function(){}},currentType:{type:Object,default:function(){}}},data:function(){return{storey:["au_ods","au_std","au_dwd","au_dwm","au_dws","au_app"],datas:[],templateSelection:"",tableData:[],selectedRow:null,multipleSelection:[],defaultProps:{label:"name",children:"children"},treeExpandData:[],searchText:"",param:{code:"",type:"",tagId:null,tableNameOrComment:"",page:1,rows:10,total:0}}},components:{},computed:{},mounted:function(){this.init(),this.$nextTick((function(){document.querySelector(".pane-comp")&&(document.querySelector(".pane-comp").style.width="177px")}))},methods:i(i(i({},Object(o.b)("fusionTask",["GET_TREE"])),Object(o.b)(["_AJAX"])),{},{init:function(){var e=this;this.$nextTick((function(){var t=document.querySelector(".custom-container");t&&(t.style.height=t.clientHeight+"px",e.getTree().then((function(){e.selectCurrent()})))}))},selectCurrent:function(){this.param.page=1,this.param.rows=10,this.param.code=this.currentSelectDatabase.code,this.param.type=this.currentSelectDatabase.type,this.param.tagId=null,this.param.tableNameOrComment="",this.getTable()},getTree:function(){var e=this;return new Promise((function(t,a){e.param.tableNameOrComment="",e.GET_TREE().then((function(a){e.datas=a||[],e.treeExpandData.push("1"),t(a)})).catch((function(e){a(e)}))}))},onSearch:function(){this.getTable()},getTable:function(){var e=this,t={code:this.param.code,type:this.param.type.toString(),page:this.param.page,rows:this.param.rows,tableNameOrComment:this.param.tableNameOrComment};this.param.tagId&&(t.tagId=this.param.tagId),this._AJAX({url:"task.stepHeader.getTableByDBTag",method:"get",data:t}).then((function(t){e.tableData=t.rows,e.param.total=t.total}))},flattenArray:function(e){for(var t=[],a=0;a<e.length;a++)Array.isArray(e[a])?t=t.concat(this.flattenArray(e[a])):t.push(e[a]);return t},onSubmit:function(){var e=this,t=Array.isArray(this.templateSelection)?this.templateSelection:[this.tableData.find((function(t){return t.id===e.templateSelection}))];if((t=t.filter((function(e){return void 0!==e}))).some((function(e){return 0===e.tableIscreate}))&&this.storey.includes(this.currentSelectDatabase.code))return this.$AudaqueToast.warn({template:"选中的含有未创建表，请前往：模型分层-".concat(this.currentSelectDatabase.label,"中创建"),methods:{okEvent:function(){}}}),!1;this.$emit("submit",t)},isSelectable:function(e){return!0},handleClose:function(){this.$emit("close")},handleRowClick:function(e){this.selectedRow===e?this.selectedRow=null:this.selectedRow=e},handleSizeChange:function(e){this.param.page=1,this.param.rows=e,this.getTable()},handleCurrentChange:function(e){this.param.page=e,this.getTable()},handleCheckboxChange:function(e){e.checked||(this.selectedRow=null)},handleSelectionChange:function(e){this.templateSelection=e},rowChange:function(e){this.templateSelection=e.id},handleNodeClick:function(e){this.param.code=this.currentSelectDatabase.code,this.param.type=this.currentSelectDatabase.type,this.param.tagId=Number(e.id),this.param.page=1,this.param.rows=10,this.getTable()}})},s=(a("0df4"),a("2877")),c=Object(s.a)(n,(function(){var e=this,t=e._self._c;return t("el-dialog",{attrs:{title:"库表选择",visible:e.show,width:"80%","before-close":e.handleClose,"append-to-body":""},on:{"update:visible":function(t){e.show=t}}},[t("div",{staticClass:"custom-container",staticStyle:{"min-height":"60vh"}},[t("audaque-resize-split-page",[t("template",{slot:"leftPane"},[t("div",{staticStyle:{"padding-left":"24px","white-space":"nowrap",overflow:"hidden"}},[e._v("\n                    当前库："),t("span",{staticStyle:{cursor:"pointer",color:"#409eff"},on:{click:e.selectCurrent}},[e._v(e._s(e.currentSelectDatabase.label)+"--")])]),t("el-tree",{staticClass:"tree-dashed",attrs:{data:e.datas,props:e.defaultProps,"default-expanded-keys":e.treeExpandData,"node-key":"id"},on:{"node-click":e.handleNodeClick}})],1),t("template",{slot:"rightPane"},[t("div",{staticClass:"row",staticStyle:{"margin-bottom":"10px"}},[t("div",{staticStyle:{width:"50%"}},[t("el-input",{attrs:{placeholder:"通过表名，表中文名模糊查询"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.onSearch.apply(null,arguments)}},model:{value:e.param.tableNameOrComment,callback:function(t){e.$set(e.param,"tableNameOrComment",t)},expression:"param.tableNameOrComment"}})],1),t("div",[t("el-button",{attrs:{type:"primary"},on:{click:e.onSearch}},[e._v("筛选")])],1)]),t("el-table",{ref:"multipleTable",staticStyle:{width:"100%"},attrs:{data:e.tableData,border:"","highlight-current-row":""},on:{"row-click":e.rowChange,"selection-change":e.handleSelectionChange}},["au_dwd"!==e.currentLayerValue&&"au_dws"!==e.currentLayerValue||"target"===e.currentType.type?t("el-table-column",{attrs:{align:"center",width:"55",label:""},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-radio",{staticClass:"radio",attrs:{label:a.row.id},model:{value:e.templateSelection,callback:function(t){e.templateSelection=t},expression:"templateSelection"}},[e._v(" ")])]}}])}):t("el-table-column",{attrs:{type:"selection",width:"55"}}),t("el-table-column",{attrs:{width:"80",prop:"schemaName",label:"数据库名","show-overflow-tooltip":""}}),t("el-table-column",{attrs:{prop:"tableName",label:"表名","show-overflow-tooltip":""}}),t("el-table-column",{attrs:{prop:"tableComment",label:"表中文描述","show-overflow-tooltip":""}}),t("el-table-column",{attrs:{width:"80",prop:"dataNum",label:"数据量","show-overflow-tooltip":""}}),t("el-table-column",{attrs:{width:"100",prop:"tagFullName",label:"元数据标签","show-overflow-tooltip":""},scopedSlots:e._u([{key:"default",fn:function(a){return[a.row.tagFullName?t("span",{domProps:{innerHTML:e._s(a.row.tagFullName.replace(/;/g,"<br>").replace(/,/g,"→").replace(/;$/,""))}}):e._e()]}}])}),e.storey.includes(e.currentSelectDatabase.code)?t("el-table-column",{attrs:{prop:"tableIscreate",label:"表是否已创建",width:"100"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n                            "+e._s(1===t.row.tableIscreate?"已创建":"未创建")+"\n                        ")]}}],null,!1,1411126668)}):e._e()],1),t("adq-pagination",{attrs:{"current-page":e.param.page,total:e.param.total,"page-size":e.param.rows},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],1)],2)],1),t("div",{staticClass:"dialog-footer row",attrs:{slot:"footer"},slot:"footer"},[t("div",[t("el-button",{on:{click:e.handleClose}},[e._v("取消")])],1),t("div",[t("el-button",{attrs:{type:"primary"},on:{click:e.onSubmit}},[e._v("确认")])],1)])])}),[],!1,null,"1cbcc539",null);t.default=c.exports},"0812":function(e,t,a){"use strict";a.r(t),a("8e6e"),a("456d"),a("7f7f"),a("ac6a");var r=a("ade3"),o=a("2f62");function l(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function i(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?l(Object(a),!0).forEach((function(t){Object(r.a)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):l(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var n={computed:i({},Object(o.d)("fusionTask",["databaseConf"])),data:function(){return{storey:["au_ods","au_std","au_dwd","au_dwm","au_dws","au_app"],databaseList:[{label:"前置库",options:[]},{label:"",options:[]}],nameMap:{0:"stepStart",au_ods:"stepOds",au_std:"stepStd",au_dwd:"stepDwd",au_dwm:"stepDwm",au_dws:"stepDws",au_app:"stepApp"},titleMap:{0:"开始",1:"归集层",2:"标准层",3:"基础层",4:"主题层",5:"专题层",6:"安全层",7:"前置库"},process:[{id:"",title:"开始",stepId:"",success:!1}]}},methods:i({},Object(o.b)("fusionTask",["GET_DATA_BASE_LIST"])),created:function(){var e=this;this.isLoading=!0,this.databaseList[1].options=[],this.GET_DATA_BASE_LIST().then((function(){e.databaseConf.frontDBList.forEach((function(t,a){e.databaseList[0].options.push({label:t.name,value:a+1,type:t.type,code:t.code})})),e.databaseConf.modelDBList.forEach((function(t,a){e.databaseList[1].options.push({label:t.name,value:a+1,type:t.type,code:t.code})}))}))}};t.default=n},"0df4":function(e,t,a){"use strict";a("7239")},2662:function(e,t,a){(e.exports=a("2350")(!1)).push([e.i,"[data-v-1f45bdba] .CodeMirror{color:#000;direction:ltr;height:500px!important;line-height:22px;border:1px solid #e7e7e7}.CodeMirror-hints[data-v-1f45bdba]{z-index:9999!important}",""])},"59fc":function(e,t,a){"use strict";a.r(t),a("8e6e"),a("456d"),a("5df3"),a("4f7f"),a("ac6a"),a("7514");var r=a("2909"),o=a("53ca"),l=a("ade3"),i=(a("28a5"),a("2f62")),n=a("e762"),s=a("f029"),c=a("db05"),d=a.n(c),u=a("05d9");function p(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function m(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?p(Object(a),!0).forEach((function(t){Object(l.a)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):p(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var b={mixins:[a("0812").default],components:{tableSelectionPage:u.default,SqlEditor:s.default},watch:{newSelectParam:{handler:function(e){var t=this;this.$nextTick((function(){if(!t.$store.state.fusionTask.isLoading&&e.alreadySelectTargetTable.length>0){var a=e.alreadySelectSourceTable[0].tableName,r=e.alreadySelectTargetTable[0].tableName,o=e.alreadySelectSourceTable[0].id,l=e.alreadySelectTargetTable[0].id;t.param.tableDataMigrateDto.sourceTableId=o,t.param.tableDataMigrateDto.targetTableId=l,t.param.tableDataMigrateDto.sourceTableName=a,t.param.tableDataMigrateDto.targetTableName=r,t.autoChecked=!1,t.getCloumnList(o,l)}}))},deep:!0}},data:function(){return{autoChecked:!1,targetColumnOptions:[],zlFieldOptions:[],activeName:"first",value:"",rowId:this.$route.query.id,currentType:"",showTableSelectionPage:!1,filter:"look"!=this.$route.query.filter,selectParam:{targetDatabase:"",alreadySelectTargetTable:[],alreadySelectTargetTableValue:[],sourceDatabase:"",alreadySelectSourceTable:[],alreadySelectSourceTableValue:[]},param:{id:"",taskName:"",taskType:2,cron:"",status:0,remark:"",tableDataMigrateDto:{sourceTableId:"",sourceTableName:"",targetTableId:"",targetTableName:"",whereCondition:"",sqlMain:"",syncType:1,increaseField:"",columnMapDtoList:[],sourceDbCode:"",sourceDbType:"",targetDbCode:"",targetDbType:""}},cronPopover:!1,cron:"",rules:{taskName:[{required:!0,message:"请输入任务名称",trigger:"blur"}],taskType:[{required:!0,message:"请选择任务类型",trigger:"select"}],cron:[{required:!0,message:"请输入cron表达式",trigger:"change"}],status:[{required:!0,message:"请输入任务状态",trigger:"blur"}],remark:[{required:!1,message:"请输入任务描述",trigger:"blur"}]}}},computed:{currentLayerValue:function(){return this.selectParam?this.selectParam.targetDatabase:""},cronCn:function(){var e=this.param.cron;if(null==e||""==e)return"";var t=e.split(" ");return-1!=t[1].indexOf("/")?"每隔"+t[1].split("/")[1]+"分钟":-1!=t[2].indexOf("/")?"每隔"+t[2].split("/")[1]+"小时第"+t[1]+"分钟":-1!=t[3].indexOf("/")?"每隔"+t[3].split("/")[1]+"天第"+t[2]+"时第"+t[1]+"分钟":""},newSelectParam:function(){return m({},this.selectParam)}},methods:m(m(m({},Object(i.b)(["_AJAX"])),Object(i.b)("dataMigrateTask",["DATA_MIGRATE_TASK_INSERT","DATA_MIGRATE_TASK_UPDATE","DATA_MIGRATE_TASK_ECHO"])),{},{changeCron:function(e){this.filter&&3!=this.param.taskType&&(this.param.cron=e)},handleTaskTypeRadioChange:function(e){3==e&&(this.param.cron="")},handleSourceChange:function(){this.selectParam.alreadySelectSourceTable=[],this.selectParam.alreadySelectSourceTableValue=[]},handleTargetChange:function(){this.selectParam.alreadySelectTargetTable=[],this.selectParam.alreadySelectTargetTableValue=[]},initMap:function(e){var t=this.currentType.type;if(e.length>0&&("source"===t&&(this.selectParam.alreadySelectSourceTable=e,this.selectParam.alreadySelectSourceTableValue=e.map((function(e){return e.id}))),"target"===t)){if(this.selectParam.alreadySelectTargetTableValue[0]===e.map((function(e){return e.id}))[0])return void(this.showTableSelectionPage=!1);this.selectParam.alreadySelectTargetTable=e,this.selectParam.alreadySelectTargetTableValue=e.map((function(e){return e.id}))}this.showTableSelectionPage=!1},deepCopy:function(e){if("object"!==Object(o.a)(e)||null===e)return e;var t;if(Array.isArray(e)){t=[];for(var a=0;a<e.length;a++)t[a]=this.deepCopy(e[a])}else for(var r in t={},e)e.hasOwnProperty(r)&&(t[r]=this.deepCopy(e[r]));return t},selectTable:function(e){if("source"!==e||""!==this.selectParam.sourceDatabase)if("target"!==e||""!==this.selectParam.targetDatabase){var t=[].concat(Object(r.a)(this.databaseList[0].options),Object(r.a)(this.databaseList[1].options));if(this.currentType={type:e},"source"===e){var a=this.selectParam.sourceDatabase;this.currentSelectDatabase=t.find((function(e){return e.code===a}))}if("target"===e){var o=this.selectParam.targetDatabase;this.currentSelectDatabase=t.find((function(e){return e.code===o}))}this.showTableSelectionPage=!0}else this.$AudaqueToast.warn({template:"目标层不可为空"});else this.$AudaqueToast.warn({template:"源数据层不可为空"})},verifyParam:function(e){var t=this.deepCopy(e);return t.tableDataMigrateDto.columnMapDtoList&&0!==t.tableDataMigrateDto.columnMapDtoList.length&&t.tableDataMigrateDto.columnMapDtoList.some((function(e){return""!==e.sourceColumnId&&""!==e.targetColumnId}))?!this.isHasDuplicateProperty(t.tableDataMigrateDto.columnMapDtoList,"targetColumnId")||(this.$message.error("目标表的字段不可重复，请重新选择!"),!1):(this.$message.error("目标表的字段最少填一个，不可全部为空!"),!1)},subBtn:function(){var e=this;this.$refs.dataMigrateTaskForm.validate((function(t){if(t){var a=e,r=e.deepCopy(e.param);if(!e.verifyParam(r))return;1==r.tableDataMigrateDto.syncType&&(r.tableDataMigrateDto.increaseField=""),r.tableDataMigrateDto.whereCondition&&(r.tableDataMigrateDto.whereCondition=Object(n.b)(r.tableDataMigrateDto.whereCondition)),r.tableDataMigrateDto.sqlMain&&(r.tableDataMigrateDto.sqlMain=Object(n.b)(r.tableDataMigrateDto.sqlMain)),r.tableDataMigrateDto.targetDbCode=e.selectParam.targetDatabase,e.rowId?(r.id=e.rowId,e.DATA_MIGRATE_TASK_UPDATE(r).then((function(t){0==t.code&&e.$AudaqueToast.tip({template:"修改成功",methods:{okEvent:function(){a.$router.go(-1)}}})}))):e.DATA_MIGRATE_TASK_INSERT(r).then((function(t){0==t.code&&e.$AudaqueToast.tip({template:"添加成功",methods:{okEvent:function(){a.$router.go(-1)}}})}))}}))},Automaticmapping:function(e){var t=this;e?this.param.tableDataMigrateDto.columnMapDtoList.forEach((function(e){var a=t.targetColumnOptions.find((function(a){return t.matchColumnDim(e.sourceColumnName,a.columnName)}));e.targetColumnId=a?a.id:""})):this.param.tableDataMigrateDto.columnMapDtoList.forEach((function(e){e.targetColumnId=""}))},matchColumnDim:function(e,t){return e.replaceAll("_","").replaceAll("-","").toLowerCase()===t.replaceAll("_","").replaceAll("-","").toLowerCase()},getCloumnList:function(e,t){var a=this;this._AJAX({url:"stepOds.getOriginOrTargetColumn",method:"GET",data:{sourceTableId:e,targetTableId:t}}).then((function(r){a.param.tableDataMigrateDto.columnMapDtoList=r[e].map((function(e){return{sourceColumnId:e.id,sourceColumnName:e.columnName,sourceColumnComment:e.columnComment,targetColumnId:""}})),a.$refs.refTableData.doLayout(),a.targetColumnOptions=r[t],a.zlFieldOptions=r[e]}))},handleTargetColumnChange:function(){},handleChangeWhereCondition:function(){},changeTextarea:function(e){this.param.tableDataMigrateDto.sqlMain=e},formaterSql:function(e){var t=this.$refs.sqleditor;t.editor.setValue(d.a.format(t.editor.getValue()))},generateParam:function(){var e=this;return{taskRuleRelList:this.param.tableDataMigrateDto.columnMapDtoList.filter((function(e){return e.targetColumnId})).map((function(t){return{sourceColumnId:t.sourceColumnId,targetColumnId:t.targetColumnId,sourceColumnName:t.sourceColumnName,targetColumnName:e.targetColumnOptions.find((function(e){return e.id===t.targetColumnId})).columnName}})),taskStepDto:{levelCode:this.selectParam.targetDatabase,syncType:this.param.tableDataMigrateDto.syncType,increaseField:this.param.tableDataMigrateDto.increaseField},taskStepDetailDto:{sourceTableId:this.param.tableDataMigrateDto.sourceTableId,targetTableId:this.param.tableDataMigrateDto.targetTableId,sqlContent:"",whereCondition:this.param.tableDataMigrateDto.whereCondition?Object(n.b)(this.param.param.tableDataMigrateDto.whereCondition):""}}},isHasDuplicateProperty:function(e,t){for(var a=new Set,r=0;r<e.length;r++){var o=e[r][t];if(null!==o&&""!==o){if(a.has(o))return!0;a.add(o)}}return!1},generateSql:function(){var e=this,t=this.generateParam();this.verifyParam(t)&&this.$refs.stepAggregationLayerForm.validate((function(a){a&&e._AJAX({url:"dataMigrateTask.generateSql",method:"POST",data:t}).then((function(t){e.param.tableDataMigrateDto.sqlMain=t[0].sql,e.activeName="",setTimeout((function(){e.activeName="second"}),100)})).catch((function(e){}))}))}}),mounted:function(){},created:function(){var e=this;this.rowId&&(this.$store.commit("fusionTask/changeLoading",!0),this.DATA_MIGRATE_TASK_ECHO({taskId:this.rowId}).then((function(t){var a=t.migrateEcho;e.param=a,e.targetColumnOptions=t.targetColumnOptions;var r=a.tableDataMigrateDto;e.selectParam.sourceDatabase=r.sourceDbCode,e.selectParam.targetDatabase=r.targetDbCode,e.selectParam.alreadySelectTargetTableValue=[r.targetTableId],e.selectParam.alreadySelectSourceTableValue=[r.sourceTableId],e._AJAX({url:"stepOds.getOriginOrTargetColumn",method:"GET",data:{sourceTableId:r.sourceTableId,targetTableId:r.targetTableId}}).then((function(t){e.zlFieldOptions=t[r.sourceTableId]})),e.selectParam.alreadySelectSourceTable.push({id:r.sourceTableId,tableName:r.sourceTableName}),e.selectParam.alreadySelectTargetTable.push({id:r.targetTableId,tableName:r.targetTableName}),setTimeout((function(){e.$store.commit("fusionTask/changeLoading",!1)}))})))}},f=(a("9ee1"),a("2877")),h=Object(f.a)(b,(function(){var e=this,t=e._self._c;return t("audaque-detail-form-page",{attrs:{title:e.filter?e.rowId?"数据迁移任务编辑":"数据迁移任务新增":"数据迁移任务查看","opt-type":e.$route.query.filter},on:{"submit-click":e.subBtn}},[[t("el-form",{ref:"dataMigrateTaskForm",attrs:{model:e.param,"label-width":"120px",rules:e.rules,disabled:!e.filter}},[t("el-row",[t("el-col",{attrs:{span:24}},[t("el-form-item",{attrs:{label:"任务名称",prop:"taskName",rules:e.rules.taskName}},[t("el-input",{attrs:{disabled:!e.filter,placeholder:"请输入任务名称",maxlength:"200","show-word-limit":""},model:{value:e.param.taskName,callback:function(t){e.$set(e.param,"taskName","string"==typeof t?t.trim():t)},expression:"param.taskName"}})],1),t("el-form-item",{attrs:{label:"任务类型",prop:"taskType",rules:e.rules.taskType}},[t("el-radio-group",{attrs:{disabled:!e.filter},on:{input:e.handleTaskTypeRadioChange},model:{value:e.param.taskType,callback:function(t){e.$set(e.param,"taskType",t)},expression:"param.taskType"}},[t("el-radio",{attrs:{label:2}},[e._v("定时任务")]),t("el-radio",{attrs:{label:3}},[e._v("手动执行")])],1)],1),2==e.param.taskType?t("el-form-item",{attrs:{label:"调度计划",prop:"cron",rules:e.rules.cron}},[t("el-input",{attrs:{readonly:"",placeholder:"请输入cron表达式",maxlength:"200","show-word-limit":""},on:{focus:function(t){e.cronPopover=!0}},model:{value:e.param.cron,callback:function(t){e.$set(e.param,"cron","string"==typeof t?t.trim():t)},expression:"param.cron"}})],1):e._e(),2==e.param.taskType?t("el-form-item",{attrs:{label:"调度计划描述"}},[t("el-input",{attrs:{disabled:"",value:e.cronCn,maxlength:"200","show-word-limit":""}})],1):e._e(),t("el-form-item",{attrs:{label:"任务描述",prop:"remark",rules:e.rules.remark}},[t("el-input",{attrs:{type:"textarea",autosize:"",disabled:!e.filter,placeholder:"请输入任务描述",maxlength:"200","show-word-limit":""},model:{value:e.param.remark,callback:function(t){e.$set(e.param,"remark","string"==typeof t?t.trim():t)},expression:"param.remark"}})],1)],1)],1)],1),e.cronPopover?t("new-cron",{attrs:{cronPopover:e.cronPopover,defaultVal:e.param.cron},on:{close:function(t){e.cronPopover=!1},change:e.changeCron}}):e._e(),e.showTableSelectionPage?t("table-selection-page",{attrs:{show:e.showTableSelectionPage,currentSelectDatabase:e.currentSelectDatabase,currentLayerValue:e.currentLayerValue,selectParam:e.selectParam,currentType:e.currentType},on:{submit:e.initMap,close:function(t){e.showTableSelectionPage=!1}}}):e._e(),t("div",{staticClass:"search"},[t("div",{staticClass:"row"},[t("div",{staticClass:"label"},[t("span",{staticClass:"require"},[e._v("*")]),e._v("源数据层  ")]),t("div",[t("el-select",{attrs:{placeholder:"请选择",clearable:"",disabled:!e.filter},on:{change:e.handleSourceChange},model:{value:e.selectParam.sourceDatabase,callback:function(t){e.$set(e.selectParam,"sourceDatabase",t)},expression:"selectParam.sourceDatabase"}},e._l(e.databaseList,(function(a){return t("el-option-group",{key:a.label,attrs:{label:a.label}},e._l(a.options,(function(e){return t("el-option",{key:e.code,attrs:{label:e.label,value:e.code}})})),1)})),1)],1),t("div",[t("el-select",{attrs:{multiple:"",placeholder:"请选择原表",disabled:""},model:{value:e.selectParam.alreadySelectSourceTableValue,callback:function(t){e.$set(e.selectParam,"alreadySelectSourceTableValue",t)},expression:"selectParam.alreadySelectSourceTableValue"}},e._l(e.selectParam.alreadySelectSourceTable,(function(e){return t("el-option",{key:e.id,attrs:{label:e.tableName,value:e.id}})})),1)],1),t("div",{staticClass:"footer"},[t("el-button",{attrs:{type:"primary",disabled:!e.filter},on:{click:function(t){return e.selectTable("source")}}},[e._v("选择")])],1)]),t("div",{staticClass:"row"},[t("div",{staticClass:"label"},[t("span",{staticClass:"require"},[e._v("*")]),e._v("目标数据层  ")]),t("div",[t("el-select",{attrs:{placeholder:"请选择",clearable:"",disabled:!e.filter},on:{change:e.handleTargetChange},model:{value:e.selectParam.targetDatabase,callback:function(t){e.$set(e.selectParam,"targetDatabase",t)},expression:"selectParam.targetDatabase"}},e._l(e.databaseList,(function(a){return t("el-option-group",{key:a.label,attrs:{label:a.label}},e._l(a.options,(function(e){return t("el-option",{key:e.code,attrs:{label:e.label,value:e.code}})})),1)})),1)],1),t("div",[t("el-select",{attrs:{multiple:"",placeholder:"请选择目标表",disabled:""},model:{value:e.selectParam.alreadySelectTargetTableValue,callback:function(t){e.$set(e.selectParam,"alreadySelectTargetTableValue",t)},expression:"selectParam.alreadySelectTargetTableValue"}},e._l(e.selectParam.alreadySelectTargetTable,(function(e){return t("el-option",{key:e.id,attrs:{label:e.tableName,value:e.id}})})),1)],1),t("div",{staticClass:"footer"},[t("el-button",{attrs:{type:"primary",disabled:!e.filter},on:{click:function(t){return e.selectTable("target")}}},[e._v("选择")])],1)])]),t("el-form",{ref:"stepAggregationLayerForm",staticClass:"form-item",attrs:{model:e.param.tableDataMigrateDto,"label-width":"120px"}},[t("div",[t("el-tabs",{attrs:{type:"card"},model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},[t("el-tab-pane",{attrs:{label:"字段映射",name:"first"}},[t("div",[t("div",{staticClass:"checkboxrow"},[t("el-button",{attrs:{size:"mini",plain:"",type:"primary",disabled:!e.filter},on:{click:function(t){return e.Automaticmapping(!0)}}},[e._v("字段自动映射")])],1),t("el-table",{ref:"refTableData",staticStyle:{width:"100%",margin:"0 auto"},attrs:{data:e.param.tableDataMigrateDto.columnMapDtoList,border:""}},[t("el-table-column",{attrs:{prop:"sourceColumnName",label:e.param.tableDataMigrateDto.sourceTableName?e.param.tableDataMigrateDto.sourceTableName+"字段名":"",align:"center"}}),t("el-table-column",{attrs:{prop:"sourceColumnComment",label:e.param.tableDataMigrateDto.sourceTableName?e.param.tableDataMigrateDto.sourceTableName+"字段说明":"",align:"center"}}),t("el-table-column",{attrs:{label:e.param.tableDataMigrateDto.targetTableName?e.param.tableDataMigrateDto.targetTableName+"字段对应":"",prop:"targetColumnId",align:"center"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("div",{staticClass:"flex"},[t("el-form-item",[t("el-select",{attrs:{placeholder:"请选择",clearable:"",disabled:!e.filter},on:{change:function(t){return e.handleTargetColumnChange}},model:{value:a.row.targetColumnId,callback:function(t){e.$set(a.row,"targetColumnId",t)},expression:"scope.row.targetColumnId"}},e._l(e.targetColumnOptions,(function(e){return t("el-option",{key:e.id,attrs:{label:e.columnName,value:e.id}})})),1)],1)],1)]}}])})],1),t("br"),t("br"),t("el-form-item",{attrs:{label:"同步配置",rules:{required:!0,message:"输入",trigger:"blur"},"class-name":"tablerow"}},[t("el-radio",{attrs:{label:1,disabled:!e.filter},model:{value:e.param.tableDataMigrateDto.syncType,callback:function(t){e.$set(e.param.tableDataMigrateDto,"syncType",t)},expression:"param.tableDataMigrateDto.syncType"}},[e._v("全量")]),t("el-radio",{attrs:{label:2,disabled:!e.filter},model:{value:e.param.tableDataMigrateDto.syncType,callback:function(t){e.$set(e.param.tableDataMigrateDto,"syncType",t)},expression:"param.tableDataMigrateDto.syncType"}},[e._v("增量")])],1),2==e.param.tableDataMigrateDto.syncType?t("el-form-item",{attrs:{label:"增量字段：",prop:"increaseField",rules:{required:!0,message:"请输入",trigger:"change"}}},[t("el-select",{attrs:{placeholder:"请选择",disabled:!e.filter},model:{value:e.param.tableDataMigrateDto.increaseField,callback:function(t){e.$set(e.param.tableDataMigrateDto,"increaseField",t)},expression:"param.tableDataMigrateDto.increaseField"}},e._l(e.zlFieldOptions,(function(e,a){return t("el-option",{key:a,attrs:{label:e.columnName,value:e.columnName}})})),1)],1):e._e(),t("el-form-item",{attrs:{prop:"whereCondition"},scopedSlots:e._u([{key:"label",fn:function(){return[t("span",[e._v("where条件")]),t("el-tooltip",{staticClass:"item",staticStyle:{"padding-left":"10px"},attrs:{effect:"dark",placement:"right"}},[t("div",{attrs:{slot:"content"},slot:"content"},[e._v("注：增量时可以设置，where条件不需填写where关键字")]),t("i",{staticClass:"content-view iconfont iconbangzhu operate"})])]},proxy:!0}])},[t("el-input",{attrs:{type:"textarea",rows:5,placeholder:"请输入内容",disabled:!e.filter},on:{change:e.handleChangeWhereCondition},model:{value:e.param.tableDataMigrateDto.whereCondition,callback:function(t){e.$set(e.param.tableDataMigrateDto,"whereCondition",t)},expression:"param.tableDataMigrateDto.whereCondition"}})],1)],1)])],1)],1)])]],2)}),[],!1,null,"8df6a2b8",null);t.default=h.exports},"6a93":function(e,t,a){var r=a("78bd");r.__esModule&&(r=r.default),"string"==typeof r&&(r=[[e.i,r,""]]),r.locals&&(e.exports=r.locals),(0,a("499e").default)("9f93018c",r,!0,{sourceMap:!1,shadowMode:!1})},7239:function(e,t,a){var r=a("df6d");r.__esModule&&(r=r.default),"string"==typeof r&&(r=[[e.i,r,""]]),r.locals&&(e.exports=r.locals),(0,a("499e").default)("01e55472",r,!0,{sourceMap:!1,shadowMode:!1})},"78bd":function(e,t,a){(e.exports=a("2350")(!1)).push([e.i,".get-edit-item[data-v-8df6a2b8]{padding-top:20px;margin:0 50px}.get-edit-item li[data-v-8df6a2b8]{margin-top:20px;display:-webkit-box;display:-ms-flexbox;display:flex}.get-edit-item li .get-edit-type[data-v-8df6a2b8]{height:40px;line-height:40px}.get-edit-item li .get-edit-title[data-v-8df6a2b8]{width:80px;color:#3a405b;height:40px;line-height:40px}.get-edit-item li .el-tree[data-v-8df6a2b8]{width:100%;border:1px solid #dcdfe6;padding:24px}.search[data-v-8df6a2b8]{width:93%;padding:0 0 0 10px!important}.row[data-v-8df6a2b8]{margin-bottom:20px;width:100%;display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:start;-ms-flex-pack:start;justify-content:flex-start;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-ms-flex-wrap:nowrap;flex-wrap:nowrap}.row[data-v-8df6a2b8] .el-form-item{margin-bottom:0!important}.row .label[data-v-8df6a2b8]{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:end;-ms-flex-pack:end;justify-content:flex-end;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-ms-flex-wrap:nowrap;flex-wrap:nowrap;width:111px;vertical-align:middle;font-size:14px;color:#606266}.row>div[data-v-8df6a2b8]:nth-child(2){width:200px}.row>div[data-v-8df6a2b8]:nth-child(2),.row>div[data-v-8df6a2b8]:nth-child(3){display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:start;-ms-flex-pack:start;justify-content:flex-start;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-ms-flex-wrap:nowrap;flex-wrap:nowrap}.row>div[data-v-8df6a2b8]:nth-child(3){width:300px;margin-left:8px;margin-right:5px}.row[data-v-8df6a2b8] .el-input__suffix-inner{display:none}.row[data-v-8df6a2b8] .el-form-item__content{margin-left:0!important}.row[data-v-8df6a2b8] .el-input.is-disabled .el-input__inner{background:#fbfbfb}.require[data-v-8df6a2b8]{color:#f56c6c}[data-v-8df6a2b8] .el-table td,[data-v-8df6a2b8] .el-table th,[data-v-8df6a2b8] .el-table th.el-table__cell>.cell{text-align:center!important}[data-v-8df6a2b8] .el-form{width:93%;padding:10px 0!important}[data-v-8df6a2b8] .el-form.form-item{width:calc(93% - 120px);margin-left:120px}.tips[data-v-8df6a2b8]{padding-top:5px;display:inline-block;color:#e6a23c}.checkboxrow[data-v-8df6a2b8]{width:80%;margin:10px 0}.rule-type[data-v-8df6a2b8]{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-ms-flex-wrap:wrap;flex-wrap:wrap}.rule-type span[data-v-8df6a2b8]{display:inline-block}.operate[data-v-8df6a2b8]{cursor:pointer;color:#53a7f8;font-size:12px}.flex[data-v-8df6a2b8]{width:100%;height:100%;display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-ms-flex-wrap:nowrap;flex-wrap:nowrap}.flex[data-v-8df6a2b8] .el-form-item{margin-bottom:0!important}.center[data-v-8df6a2b8] .el-form-item__content,.flex[data-v-8df6a2b8] .el-form-item__content{margin-left:0!important}[data-v-8df6a2b8] .el-table__body-wrapper,[data-v-8df6a2b8] .el-table__header-wrapper{border-left:1px solid #eee;border-right:1px solid #eee}[data-v-8df6a2b8] .el-table__header-wrapper{border-top:1px solid #eee}",""])},"9ee1":function(e,t,a){"use strict";a("6a93")},b04a:function(e,t,a){"use strict";a("e68a")},b866:function(e,t,a){var r=a("d131");r.__esModule&&(r=r.default),"string"==typeof r&&(r=[[e.i,r,""]]),r.locals&&(e.exports=r.locals),(0,a("499e").default)("3875f97e",r,!0,{sourceMap:!1,shadowMode:!1})},d131:function(e,t,a){(e.exports=a("2350")(!1)).push([e.i,".cm-s-idea span.cm-meta{color:olive}.cm-s-idea span.cm-number{color:#00f}.cm-s-idea span.cm-keyword{line-height:1em;font-weight:700;color:navy}.cm-s-idea span.cm-atom{font-weight:700;color:navy}.cm-s-idea span.cm-def,.cm-s-idea span.cm-operator,.cm-s-idea span.cm-property,.cm-s-idea span.cm-type,.cm-s-idea span.cm-variable,.cm-s-idea span.cm-variable-2,.cm-s-idea span.cm-variable-3{color:#000}.cm-s-idea span.cm-comment{color:grey}.cm-s-idea span.cm-string,.cm-s-idea span.cm-string-2{color:green}.cm-s-idea span.cm-qualifier{color:#555}.cm-s-idea span.cm-error{color:red}.cm-s-idea span.cm-attribute{color:#00f}.cm-s-idea span.cm-tag{color:navy}.cm-s-idea span.cm-link{color:#00f}.cm-s-idea .CodeMirror-activeline-background{background:#fffae3}.cm-s-idea span.cm-builtin{color:#30a}.cm-s-idea span.cm-bracket{color:#cc7}.cm-s-idea{font-family:Consolas,Menlo,Monaco,Lucida Console,Liberation Mono,DejaVu Sans Mono,Bitstream Vera Sans Mono,Courier New,monospace,serif}.cm-s-idea .CodeMirror-matchingbracket{outline:1px solid grey;color:#000!important}.CodeMirror-hints.idea{font-family:Menlo,Monaco,Consolas,Courier New,monospace;color:#616569;background-color:#ebf3fd!important}.CodeMirror-hints.idea .CodeMirror-hint-active{background-color:#a2b8c9!important;color:#5c6065!important}",""])},df6d:function(e,t,a){(e.exports=a("2350")(!1)).push([e.i,".row[data-v-1cbcc539]{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:end;-ms-flex-pack:end;justify-content:flex-end;-webkit-box-align:start;-ms-flex-align:start;align-items:flex-start;-ms-flex-wrap:nowrap;flex-wrap:nowrap}.row>div[data-v-1cbcc539]:first-child{margin-right:10px}[data-v-1cbcc539] .el-dialog__body{max-height:100%!important}[data-v-1cbcc539] .pane-comp,[data-v-1cbcc539] .tree-dashed{overflow:auto}",""])},e68a:function(e,t,a){var r=a("2662");r.__esModule&&(r=r.default),"string"==typeof r&&(r=[[e.i,r,""]]),r.locals&&(e.exports=r.locals),(0,a("499e").default)("f422793a",r,!0,{sourceMap:!1,shadowMode:!1})},e762:function(e,t,a){"use strict";a.d(t,"b",(function(){return v})),a.d(t,"a",(function(){return O}));const r="function"==typeof Buffer,o="function"==typeof TextDecoder?new TextDecoder:void 0,l="function"==typeof TextEncoder?new TextEncoder:void 0,i=Array.prototype.slice.call("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="),n=(e=>{let t={};return e.forEach((e,a)=>t[e]=a),t})(i),s=/^(?:[A-Za-z\d+\/]{4})*?(?:[A-Za-z\d+\/]{2}(?:==)?|[A-Za-z\d+\/]{3}=?)?$/,c=String.fromCharCode.bind(String),d="function"==typeof Uint8Array.from?Uint8Array.from.bind(Uint8Array):e=>new Uint8Array(Array.prototype.slice.call(e,0)),u=e=>e.replace(/=/g,"").replace(/[+\/]/g,e=>"+"==e?"-":"_"),p=e=>e.replace(/[^A-Za-z0-9\+\/]/g,""),m=e=>{let t,a,r,o,l="";const n=e.length%3;for(let s=0;s<e.length;){if((a=e.charCodeAt(s++))>255||(r=e.charCodeAt(s++))>255||(o=e.charCodeAt(s++))>255)throw new TypeError("invalid character found");t=a<<16|r<<8|o,l+=i[t>>18&63]+i[t>>12&63]+i[t>>6&63]+i[63&t]}return n?l.slice(0,n-3)+"===".substring(n):l},b="function"==typeof btoa?e=>btoa(e):r?e=>Buffer.from(e,"binary").toString("base64"):m,f=r?e=>Buffer.from(e).toString("base64"):e=>{let t=[];for(let a=0,r=e.length;a<r;a+=4096)t.push(c.apply(null,e.subarray(a,a+4096)));return b(t.join(""))},h=e=>{if(e.length<2)return(t=e.charCodeAt(0))<128?e:t<2048?c(192|t>>>6)+c(128|63&t):c(224|t>>>12&15)+c(128|t>>>6&63)+c(128|63&t);var t=65536+1024*(e.charCodeAt(0)-55296)+(e.charCodeAt(1)-56320);return c(240|t>>>18&7)+c(128|t>>>12&63)+c(128|t>>>6&63)+c(128|63&t)},g=/[\uD800-\uDBFF][\uDC00-\uDFFFF]|[^\x00-\x7F]/g,y=e=>e.replace(g,h),w=r?e=>Buffer.from(e,"utf8").toString("base64"):l?e=>f(l.encode(e)):e=>b(y(e)),v=(e,t=!1)=>t?u(w(e)):w(e),x=/[\xC0-\xDF][\x80-\xBF]|[\xE0-\xEF][\x80-\xBF]{2}|[\xF0-\xF7][\x80-\xBF]{3}/g,T=e=>{switch(e.length){case 4:var t=((7&e.charCodeAt(0))<<18|(63&e.charCodeAt(1))<<12|(63&e.charCodeAt(2))<<6|63&e.charCodeAt(3))-65536;return c(55296+(t>>>10))+c(56320+(1023&t));case 3:return c((15&e.charCodeAt(0))<<12|(63&e.charCodeAt(1))<<6|63&e.charCodeAt(2));default:return c((31&e.charCodeAt(0))<<6|63&e.charCodeAt(1))}},D=e=>e.replace(x,T),C=e=>{if(e=e.replace(/\s+/g,""),!s.test(e))throw new TypeError("malformed base64.");e+="==".slice(2-(3&e.length));let t,a,r,o="";for(let l=0;l<e.length;)t=n[e.charAt(l++)]<<18|n[e.charAt(l++)]<<12|(a=n[e.charAt(l++)])<<6|(r=n[e.charAt(l++)]),o+=64===a?c(t>>16&255):64===r?c(t>>16&255,t>>8&255):c(t>>16&255,t>>8&255,255&t);return o},k="function"==typeof atob?e=>atob(p(e)):r?e=>Buffer.from(e,"base64").toString("binary"):C,S=r?e=>d(Buffer.from(e,"base64")):e=>d(k(e).split("").map(e=>e.charCodeAt(0))),_=r?e=>Buffer.from(e,"base64").toString("utf8"):o?e=>o.decode(S(e)):e=>D(k(e)),M=e=>p(e.replace(/[-_]/g,e=>"-"==e?"+":"/")),O=e=>_(M(e))},f029:function(e,t,a){"use strict";a.r(t),a("b866"),a("a7be"),a("f6b6");var r=a("56b3");a("8c33"),a("31c5"),a("ffda"),a("9b74"),a("991c");var o={data:function(){return{editor:null}},props:{value:{type:String,default:""},sqlStyle:{type:String,default:"default"},readOnly:{type:[Boolean,String]}},watch:{newVal:function(e,t){this.editor&&this.$emit("changeTextarea",this.editor.getValue())}},computed:{newVal:function(){if(this.editor)return this.editor.getValue()},isView:function(){return"view"===this.$route.query.filter}},mounted:function(){this.initCodeMirror()},methods:{initCodeMirror:function(){var e=this;this.editor=r.fromTextArea(this.$refs.mycode,{value:this.value,mode:"text/x-mariadb",indentWithTabs:!0,smartIndent:!0,lineNumbers:!0,matchBrackets:!0,cursorHeight:1,lineWrapping:!0,readOnly:this.isView,theme:"idea",autofocus:!0,extraKeys:{Ctrl:"autocomplete"},hintOptions:{completeSingle:!1},gutters:["myGutter","CodeMirror-linenumbers"],gutterWidth:40}),this.editor.on("inputRead",(function(){e.editor.showHint()}))},setVal:function(){this.editor&&(""===this.value?this.editor.setValue(""):this.editor.setValue(this.value))}}},l=(a("b04a"),a("2877")),i=Object(l.a)(o,(function(){var e=this,t=e._self._c;return t("div",[t("textarea",{directives:[{name:"model",rawName:"v-model",value:e.value,expression:"value"}],ref:"mycode",staticClass:"codesql",domProps:{value:e.value},on:{input:function(t){t.target.composing||(e.value=t.target.value)}}})])}),[],!1,null,"1f45bdba",null);t.default=i.exports}}]);